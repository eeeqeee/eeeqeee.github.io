"use strict";(self.webpackChunkgenshin_optimizer=self.webpackChunkgenshin_optimizer||[]).push([[325],{70867:function(e,t,n){n.d(t,{mY:function(){return ArtifactMainStatMultiAutocomplete},N5:function(){return ArtifactSetMultiAutocomplete},Y4:function(){return ArtifactSetSingleAutocomplete},mW:function(){return ArtifactSubstatMultiAutocomplete}});var r=n(29439),i=n(1413),a=n(45987),s=n(13967),l=n(94198),o=n(58165),c=n(81918),u=n(90493),d=n(64554),x=n(79834),f=n(72791),h=n(22020),p=n(31148),m=n(72828),j=n(79406),Z=n(42320),v=n(50765),g=n(24351),y=n(91702),b=n(23786),C=n(57064),S=n(49900),k=n(80184);function MenuItemWithImage(e){var t=e.value,n=e.image,r=void 0===n?"":n,a=e.text,s=e.theme,l=e.isSelected,o=e.addlElement,c=e.props;return(0,k.jsxs)(b.Z,(0,i.Z)((0,i.Z)({value:t},c),{},{children:[(0,k.jsx)(C.Z,{children:r}),(0,k.jsx)(S.Z,{primaryTypographyProps:{style:{fontWeight:l?s.typography.fontWeightMedium:s.typography.fontWeightRegular}},children:a}),o&&o]}),t)}var w=n(68244),A=n(10157),D=n(75545),K=["allArtifactKeysWithGrouper","selectedArtifactKeys","setArtifactKeys","getName","getImage","label"],P=["artSetKeys","setArtSetKeys"],E=["mainStatKeys","setMainStatKeys"],I=["substatKeys","setSubstatKeys"],M=["allArtifactKeysWithGrouper","selectedArtifactKey","setArtifactKey","getName","getImage","label","disable","showDefault","defaultText","defaultIcon"],R=["artSetKey","setArtSetKey","label"];function ArtifactMultiAutocomplete(e){var t=e.allArtifactKeysWithGrouper,n=e.selectedArtifactKeys,r=e.setArtifactKeys,u=e.getName,d=e.getImage,x=e.label,h=(0,a.Z)(e,K),p=(0,s.Z)(),m=(0,f.useMemo)((function(){return t.map((function(e){var t=e.key,n=e.grouper;return{key:t,label:u(t),grouper:n}}))}),[t,u]);return(0,k.jsx)(l.Z,(0,i.Z)({autoHighlight:!0,multiple:!0,disableCloseOnSelect:!0,options:m,value:n.map((function(e){return{key:e,label:u(e)}})),onChange:function handleChange(e,t){r(t.map((function(e){return e.key})))},getOptionLabel:function getOptionLabel(e){return e.label},isOptionEqualToValue:function isOptionEqualToValue(e,t){return e.key===t.key},renderInput:function renderInput(e){return(0,k.jsx)(o.Z,(0,i.Z)((0,i.Z)({},e),{},{label:x,variant:"filled",InputLabelProps:{style:{color:p.palette.text.primary}},color:n.length?"success":"primary",type:"search"}))},renderOption:function renderOption(e,t){return(0,k.jsx)(MenuItemWithImage,{value:t.key,image:(0,k.jsx)(y.Z,{color:j.ZP.getVariant(t.key),children:d(t.key)}),text:(0,k.jsx)(y.Z,{color:j.ZP.getVariant(t.key),children:t.label}),theme:p,isSelected:n.includes(t.key),props:e},t.key)},renderTags:function renderTags(e,t){return e.map((function(e,n){var r=g.Kj.find((function(t){return e.key==="".concat(t,"_dmg_")})),a=r||void 0;return(0,f.createElement)(c.Z,(0,i.Z)((0,i.Z)({},t({index:n})),{},{key:e.key,icon:d(e.key),label:e.label,color:a}))}))}},h))}function ArtifactSetMultiAutocomplete(e){var t=e.artSetKeys,n=e.setArtSetKeys,s=(0,a.Z)(e,P),l=(0,Z.Z)((function(){return p.y.getAll}),[]),o=(0,h.$)(["artifact","artifactNames_gen"]).t;if(!l)return null;var c=Object.entries(p.y.setKeysByRarities(l)).flatMap((function(e){var t=(0,r.Z)(e,2),n=t[0];return t[1].map((function(e){return{key:e,grouper:+n}}))})).sort(sortByRarityAndName);return(0,k.jsx)(ArtifactMultiAutocomplete,(0,i.Z)({allArtifactKeysWithGrouper:c,selectedArtifactKeys:t,setArtifactKeys:n,getName:function getName(e){return o("artifactNames_gen:".concat(e))},getImage:function getImage(e){return l(e).defIcon},label:o("artifact:autocompleteLabels.sets"),groupBy:function groupBy(e){var t,n;return null!==(t=null===(n=e.grouper)||void 0===n?void 0:n.toString())&&void 0!==t?t:""},renderGroup:function renderGroup(e){return e.group&&(0,k.jsxs)(u.Z,{component:d.Z,children:[(0,k.jsxs)(x.Z,{sx:{top:"-1em"},children:[e.group," ",(0,k.jsx)(A.q,{stars:+e.group})]},"".concat(e.group,"Header")),e.children]},e.group)}},s))}function ArtifactMainStatMultiAutocomplete(e){var t=e.mainStatKeys,n=e.setMainStatKeys,r=(0,a.Z)(e,E),s=(0,h.$)("artifact").t;return(0,k.jsx)(ArtifactMultiAutocomplete,(0,i.Z)({allArtifactKeysWithGrouper:v.r.map((function(e){return{key:e}})),selectedArtifactKeys:t,setArtifactKeys:n,getName:function getName(e){return j.ZP.getArtStr(e)},getImage:function getImage(e){return D.Z[e]},label:s("autocompleteLabels.mainStats")},r))}function ArtifactSubstatMultiAutocomplete(e){var t=e.substatKeys,n=e.setSubstatKeys,r=(0,a.Z)(e,I),s=(0,h.$)("artifact").t;return(0,k.jsx)(ArtifactMultiAutocomplete,(0,i.Z)({allArtifactKeysWithGrouper:v._.map((function(e){return{key:e}})),selectedArtifactKeys:t,setArtifactKeys:n,getName:function getName(e){return j.ZP.getArtStr(e)},getImage:function getImage(e){return D.Z[e]},label:s("autocompleteLabels.substats")},r))}function ArtifactSingleAutocomplete(e){var t=e.allArtifactKeysWithGrouper,n=e.selectedArtifactKey,r=e.setArtifactKey,o=e.getName,c=e.getImage,u=e.label,d=e.disable,x=void 0===d?function(){return!1}:d,h=e.showDefault,p=void 0!==h&&h,m=e.defaultText,j=void 0===m?"":m,Z=(e.defaultIcon,(0,a.Z)(e,M)),v=(0,s.Z)(),g=(0,f.useMemo)((function(){return(p?[{key:"",label:j}]:[]).concat(t.map((function(e){var t=e.key,n=e.grouper;return{key:t,label:o(t),grouper:n}})))}),[t,o,j,p]);return(0,k.jsx)(l.Z,(0,i.Z)({autoHighlight:!0,options:g,clearIcon:n?void 0:"",value:{key:n,label:o(n)},onChange:function onChange(e,t,n){return("change"!==e.type||"clear"!==n)&&r(t?t.key:"")},getOptionLabel:function getOptionLabel(e){return e.label?e.label:j},isOptionEqualToValue:function isOptionEqualToValue(e,t){return e.key===t.key},getOptionDisabled:function getOptionDisabled(e){return x(e.key)},renderInput:function renderInput(e){return(0,k.jsx)(w.Z,(0,i.Z)((0,i.Z)({},e),{},{label:u,startAdornment:c(n),hasValue:!!n}))},renderOption:function renderOption(e,t){return(0,k.jsx)(MenuItemWithImage,{value:t.key,image:c(t.key),text:t.label,theme:v,isSelected:n===t.key,props:e},t.key)}},Z))}function ArtifactSetSingleAutocomplete(e){var t=e.artSetKey,n=e.setArtSetKey,s=e.label,l=void 0===s?"":s,o=(0,a.Z)(e,R),c=(0,Z.Z)((function(){return p.y.getAll}),[]),f=(0,h.$)(["artifact","artifactNames_gen"]).t;if(l=l||f("artifact:autocompleteLabels.set"),!c)return null;var m=Object.entries(p.y.setKeysByRarities(c)).flatMap((function(e){var t=(0,r.Z)(e,2),n=t[0];return t[1].map((function(e){return{key:e,grouper:+n}}))})).sort(sortByRarityAndName);return(0,k.jsx)(ArtifactSingleAutocomplete,(0,i.Z)({allArtifactKeysWithGrouper:m,selectedArtifactKey:t,setArtifactKey:n,getName:function getName(e){return e&&f("artifactNames_gen:".concat(e))},getImage:function getImage(e){return e?c(e).defIcon:(0,k.jsx)(k.Fragment,{})},label:l,groupBy:function groupBy(e){var t,n;return null!==(t=null===(n=e.grouper)||void 0===n?void 0:n.toString())&&void 0!==t?t:""},renderGroup:function renderGroup(e){return e.group&&(0,k.jsxs)(u.Z,{component:d.Z,children:[(0,k.jsxs)(x.Z,{sx:{top:"-1em"},children:[e.group," ",(0,k.jsx)(A.q,{stars:+e.group})]},"".concat(e.group,"Header")),e.children]},e.group)}},o))}function sortByRarityAndName(e,t){if(e.grouper>t.grouper)return-1;if(e.grouper<t.grouper)return 1;var n=m.Z.t("artifactNames_gen:".concat(e.key)),r=m.Z.t("artifactNames_gen:".concat(t.key));return n<r?-1:n>r?1:0}},21977:function(e,t,n){n.d(t,{Z:function(){return ArtifactLevelSlider}});var r=n(29439),i=n(57621),a=n(10889),s=n(72791),l=n(60393),o=n(10600),c=n(80184);function ArtifactLevelSlider(e){var t=e.levelLow,n=e.levelHigh,u=e.setLow,d=e.setHigh,x=e.setBoth,f=e.dark,h=void 0!==f&&f,p=e.disabled,m=void 0!==p&&p,j=e.showLevelText,Z=void 0!==j&&j,v=(0,s.useState)(t),g=(0,r.Z)(v,2),y=g[0],b=g[1],C=(0,s.useState)(n),S=(0,r.Z)(C,2),k=S[0],w=S[1],A=(0,s.useCallback)((function(e,t){if("number"==typeof t)throw new TypeError;var n=(0,r.Z)(t,2),i=n[0],a=n[1];b(i),w(a)}),[b,w]);return(0,s.useEffect)((function(){return b(t)}),[b,t]),(0,s.useEffect)((function(){return w(n)}),[w,n]),(0,c.jsxs)(i.Z,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:h?"contentDark.main":"contentLight.main"},children:[(0,c.jsx)(o.ZP,{value:y,onChange:function onChange(e){return u((0,l.uZ)(e,0,n))},sx:{px:1,pl:Z?2:void 0,width:Z?100:50},inputProps:{sx:{textAlign:Z?"right":"center"}},startAdornment:Z?"Level: ":void 0,disabled:m}),(0,c.jsx)(a.ZP,{sx:{width:100,flexGrow:1,mx:2},getAriaLabel:function getAriaLabel(){return"Arifact Level Range"},value:[y,k],onChange:A,onChangeCommitted:function onChangeCommitted(e,t){return x(t[0],t[1])},valueLabelDisplay:"auto",min:0,max:20,step:1,marks:!0,disabled:m}),(0,c.jsx)(o.ZP,{value:k,onChange:function onChange(e){return d((0,l.uZ)(e,t,20))},sx:{px:1,width:50},inputProps:{sx:{textAlign:"center"}},disabled:m})]})}},18726:function(e,t,n){n.d(t,{Z:function(){return CardHeaderCustom}});var r=n(64554),i=n(20890),a=n(80184);function CardHeaderCustom(e){var t=e.avatar,n=e.title,s=e.action;return(0,a.jsxs)(r.Z,{display:"flex",gap:1,p:2,alignItems:"center",children:[t,(0,a.jsx)(i.Z,{variant:"subtitle1",sx:{flexGrow:1},children:n}),s&&(0,a.jsx)(i.Z,{variant:"caption",children:s})]})}},37503:function(e,t,n){n.d(t,{X:function(){return HeaderDisplay},Z:function(){return DocumentDisplay}});var r=n(64554),i=n(20890),a=n(94721),s=n(72791),l=n(13746),o=n(60393),c=n(3992),u=n(18726),d=n(39504),x=n(88034),f=n(29439),h=n(72247),p=n(9912),m=n(24518),j=n(23786),Z=n(2199),v=n(97714),g=n(33890),y=n(25617),b=n(66624),C=n(80184);function ConditionalSelector(e){var t=e.conditional,n=e.disabled,r=void 0!==n&&n;return 1===Object.keys(t.states).length&&"path"in t?(0,C.jsx)(SimpleConditionalSelector,{conditional:t,disabled:r}):"path"in t?(0,C.jsx)(ExclusiveConditionalSelector,{conditional:t,disabled:r}):(0,C.jsx)(MultipleConditionalSelector,{conditional:t,disabled:r})}function SimpleConditionalSelector(e){var t=e.conditional,n=e.disabled,r=(0,s.useContext)(v.K),i=r.character,a=r.characterDispatch,c=(0,s.useContext)(l.R).data,u=(0,s.useCallback)((function(e){var n=(0,o.I8)(i.conditional);e?(0,o.SR)(n,t.path,e):(0,o.uH)(n,t.path),a({conditional:n})}),[t,i,a]),d=c.get(t.value).value,x=(0,f.Z)(Object.entries(t.states)[0],2),j=x[0],Z=getStateBadge(x[1].name),g=getCondName(t.name);return(0,C.jsxs)(m.Z,{fullWidth:!0,size:"small",sx:{borderRadius:0},color:d?"success":"primary",onClick:function onClick(){return u(d?void 0:j)},disabled:n,startIcon:d?(0,C.jsx)(h.Z,{}):(0,C.jsx)(p.Z,{}),children:[g," ",Z]})}function ExclusiveConditionalSelector(e){var t=e.conditional,n=e.disabled,r=(0,s.useContext)(v.K),i=r.character,c=r.characterDispatch,u=(0,s.useContext)(l.R).data,d=(0,s.useCallback)((function(e){var n=(0,o.I8)(i.conditional);e?(0,o.SR)(n,t.path,e):(0,o.uH)(n,t.path),c({conditional:n})}),[t,i,c]),x=u.get(t.value).value,h=x?t.states[x]:void 0,p=h?getStateBadge(h.name):(0,C.jsx)(y.Z,{color:"secondary",children:"Not Active"}),m=getCondName(t.name);return(0,C.jsxs)(g.Z,{fullWidth:!0,size:"small",sx:{borderRadius:0},color:x?"success":"primary",title:(0,C.jsxs)("span",{children:[m," ",p]}),disabled:n,children:[(0,C.jsx)(j.Z,{onClick:function onClick(){return d()},selected:!h,disabled:!h,children:(0,C.jsx)("span",{children:"Not Active"})}),(0,C.jsx)(a.Z,{}),Object.entries(t.states).map((function(e){var t=(0,f.Z)(e,2),n=t[0],r=t[1];return(0,C.jsx)(j.Z,{onClick:function onClick(){return d(n)},selected:x===n,disabled:x===n,children:r.name},n)}))]})}function MultipleConditionalSelector(e){var t=e.conditional,n=e.disabled,r=(0,s.useContext)(v.K),i=r.character,a=r.characterDispatch,c=(0,s.useContext)(l.R).data,u=(0,s.useCallback)((function(e,t){var n=(0,o.I8)(i.conditional);t?(0,o.SR)(n,e,t):(0,o.uH)(n,e),a({conditional:n})}),[i,a]);return(0,C.jsx)(Z.Z,{fullWidth:!0,orientation:"vertical",disableElevation:!0,color:"secondary",children:Object.entries(t.states).map((function(e){var t=(0,f.Z)(e,2),r=t[0],i=t[1],a=c.get(i.value).value,s=a===r;return(0,C.jsx)(m.Z,{color:s?"success":"primary",disabled:n,fullWidth:!0,onClick:function onClick(){return u(i.path,a?void 0:r)},size:"small",startIcon:s?(0,C.jsx)(h.Z,{}):(0,C.jsx)(p.Z,{}),sx:{borderRadius:0},children:getCondName(i.name)},r)}))})}function isElement(e){return"string"!==typeof e}function getStateBadge(e){if(!e)return"";var t="primary",n=e;return e&&isElement(e)&&e.props.color&&(t=e.props.color,n=(0,C.jsx)("span",{children:e.props.children})),(0,C.jsx)(y.Z,{sx:{ml:.5},color:t,children:n})}function getCondName(e){if(isElement(e)){var t=e.props.key18,n=e.props.ns,r=e.props.values;return(0,C.jsx)(b.v,{ns:n,key18:t,values:r,useBadge:!0})}return e}function ConditionalDisplay(e){var t,n=e.conditional,r=e.hideHeader,i=void 0!==r&&r,a=e.hideDesc,u=void 0!==a&&a,f=(0,s.useContext)(l.R).data;if("path"in n){var h,p=f.get(n.value).value;t=p&&(null===(h=n.states[p])||void 0===h?void 0:h.fields)}else t=Object.values(n.states).flatMap((function(e){return f.get(e.value).value?e.fields:[]}));return(0,C.jsxs)(c.Z,{children:[!(0,o.mY)(i,n)&&(0,C.jsx)(HeaderDisplay,{header:n.header,hideDesc:u}),(0,C.jsx)(d.Z,{sx:{p:0,"&:last-child":{pb:0}},children:(0,C.jsx)(ConditionalSelector,{conditional:n})}),t&&(0,C.jsx)(x.ZP,{fields:t})]})}var S=n(55221);function DocumentDisplay(e){var t=e.sections,n=e.teamBuffOnly,i=e.hideDesc,a=void 0!==i&&i,o=e.hideHeader,c=void 0!==o&&o,u=(0,s.useContext)(l.R).data;if(!t.length)return null;var d=t.map((function(e,t){return e.canShow&&!u.get(e.canShow).value||n&&!e.teamBuff?null:(0,C.jsx)(SectionDisplay,{section:e,hideDesc:a,hideHeader:c},t)})).filter((function(e){return e}));return d.length?(0,C.jsx)(r.Z,{display:"flex",flexDirection:"column",gap:1,children:d}):null}function SectionDisplay(e){var t=e.section,n=e.hideDesc,r=void 0!==n&&n,i=e.hideHeader,a=void 0!==i&&i;return"fields"in t?(0,C.jsx)(FieldsSectionDisplay,{section:t,hideDesc:r,hideHeader:a}):"states"in t?(0,C.jsx)(ConditionalDisplay,{conditional:t,hideDesc:r,hideHeader:a}):(0,C.jsx)(TextSectionDisplay,{section:t})}function FieldsSectionDisplay(e){var t=e.section,n=e.hideDesc,r=e.hideHeader;return(0,C.jsxs)(c.Z,{children:[!(0,o.mY)(r,t)&&t.header&&(0,C.jsx)(HeaderDisplay,{header:t.header,hideDesc:n,hideDivider:0===t.fields.length}),(0,C.jsx)(x.ZP,{fields:t.fields})]})}function TextSectionDisplay(e){var t=e.section,n=(0,s.useContext)(l.R).data;return(0,C.jsx)("div",{children:(0,o.mY)(t.text,n)})}function HeaderDisplay(e){var t=e.header,n=e.hideDesc,r=e.hideDivider,c=(0,s.useContext)(l.R).data,d=t.icon,x=t.title,f=t.action;d=(0,o.mY)(d,c);var h=!n&&(0,o.mY)(t.description,c),p=n?x:(0,C.jsxs)("span",{children:[x," ",(0,C.jsx)(S.Z,{title:(0,C.jsx)(i.Z,{children:h})})]});return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(u.Z,{avatar:d,title:p,action:f}),!r&&(0,C.jsx)(a.Z,{})]})}},29371:function(e,t,n){n.d(t,{Z:function(){return LevelSelect}});var r=n(29439),i=n(93433),a=n(2199),s=n(24518),l=n(23786),o=n(72791),c=n(22020),u=n(2139),d=n(60393),x=n(10600),f=n(33890),h=n(80184);function LevelSelect(e){var t=e.level,n=e.ascension,p=e.setBoth,m=e.useLow,j=void 0!==m&&m,Z=(0,c.$)("ui").t,v=j?u.sU:u.SJ,g=(0,o.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e=(0,d.uZ)(e,1,j?u.d8:u.Qq);var t=v.findIndex((function(t){return e<=t}));p({level:e,ascension:t})}),[p,v,j]),y=(0,o.useCallback)((function(){var e=v.findIndex((function(e){return 90!==t&&t===e}));p(n===e?{ascension:n+1}:{ascension:e})}),[p,v,n,t]);return(0,h.jsxs)(a.Z,{sx:{bgcolor:function bgcolor(e){return e.palette.contentDark.main}},children:[(0,h.jsx)(x.CC,{children:(0,h.jsx)(x.ZP,{onChange:g,value:t,startAdornment:"Lv. ",inputProps:{min:1,max:90,sx:{textAlign:"center",width:"3em"}},sx:{height:"100%",pl:2}})}),(0,h.jsx)(s.Z,{sx:{pl:1,whiteSpace:"nowrap"},disabled:!(j?u.nB:u.ek)(t),onClick:y,children:(0,h.jsxs)("strong",{children:["/ ",u.SJ[n]]})}),(0,h.jsx)(f.Z,{title:Z("selectlevel"),sx:{flexGrow:1},children:(0,i.Z)(j?u.vF:u.D4).map((function(e){var i=(0,r.Z)(e,2),a=i[0],s=i[1],o=a===t&&s===n;return(0,h.jsx)(l.Z,{selected:o,disabled:o,onClick:function onClick(){return p({level:a,ascension:s})},children:a===v[s]?"Lv. ".concat(a):"Lv. ".concat(a,"/").concat(v[s])},"".concat(a,"/").concat(s))}))})]})}},6805:function(e,t,n){n.d(t,{Z:function(){return RefinementDropdown}});var r=n(23786),i=n(22020),a=n(24351),s=n(33890),l=n(80184);function RefinementDropdown(e){var t=e.refinement,n=e.setRefinement,o=(0,i.$)("ui").t;return(0,l.jsx)(s.Z,{title:o("refinement",{value:t}),children:a.a.map((function(e){return(0,l.jsx)(r.Z,{onClick:function onClick(){return n(e)},selected:t===e,disabled:t===e,children:o("refinement",{value:e})},e)}))})}},92443:function(e,t,n){n.d(t,{Z:function(){return TextButton}});var r=n(1413),i=n(45987),a=n(66934),s=n(24518),l=n(80184),o=["children","disabled"],c=(0,a.ZP)(s.Z)((function(e){var t=e.theme;return{"&.Mui-disabled":{backgroundColor:t.palette.primary.dark,color:t.palette.text.secondary}}}));function TextButton(e){var t=e.children,n=(e.disabled,(0,i.Z)(e,o));return(0,l.jsx)(c,(0,r.Z)((0,r.Z)({},n),{},{disabled:!0,children:t}))}},16325:function(e,t,n){n.r(t),n.d(t,{default:function(){return CharacterDisplay}});var r=n(30168),i=n(29439),a=n(63833),s=n(45781),l=n(35893),o=n(10284),c=n(31289),u=n(68575),d=n(66630),x=n(64554),f=n(47047),h=n(39504),p=n(25228),m=n(43896),j=n(24518),Z=n(72791),v=n(22020),g=n(43504),y=n(16871),b=n(3992),C=n(71310),S=n(68198),k=n(32490),w=n(29371),A=n(25617),D=n(97714),K=n(13746),P=n(60705),E=(0,Z.createContext)({}),I=n(947),M=n(66101),R=n(24711),B=n(13434),T=n(50920),O=n(12761),_=n(42320),N=n(47639),L=n(72056),W=n(24351),F=n(40663),G=n(2380),q=n(566),z=n(80184),V=Z.lazy((function(){return n.e(381).then(n.bind(n,4332))}));function CharSelectDropdown(){var e,t=(0,v.$)("page_character").t,n=(0,Z.useContext)(D.K).characterSheet,r=(0,Z.useState)(!1),a=(0,i.Z)(r,2),s=a[0],l=a[1],o=(0,q.Z)();return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Z.Suspense,{fallback:!1,children:(0,z.jsx)(V,{show:s,onHide:function onHide(){return l(!1)},onSelect:o})}),(0,z.jsx)(j.Z,{color:"info",onClick:function onClick(){return l(!0)},startIcon:(0,z.jsx)(G.Z,{src:null===n||void 0===n?void 0:n.thumbImgSide}),children:null!==(e=null===n||void 0===n?void 0:n.name)&&void 0!==e?e:t("selectCharacter")})]})}var H=n(37355),$=n(9585),U=n(94721),Y=n(89673),J=n(55818),X=n(20890),Q=n(3721),ee=n(63210),te=n(18726),ne=n(91702),re=n(55942),ie=n(9321),ae=n(8430),se=n(18327);function FormulaModal(){var e=(0,Z.useContext)(P.M).modalOpen,t=(0,Z.useContext)(P.M).setFormulaData,n=(0,Z.useCallback)((function(){return null===t||void 0===t?void 0:t(void 0,void 0)}),[t]);return(0,z.jsx)(ie.Z,{open:!!e,onClose:n,children:(0,z.jsxs)(b.Z,{children:[(0,z.jsx)($.Z,{title:"Formulas & Calculations",action:(0,z.jsx)(S.Z,{onClick:n})}),(0,z.jsx)(h.Z,{sx:{pt:0},children:(0,z.jsx)(CalculationDisplay,{})})]})})}function CalculationDisplay(){var e=(0,Z.useContext)(K.R).data,t=(0,Z.useContext)(P.M).data,n=(0,ae.U)(null!==t&&void 0!==t?t:e);return(0,z.jsx)(Z.Suspense,{fallback:(0,z.jsx)(f.Z,{variant:"rectangular",width:"100%",height:1e3}),children:(0,z.jsx)(x.Z,{sx:{mr:-1,mb:-1},children:n.map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return(0,z.jsx)(FormulaCalc,{displayNs:r,sectionKey:n},n)}))})})}function FormulaCalc(e){var t=e.sectionKey,n=e.displayNs,r=(0,Z.useContext)(K.R).data,a=(0,Z.useContext)(M.t).database,s=(0,Z.useContext)(P.M).data,l=(0,_.Z)((function(){return(0,ae.f)(null!==s&&void 0!==s?s:r,t,a)}),[s,r,t]);if(!l)return null;if(Object.entries(n).every((function(e){var t=(0,i.Z)(e,2);t[0];return t[1].isEmpty})))return null;var o=l.title,c=l.icon,u=l.action;return(0,z.jsxs)(C.Z,{sx:{mb:1},children:[(0,z.jsx)(te.Z,{avatar:c&&(0,z.jsx)(re.Z,{size:2,sx:{m:-1},src:c}),title:o,action:u&&(0,z.jsx)(A.Z,{children:u})}),(0,z.jsx)(U.Z,{}),(0,z.jsx)(h.Z,{children:Object.entries(n).map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return!r.isEmpty&&(0,z.jsx)(FormulaAccordian,{node:r},n)}))})]})}function FormulaAccordian(e){var t=e.node,n=(0,Z.useContext)(P.M).node,r=(0,Z.useState)(!1),a=(0,i.Z)(r,2),s=a[0],l=a[1],o=(0,Z.useCallback)((function(e,t){return l(t)}),[]),c=(0,Z.useRef)();return(0,Z.useEffect)((function(){t===n&&setTimeout((function(){var e,t;return null===c||void 0===c||null===(e=c.current)||void 0===e||null===(t=e.scrollIntoView)||void 0===t?void 0:t.call(e,{behavior:"smooth"})}),300)}),[c,t,n]),(0,z.jsxs)(Y.Z,{sx:{bgcolor:"contentDark.main"},expanded:t===n||s,onChange:o,ref:c,children:[(0,z.jsxs)(J.Z,{expandIcon:(0,z.jsx)(H.Z,{}),children:[(0,z.jsxs)(X.Z,{children:[(0,z.jsx)(ne.Z,{color:t.info.variant,children:t.info.name})," ",(0,z.jsx)("strong",{children:(0,se.p)(t)})]}),W.jU.includes(t.info.variant)&&(0,z.jsx)(x.Z,{sx:{display:"inline-block",ml:"auto",mr:2},children:(0,z.jsx)(ee.Z,{reaction:t.info.variant,trigger:t.info.subVariant})})]}),(0,z.jsx)(Q.Z,{children:t.formulas.map((function(e,t){return(0,z.jsx)(X.Z,{component:"div",children:e},t)}))})]})}var le,oe=n(93433),ce=n(53767),ue=n(61889),de=n(15021),xe=n(1413),fe=n(49670),he=n(72247),pe=n(9912),me=n(81918),je=n(56125),Ze=n(27235),ve=n(79406),ge=n(45987),ye=n(66934),be=n(13400),Ce=["expand"],Se=(0,ye.ZP)((function(e){e.expand;var t=(0,ge.Z)(e,Ce);return(0,z.jsx)(be.Z,(0,xe.Z)({},t))}))((function(e){var t=e.theme;return{transform:e.expand?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest})}})),ke=n(75545),we=n(2199),Ae=n(10600),De=n(92443),Ke=["name","children","value","placeholder","defaultValue","onValueChange","percent","disabled","onReset"],Pe=(0,ye.ZP)(we.Z)({display:"flex"});function StatInput(e){var t=e.name,n=e.children,r=e.value,i=e.placeholder,a=e.defaultValue,s=void 0===a?0:a,l=e.onValueChange,o=e.percent,c=void 0!==o&&o,u=e.disabled,d=void 0!==u&&u,x=e.onReset,f=(0,ge.Z)(e,Ke);return(0,z.jsxs)(Pe,(0,xe.Z)((0,xe.Z)({},f),{},{children:[n,(0,z.jsx)(De.Z,{sx:{px:1},children:t}),(0,z.jsx)(Ae.CC,{sx:{flexBasis:"10em",flexGrow:1},children:(0,z.jsx)(Ae.ZP,{sx:{px:1},inputProps:{sx:{textAlign:"right"}},float:c,placeholder:i,value:r,onChange:l,disabled:d,endAdornment:c?"%":void 0})}),(0,z.jsx)(j.Z,{sx:{flexShrink:2},size:"small",color:"error",onClick:function onClick(){return x?x():l(s)},disabled:d||r===s,children:(0,z.jsx)(fe.Z,{})})]}))}function EnemyExpandCard(){var e=(0,v.$)("ui").t,t=(0,Z.useContext)(D.K).characterDispatch,n=(0,Z.useContext)(K.R).data,a=(0,Z.useState)(!1),s=(0,i.Z)(a,2),l=s[0],o=s[1],c=(0,Z.useCallback)((function(){return o(!l)}),[o,l]),u=n.get(Ze.ri.enemy.level),d=n.get(Ze.ri.enemy.defRed),f=n.get(Ze.ri.enemy.defIgn),p=(0,Z.useCallback)((function(){return t({enemyOverride:{}})}),[t]);return(0,z.jsxs)(C.Z,{children:[(0,z.jsxs)(h.Z,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap"},children:[(0,z.jsx)(me.Z,{size:"small",color:"success",label:(0,z.jsxs)("span",{children:[u.info.name," ",(0,z.jsx)("strong",{children:u.value})]})}),W.Kj.map((function(e){return(0,z.jsx)(X.Z,{children:(0,z.jsx)(EnemyResText,{element:e})},e)})),(0,z.jsxs)(X.Z,{children:["DEF Red. ",(0,se.p)(d)]}),(0,z.jsxs)(X.Z,{children:["DEF Ignore ",(0,se.p)(f)]}),(0,z.jsxs)(x.Z,{flexGrow:1,display:"flex",justifyContent:"flex-end",gap:1,children:[(0,z.jsx)(j.Z,{size:"small",color:"error",onClick:p,startIcon:(0,z.jsx)(fe.Z,{}),children:e(le||(le=(0,r.Z)(["reset"])))}),(0,z.jsx)(Se,{expand:l,onClick:c,"aria-expanded":l,"aria-label":"show more",size:"small",sx:{marginLeft:0},children:(0,z.jsx)(H.Z,{})})]})]}),(0,z.jsx)(je.Z,{in:l,timeout:"auto",unmountOnExit:!0,children:(0,z.jsx)(h.Z,{sx:{pt:0},children:(0,z.jsx)(EnemyEditor,{})})})]})}function EnemyResText(e){var t=e.element,n=(0,Z.useContext)(K.R).data.get(Ze.ri.enemy["".concat(t,"_res_")]),r=!isFinite(n.value)?(0,z.jsxs)("span",{children:[ke.Z[t]," \u221e"]}):(0,z.jsxs)("span",{children:[ke.Z[t]," ",(0,z.jsx)("strong",{children:(0,se.p)(n)})]});return(0,z.jsx)(ne.Z,{color:t,children:r})}function EnemyEditor(e){var t,n,r,i=e.bsProps,a=void 0===i?{xs:12,md:6}:i,s=(0,Z.useContext)(D.K),l=s.character.enemyOverride,o=s.characterDispatch,c=(0,Z.useContext)(K.R).data,u=null!==(t=l.enemyLevel)&&void 0!==t?t:c.get(Ze.ri.lvl).value,d=null!==(n=l.enemyDefIgn_)&&void 0!==n?n:0,x=null!==(r=l.enemyDefRed_)&&void 0!==r?r:0;return(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,children:[(0,z.jsx)(ue.ZP,(0,xe.Z)((0,xe.Z)({item:!0},a),{},{children:(0,z.jsx)(j.Z,{fullWidth:!0,sx:{height:"100%"},size:"small",component:"a",color:"warning",href:"https://genshin-impact.fandom.com/wiki/Resistance#Base_Enemy_Resistances",target:"_blank",rel:"noreferrer",children:"To get the specific resistance values of enemies, please visit the wiki."})})),(0,z.jsx)(ue.ZP,(0,xe.Z)((0,xe.Z)({item:!0},a),{},{children:(0,z.jsx)(StatInput,{sx:{bgcolor:function bgcolor(e){return e.palette.contentLight.main},width:"100%"},name:(0,z.jsx)("b",{children:ve.ZP.get("enemyLevel")}),value:u,placeholder:ve.ZP.getStr("enemyLevel"),defaultValue:c.get(Ze.ri.lvl).value,onValueChange:function onValueChange(e){return o({type:"enemyOverride",statKey:"enemyLevel",value:e})},onReset:function onReset(){return o({type:"enemyOverride",statKey:"enemyLevel",value:void 0})}})})),W.Kj.map((function(e){var t="".concat(e,"_enemyRes_"),n=l[t],r=n===Number.MAX_VALUE;return(0,z.jsx)(ue.ZP,(0,xe.Z)((0,xe.Z)({item:!0},a),{},{children:(0,z.jsx)(StatInput,{sx:{bgcolor:function bgcolor(e){return e.palette.contentLight.main},width:"100%"},name:(0,z.jsx)(ne.Z,{color:e,children:(0,z.jsx)("b",{children:ve.ZP.get(t)})}),value:void 0!==n?r?1/0:n:10,placeholder:r?"\u221e ":ve.ZP.getStr(t),defaultValue:10,onValueChange:function onValueChange(e){return o({type:"enemyOverride",statKey:t,value:e})},disabled:r,percent:!0,children:(0,z.jsx)(j.Z,{color:e,onClick:function onClick(){return o({type:"enemyOverride",statKey:t,value:r?10:Number.MAX_VALUE})},startIcon:r?(0,z.jsx)(he.Z,{}):(0,z.jsx)(pe.Z,{}),children:"Immunity"})})}),e)})),(0,z.jsx)(ue.ZP,(0,xe.Z)((0,xe.Z)({item:!0},a),{},{children:(0,z.jsx)(StatInput,{sx:{bgcolor:function bgcolor(e){return e.palette.contentLight.main},width:"100%"},name:(0,z.jsx)("b",{children:ve.ZP.get("enemyDefIgn_")}),value:d,placeholder:ve.ZP.getStr("enemyDefIgn_"),defaultValue:0,onValueChange:function onValueChange(e){return o({type:"enemyOverride",statKey:"enemyDefIgn_",value:e})},percent:!0})})),(0,z.jsx)(ue.ZP,(0,xe.Z)((0,xe.Z)({item:!0},a),{},{children:(0,z.jsx)(StatInput,{sx:{bgcolor:function bgcolor(e){return e.palette.contentLight.main},width:"100%"},name:(0,z.jsx)("b",{children:ve.ZP.get("enemyDefRed_")}),value:x,placeholder:ve.ZP.getStr("enemyDefRed_"),defaultValue:0,onValueChange:function onValueChange(e){return o({type:"enemyOverride",statKey:"enemyDefRed_",value:e})},percent:!0})})),(0,z.jsx)(ue.ZP,{item:!0,xs:12,children:(0,z.jsx)("small",{children:"Note: Genshin Impact halves resistance shred values below 0%. For the sake of calculations enter the RAW value and GO will do the rest. (e.g. 10% - 20% = -10%)"})})]})}var Ee,Ie=n(88034),Me=n(43696),Re={xs:1,md:2,lg:3};function StatModal(e){var t=e.open,n=e.onClose,i=(0,v.$)("page_character").t;return(0,z.jsx)(ie.Z,{open:t,onClose:n,children:(0,z.jsxs)(b.Z,{children:[(0,z.jsx)($.Z,{title:i(Ee||(Ee=(0,r.Z)(["addStats.title"]))),action:(0,z.jsx)(S.Z,{onClick:n})}),(0,z.jsx)(h.Z,{sx:{pt:0},children:(0,z.jsxs)(ce.Z,{spacing:1,children:[(0,z.jsx)(BonusStatsEditor,{}),(0,z.jsx)(EnemyExpandCard,{}),(0,z.jsx)(MainStatsCards,{})]})})]})})}var Be=(0,oe.Z)(Ze.lR),Te=function wrapperFunc(e,t){return(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:e},t)};function BonusStatsEditor(){var e=(0,Z.useContext)(D.K),t=e.character.bonusStats,n=e.characterDispatch,r=(0,Z.useCallback)((function(e){return n({bonusStats:e})}),[n]);return(0,z.jsx)(C.Z,{children:(0,z.jsx)(h.Z,{sx:{display:"flex"},children:(0,z.jsx)(ue.ZP,{container:!0,columns:Re,sx:{pt:1},spacing:1,children:(0,z.jsx)(Me.Z,{statKeys:Be,statFilters:t,setStatFilters:r,wrapperFunc:Te})})})})}var Oe=["eleMas","critRate_","critDMG_","enerRech_","heal_"],_e=[].concat(["hp","atk","def"],Oe).map((function(e){return Ze.ri.total[e]})),Ne=["atk_","atk","hp_","hp","def_","def"].concat(Oe),Le=[].concat((0,oe.Z)(ve.hX),(0,oe.Z)(ve.Sx),["stamina","incHeal_","shield_","cdRed_"]),We=Ze.lR.filter((function(e){return!Ne.includes(e)&&!Le.includes(e)}));function StatDisplayContent(e){var t=e.nodes,n=e.extra,r=(0,Z.useContext)(K.R),i=r.data,a=r.oldData,s=(0,Z.useContext)(P.M).setFormulaData;return(0,z.jsxs)(Ie.lD,{children:[t.map((function(e){var t;return(0,z.jsx)(Ie.JW,{component:de.ZP,node:i.get(e),oldValue:null===a||void 0===a||null===(t=a.get(e))||void 0===t?void 0:t.value,data:i,setFormulaData:s},JSON.stringify(e.info))})),n]})}function MainStatsCards(){var e=(0,Z.useContext)(D.K).characterSheet,t=(0,Z.useContext)(K.R).data,n=t.get(Ze.ri.special),r=e.elementKey,i=e.isMelee(),a=(0,Z.useMemo)((function(){return Le.filter((function(e){return!e.includes(r)&&(i&&e.includes("physical"),!0)})).map((function(e){return Ze.ri.total[e]})).filter((function(e){return!!t.get(e).value}))}),[t,r,i]),s=(0,Z.useMemo)((function(){return We.map((function(e){return Ze.ri.total[e]})).filter((function(e){return t.get(e).value}))}),[t]);return(0,z.jsx)(C.Z,{children:(0,z.jsx)(h.Z,{children:(0,z.jsxs)(ue.ZP,{container:!0,columns:Re,spacing:1,children:[(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(StatDisplayCard,{title:"Main Stats",children:(0,z.jsx)(StatDisplayContent,{nodes:_e,extra:n&&(0,z.jsxs)(de.ZP,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,z.jsxs)("span",{children:[(0,z.jsx)("b",{children:"Special:"})," ",(0,z.jsxs)(ne.Z,{color:n.info.variant,children:[n.info.icon," ",n.info.name]})]}),(0,z.jsx)("span",{children:(0,se.p)(n)})]})})})}),(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(StatDisplayCard,{title:"Other Stats",children:(0,z.jsx)(StatDisplayContent,{nodes:a})})}),!!s.length&&(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(StatDisplayCard,{title:"Misc Stats",children:(0,z.jsx)(StatDisplayContent,{nodes:s})})})]})})})}function StatDisplayCard(e){var t=e.title,n=e.children;return(0,z.jsxs)(b.Z,{children:[(0,z.jsx)(h.Z,{sx:{py:1},children:(0,z.jsx)(x.Z,{display:"flex",justifyContent:"space-between",children:(0,z.jsx)(X.Z,{variant:"subtitle1",children:t})})}),n]})}var Fe=n(74165),Ge=n(15861),qe=n(96739),ze=n(59496),Ve=n(23786),He=n(90388),$e=n(94070),Ue=n(23060),Ye=n(76899),Je=n(21977),Xe=n(96106),Qe=n(30865),et=n(33890),tt=n(91839),nt=(0,Z.createContext)(void 0),rt=n(53960),it=n(73036),at=n(69292),st=n(68544),lt=n(70645),ot=n(60393),ct=n(9138),ut=n(37762),dt=n(64737),xt=n(78661),ft=(0,Fe.Z)().mark(filterFeasiblePerm),ht=(0,Fe.Z)().mark(artSetPerm);function pruneAll(e,t,n,r,i,a){for(var s=a,l={pruneNodeRange:!0},o={pruneNodeRange:!0},c={reaffine:!0},u={pruneOrder:!0,pruneArtRange:!0,pruneNodeRange:!0},d=0;Object.values(s).some((function(e){return e}))&&d++<20;){if(s.pruneOrder){delete s.pruneOrder;var x=pruneOrder(n,r,i);n!==x&&(n=x,s=(0,xe.Z)((0,xe.Z)({},s),l))}if(s.pruneArtRange){delete s.pruneArtRange;var f=pruneArtRange(e,n,t);n!==f&&(n=f,s=(0,xe.Z)((0,xe.Z)({},s),o))}if(s.pruneNodeRange){delete s.pruneNodeRange;var h=pruneNodeRange(e,n);e!==h&&(e=h,s=(0,xe.Z)((0,xe.Z)({},s),c))}if(s.reaffine){delete s.reaffine;var p=reaffine(e,n),m=p.nodes,j=p.arts;e===m&&n===j||(e=m,n=j,s=(0,xe.Z)((0,xe.Z)({},s),u))}}return{nodes:e,arts:n}}function pruneExclusion(e,t){for(var n={},r=0,a=Object.entries(t);r<a.length;r++){var s=(0,i.Z)(a[r],2),l=s[0],o=s[1];o.includes(4)&&(n[l]=o.includes(2)?1:3)}return(0,dt.uW)(e,(function(e){return e}),(function(e){if("threshold"!==e.operation)return e;var r=(0,i.Z)(e.operands,4),a=r[0],s=r[1],l=r[2],o=r[3];if("read"===a.operation&&"const"===s.operation){var c=a.path[a.path.length-1],u=s.value;if(c in n){if(n[c]<u)return o;if(2===u&&t[c].includes(2))return(0,xt.Lj)(a,4,l,o)}}return e}))}function reaffine(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=new Set,a=new Set;function visit(e,t){t?r.add(e):e.operands.forEach((function(e){return r.has(e)&&a.add(e)}))}var s=new Set;if((0,dt.aD)(e,(function(e){}),(function(e){var t=e.operation;switch(t){case"read":s.add(e.path[1]),visit(e,!0);break;case"add":visit(e,e.operands.every((function(e){return r.has(e)})));break;case"mul":var n=e.operands.filter((function(e){return"const"!==e.operation}));visit(e,0===n.length||1===n.length&&r.has(n[0]));break;case"const":visit(e,!0);break;case"res":case"threshold":case"sum_frac":case"max":case"min":visit(e,!1);break;default:(0,ot.UT)(t)}})),(0,oe.Z)(a).every((function(e){var t=e.operation;return"read"===t||"const"===t}))&&Object.keys(t.base).length===s.size)return{nodes:e,arts:t};var l=-1;function nextDynKey(){for(;s.has("".concat(++l)););return"".concat(l)}e.forEach((function(e){return r.has(e)&&a.add(e)}));var o=(0,oe.Z)(a).filter((function(e){return"const"!==e.operation})),c=new Map(o.map((function(e){return[e,n||"read"!==e.operation||"dyn"!==e.path[0]?(0,xe.Z)((0,xe.Z)({},(0,xt.UF)(["dyn","".concat(nextDynKey())])),{},{accu:"add"}):e]})));function reaffineArt(e){var t=(0,at.CG)((0,oe.Z)(c.keys()),{dyn:(0,ot.xh)(e,(function(e){return(0,xt.a9)(e)}))},(function(e){return!0}));return Object.fromEntries((0,oe.Z)(c.values()).map((function(e,n){return[e.path[1],t[n].value]})))}for(var u={nodes:e=(0,dt.uW)(e,(function(e){var t;return null!==(t=c.get(e))&&void 0!==t?t:e}),(function(e){return e})),arts:{base:reaffineArt(t.base),values:(0,ot.O)(W.eV,(function(e){return t.values[e].map((function(e){return{id:e.id,set:e.set,values:reaffineArt(e.values)}}))}))}},d=Object.entries(reaffineArt({})),x=0,f=Object.values(u.arts.values);x<f.length;x++){var h,p=f[x],m=(0,ut.Z)(p);try{for(m.s();!(h=m.n()).done;){var j,Z=h.value.values,v=(0,ut.Z)(d);try{for(v.s();!(j=v.n()).done;){var g=(0,i.Z)(j.value,2),y=g[0],b=g[1];Z[y]-=b}}catch(C){v.e(C)}finally{v.f()}}}catch(C){m.e(C)}finally{m.f()}}return u}function pruneOrder(e,t,n){var r,a=!1,s=!(null!==(r=n.rainbow)&&void 0!==r&&r.length),l=Object.keys(e.base),o=new Set(Object.entries(n).filter((function(e){var t=(0,i.Z)(e,2);t[0];return t[1].length})).map((function(e){return(0,i.Z)(e,1)[0]}))),c=new Set(Object.entries(n).filter((function(e){var t=(0,i.Z)(e,2),n=(t[0],t[1]);return n.includes(2)&&!n.includes(4)})).map((function(e){return(0,i.Z)(e,1)[0]}))),u=(0,ot.O)(W.eV,(function(n){var r=e.values[n],i=r.filter((function(e){var n=0;return r.every((function(r){var i=l.every((function(t){var n,i;return(null!==(n=r.values[t])&&void 0!==n?n:0)>=(null!==(i=e.values[t])&&void 0!==i?i:0)})),a=l.some((function(t){var n,i;return(null!==(n=r.values[t])&&void 0!==n?n:0)>(null!==(i=e.values[t])&&void 0!==i?i:0)})),u=i&&(a||r.id>e.id),d=s&&!o.has(r.set)&&!c.has(e.set)||e.set===r.set;return u&&d&&n++,n<t}))}));return i.length!==r.length&&(a=!0),i}));return a?{base:e.base,values:u}:e}function pruneArtRange(e,t,n){for(var r=Object.fromEntries(Object.entries(t.base).map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return[n,{min:r,max:r}]}))),a={arts:t},s=function _loop(){var t=(0,ot.O)(W.eV,(function(e){return computeArtRange(a.arts.values[e])})),i=(0,ot.O)(W.eV,(function(e){return addArtRange(Object.entries(t).map((function(t){return t[0]===e?r:t[1]})).filter((function(e){return e})))})),s=!1,l=(0,ot.O)(W.eV,(function(t){var r=a.arts.values[t].filter((function(r){var a=addArtRange([computeArtRange([r]),i[t]]),s=computeNodeRange(e,a);return e.every((function(e,t){var r;return s.get(e).max>=(null!==(r=n[t])&&void 0!==r?r:-1/0)}))}));return r.length!==a.arts.values[t].length&&(s=!0),r}));if(!s)return"break";a.arts={base:a.arts.base,values:l}};;){if("break"===s())break}return a.arts}function pruneNodeRange(e,t){var n=computeNodeRange(e,addArtRange([Object.fromEntries(Object.entries(t.base).map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return[n,{min:r,max:r}]})))].concat((0,oe.Z)(Object.values(t.values).map((function(e){return computeArtRange(e)}))))));return(0,dt.uW)(e,(function(e){var t=n.get(e),r=t.min;if(r===t.max)return(0,xt.a9)(r);var a=e.operation,s=e.operands.map((function(e){return n.get(e)}));switch(a){case"threshold":var l=(0,i.Z)(s,4),o=l[0],c=l[1],u=l[2],d=l[3];if(o.min>=c.max)return e.operands[2];if(o.max<c.min)return e.operands[3];if(u.max===u.min&&d.max===d.min&&u.min===d.min&&isFinite(u.min))return(0,xt.a9)(u.max);break;case"min":var x=e.operands.filter((function(e,t){var n=s[t];return s.every((function(e,t){return n.min<=e.max}))}));if(x.length<s.length)return xt.VV.apply(void 0,(0,oe.Z)(x));break;case"max":var f=e.operands.filter((function(e,t){var n=s[t];return s.every((function(e){return n.max>=e.min}))}));if(f.length<s.length)return xt.Fp.apply(void 0,(0,oe.Z)(f))}return e}),(function(e){return e}))}function addArtRange(e){var t={};return e.forEach((function(e){Object.entries(e).forEach((function(e){var n=(0,i.Z)(e,2),r=n[0],a=n[1];t[r]?(t[r].min+=a.min,t[r].max+=a.max):t[r]=(0,xe.Z)({},a)}))})),t}function computeArtRange(e){var t={};return e.length&&(Object.keys(e[0].values).filter((function(t){return e.every((function(e){return e.values[t]}))})).forEach((function(n){return t[n]={min:e[0].values[n],max:e[0].values[n]}})),e.forEach((function(e){for(var n=e.values,r=0,a=Object.entries(n);r<a.length;r++){var s=(0,i.Z)(a[r],2),l=s[0],o=s[1];t[l]?(t[l].max<o&&(t[l].max=o),t[l].min>o&&(t[l].min=o)):t[l]={min:0,max:o}}}))),t}function computeNodeRange(e,t){var n=new Map;return(0,dt.aD)(e,(function(e){}),(function(e){var r,a,s=e.operation,l=e.operands.map((function(e){return n.get(e)}));switch(s){case"read":if("dyn"!==e.path[0])throw new Error("Found non-dyn path ".concat(e.path," while computing range"));a=null!==(r=t[e.path[1]])&&void 0!==r?r:{min:0,max:0};break;case"const":a=computeMinMax([e.value]);break;case"add":case"min":case"max":a={min:at.aj[s](l.map((function(e){return e.min}))),max:at.aj[s](l.map((function(e){return e.max})))};break;case"res":a={min:at.aj[s]([l[0].max]),max:at.aj[s]([l[0].min])};break;case"mul":a=l.reduce((function(e,t){return computeMinMax([e.min*t.min,e.min*t.max,e.max*t.min,e.max*t.max])}));break;case"threshold":a=l[0].min>=l[1].max?l[2]:l[0].max<l[1].min?l[3]:computeMinMax([],[l[2],l[3]]);break;case"sum_frac":var o=(0,i.Z)(l,2),c=o[0],u=o[1],d={min:c.min+u.min,max:c.max+u.max};a=d.min<=0&&d.max>=0?c.min<=0&&c.max>=0?{min:NaN,max:NaN}:{min:-1/0,max:1/0}:computeMinMax([c.min/d.min,c.min/d.max,c.max/d.min,c.max/d.max]);break;default:(0,ot.UT)(s)}n.set(e,a)})),n}function computeMinMax(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Math.max.apply(Math,(0,oe.Z)(e).concat((0,oe.Z)(t.map((function(e){return e.max}))))),r=Math.min.apply(Math,(0,oe.Z)(e).concat((0,oe.Z)(t.map((function(e){return e.min})))));return{min:r,max:n}}function mergeBuilds(e,t){return e.flatMap((function(e){return e})).sort((function(e,t){return t.value-e.value})).slice(0,t)}function mergePlot(e){for(var t=.01,n=new Set(e.flatMap((function(e){return Object.values(e).map((function(e){return Math.round(e.plot/t)}))})));n.size>1500;)t*=2,n=new Set((0,oe.Z)(n).map((function(e){return Math.round(e/2)})));var r,i={},a=(0,ut.Z)(e);try{for(a.s();!(r=a.n()).done;)for(var s=r.value,l=0,o=Object.values(s);l<o.length;l++){var c=o[l],u=Math.round(c.plot/t)*t;(!i[u]||i[u].value<c.value)&&(i[u]=c)}}catch(d){a.e(d)}finally{a.f()}return i}function filterFeasiblePerm(e,t){var n,r,a,s,l,o,c;return(0,Fe.Z)().wrap((function filterFeasiblePerm$(u){for(;;)switch(u.prev=u.next){case 0:n=(0,ot.xh)(t.values,(function(e){return new Set(e.map((function(e){return e.set})))})),r=(0,ut.Z)(e),u.prev=2,r.s();case 4:if((a=r.n()).done){u.next=19;break}s=a.value,l=function _loop2(){var e=(0,i.Z)(c[o],2),t=e[0],r=e[1],a=n[t];switch(r.kind){case"required":if((0,oe.Z)(r.sets).every((function(e){return!a.has(e)})))return"continue|filter_loop";break;case"exclude":if((0,oe.Z)(a).every((function(e){return r.sets.has(e)})))return"continue|filter_loop"}},o=0,c=Object.entries(s);case 8:if(!(o<c.length)){u.next=15;break}if("continue|filter_loop"!==l()){u.next=12;break}return u.abrupt("continue",17);case 12:o++,u.next=8;break;case 15:return u.next=17,s;case 17:u.next=4;break;case 19:u.next=24;break;case 21:u.prev=21,u.t0=u.catch(2),r.e(u.t0);case 24:return u.prev=24,r.f(),u.finish(24);case 27:case"end":return u.stop()}}),ft,null,[[2,21,24,27]])}function exclusionToAllowed(e){return new Set(null!==e&&void 0!==e&&e.includes(2)?e.includes(4)?[0,1]:[0,1,4,5]:null!==e&&void 0!==e&&e.includes(4)?[0,1,2,3]:[0,1,2,3,4,5])}function artSetPerm(e,t){var n,r,a,s,l,o,c,u,d,x,f,h,p,m,j,Z;return(0,Fe.Z)().wrap((function artSetPerm$(v){for(;;)switch(v.prev=v.next){case 0:for(p=function _check2(e){var t,i,a,s,l,o,c,u,d,p,m;return(0,Fe.Z)().wrap((function check$(n){for(;;)switch(n.prev=n.next){case 0:m=function _check_free(e){var t,n,a,s,o,c,u,d,p,j,Z,v,g,y;return(0,Fe.Z)().wrap((function check_free$(i){for(;;)switch(i.prev=i.next){case 0:t=l.length-e,n=[],a=[],s=[],o=0,c=(0,ut.Z)(r),i.prev=3,d=function _loop6(){var e=u.value,r=h[e],i=f[e];if(!r)return"continue";(0,ot.w6)(1,t).every((function(e){return!r.has(i+e)}))?s.push(e):r.has(i)?(0,ot.w6)(0,t).some((function(e){return!r.has(i+e)}))&&n.push(e):(o+=(0,oe.Z)(r).find((function(e){return e>i}))-i,a.push(e))},c.s();case 6:if((u=c.n()).done){i.next=12;break}if("continue"!==d()){i.next=10;break}return i.abrupt("continue",10);case 10:i.next=6;break;case 12:i.next=17;break;case 14:i.prev=14,i.t0=i.catch(3),c.e(i.t0);case 17:return i.prev=17,c.f(),i.finish(17);case 20:if(!(o>t)){i.next=22;break}return i.abrupt("return");case 22:if(e!==l.length){i.next=26;break}return i.next=25,(0,xe.Z)({},x);case 25:return i.abrupt("return");case 26:if(o!==t){i.next=47;break}p=(0,ut.Z)(a),i.prev=28,p.s();case 30:if((j=p.n()).done){i.next=38;break}return Z=j.value,f[Z]++,x[W.eV[l[e]]]={kind:"required",sets:new Set([Z])},i.delegateYield(m(e+1),"t1",35);case 35:f[Z]--;case 36:i.next=30;break;case 38:i.next=43;break;case 40:i.prev=40,i.t2=i.catch(28),p.e(i.t2);case 43:return i.prev=43,p.f(),i.finish(43);case 46:return i.abrupt("return");case 47:v=0,g=[].concat(n,a);case 48:if(!(v<g.length)){i.next=57;break}return y=g[v],f[y]++,x[W.eV[l[e]]]={kind:"required",sets:new Set([y])},i.delegateYield(m(e+1),"t3",53);case 53:f[y]--;case 54:v++,i.next=48;break;case 57:return x[W.eV[l[e]]]={kind:"exclude",sets:new Set([].concat(a,s,n))},i.delegateYield(m(e+1),"t4",59);case 59:case"end":return i.stop()}}),i,null,[[3,14,17,20],[28,40,43,46]])},p=function _check(e){var n,i,l;return(0,Fe.Z)().wrap((function check$(t){for(;;)switch(t.prev=t.next){case 0:if(e!==s.length){t.next=3;break}return t.delegateYield(m(0),"t0",2);case 2:return t.abrupt("return",t.t0);case 3:n=(0,ut.Z)(r),t.prev=4,l=(0,Fe.Z)().mark((function _loop5(){var t,n,r,l,o;return(0,Fe.Z)().wrap((function _loop5$(c){for(;;)switch(c.prev=c.next){case 0:if(t=i.value,!a.has(t)){c.next=3;break}return c.abrupt("return","continue");case 3:if(n=s[e].length,r=h[t],l=0,!r||r.has(n)){c.next=9;break}if(!((l=(null!==(o=(0,ot.w6)(n+1,5).find((function(e){return r.has(e)})))&&void 0!==o?o:6)-n)>d)){c.next=9;break}return c.abrupt("return","continue");case 9:return a.add(t),f[t]=s[e].length,s[e].forEach((function(e){return x[W.eV[e]]={kind:"required",sets:new Set([t])}})),d-=l,c.delegateYield(p(e+1),"t0",14);case 14:d+=l,f[t]=0,a.delete(t);case 17:case"end":return c.stop()}}),_loop5)})),n.s();case 7:if((i=n.n()).done){t.next=14;break}return t.delegateYield(l(),"t1",9);case 9:if("continue"!==t.t1){t.next=12;break}return t.abrupt("continue",12);case 12:t.next=7;break;case 14:t.next=19;break;case 16:t.prev=16,t.t2=t.catch(4),n.e(t.t2);case 19:return t.prev=19,n.f(),t.finish(19);case 22:case"end":return t.stop()}}),t,null,[[4,16,19,22]])},t=(0,Fe.Z)().mark(p),i=(0,Fe.Z)().mark(m),a=new Set,s=[],l=[],o=(0,ut.Z)(e);try{for(o.s();!(c=o.n()).done;)u=c.value,s.push([]),5===u?l.push(s.length-1):s[u].push(s.length-1)}catch(j){o.e(j)}finally{o.f()}return s=s.filter((function(e){return e.length})).sort((function(e,t){return t.length-e.length})),d=l.length,n.delegateYield(p(0),"t0",10);case 10:case"end":return n.stop()}}),n)},o=function _indexOfShape(e,t){if(!(0,ot.w6)(t+1,4).some((function(t){return 5!==e[t]})))return(e=(0,oe.Z)(e))[t]=5,e.reduce((function(e,t){return 6*e+t}),0)},l=function _populateShapes(e,t,n){if(5!==e.length){var r,i=(0,ut.Z)(t);try{var o=function _loop3(){var i=r.value;l([].concat((0,oe.Z)(e),[i]),t,n.filter((function(e){return e!==i})))};for(i.s();!(r=i.n()).done;)o()}catch(c){i.e(c)}finally{i.f()}l([].concat((0,oe.Z)(e),[e.length]),new Set([].concat((0,oe.Z)(t),[e.length])),[].concat((0,oe.Z)(n),[e.length]))}else a.has(n.length)&&s.push(e)},n=(0,Fe.Z)().mark(p),r=(0,oe.Z)(new Set(t)),a=exclusionToAllowed(e.rainbow),s=[],l([0],new Set([0]),[0]),c=function _loop4(e){var t,n=new Map,r=(0,ut.Z)(s);try{for(r.s();!(t=r.n()).done;){var a,l=t.value,c=o(l,e);void 0!==c&&n.set(c,(null!==(a=n.get(c))&&void 0!==a?a:new Set(l.slice(0,e)).size+1)-1)}}catch(f){r.e(f)}finally{r.f()}var u,d=(0,ut.Z)(n.entries());try{var x=function _loop7(){var t=(0,i.Z)(u.value,2),n=t[0];if(0===t[1]){var r=(0,oe.Z)(s.find((function(t){return o(t,e)===n})));r[e]=5,s=s.filter((function(t){return o(t,e)!==n})),s.push(r)}};for(d.s();!(u=d.n()).done;)x()}catch(f){d.e(f)}finally{d.f()}},u=4;u>=0;u--)c(u);d={kind:"exclude",sets:new Set},x=(0,ot.O)(W.eV,(function(e){return d})),f=(0,xe.Z)((0,xe.Z)({},(0,ot.xh)(e,(function(e){return 0}))),(0,ot.O)(r,(function(e){return 0}))),h=(0,ot.xh)(e,exclusionToAllowed),m=(0,ut.Z)(s),v.prev=14,m.s();case 16:if((j=m.n()).done){v.next=21;break}return Z=j.value,v.delegateYield(p(Z),"t0",19);case 19:v.next=16;break;case 21:v.next=26;break;case 23:v.prev=23,v.t1=v.catch(14),m.e(v.t1);case 26:return v.prev=26,m.f(),v.finish(26);case 29:case"end":return v.stop()}}),ht,null,[[14,23,26,29]])}var pt=n(53174),mt=n(54483),jt=n(16614),Zt=n(31148),vt=n(37503);function SetEffectDisplay(e){var t,n=e.setKey,r=e.setNumKey,i=e.hideHeader,a=void 0!==i&&i,s=e.conditionalsOnly,l=void 0!==s&&s,o=(0,_.Z)((function(){return Zt.y.get(n)}),[n]);if(!o)return null;var c=l?null===(t=o.setEffectDocument(r))||void 0===t?void 0:t.filter((function(e){return"states"in e})):o.setEffectDocument(r);return(0,z.jsx)(x.Z,{display:"flex",flexDirection:"column",children:c?(0,z.jsx)(vt.Z,{sections:c,hideHeader:a}):null})}var gt,yt,bt,Ct,St,kt,wt,At,Dt,Kt,Pt,Et,It,Mt,Rt,Bt,Tt=n(95614),Ot=n(55221),_t=n(10157),Nt=n(66624);function useBuildSetting(e){var t=(0,Z.useContext)(M.t).database,n=(0,Z.useState)((function(){return t.buildSettings.get(e)})),r=(0,i.Z)(n,2),a=r[0],s=r[1];return(0,Z.useEffect)((function(){return s(t.buildSettings.get(e))}),[t,e]),(0,Z.useEffect)((function(){return t.buildSettings.follow(e,(function(e,t,n){return"update"===t&&s(n)}))}),[e,s,t]),{buildSetting:a,buildSettingDispatch:(0,Z.useCallback)((function(n){return e&&t.buildSettings.set(e,n)}),[e,t])}}function ArtifactSetConfig(e){var t,n,a=e.disabled,s=(0,v.$)(["page_character_optimize","sheet"]).t,l=(0,Z.useContext)(K.R),o=(0,Z.useContext)(M.t).database,c=(0,Z.useContext)(D.K),u=c.character,d=u.key,f=u.conditional,p=c.characterDispatch,m=useBuildSetting(d),g=m.buildSetting.artSetExclusion,y=m.buildSettingDispatch,k=(0,Z.useState)(!1),w=(0,i.Z)(k,2),P=w[0],E=w[1],I=(0,Z.useCallback)((function(){return E(!0)}),[E]),R=(0,Z.useCallback)((function(){return E(!1)}),[E]),B=(0,_.Z)((function(){return Zt.y.getAll}),[]),T=(0,st.Z)(),O=(0,i.Z)(T,2),N=O[0],L=O[1];(0,Z.useEffect)((function(){return o.arts.followAny(L)}),[o,L]);var F=(0,Z.useMemo)((function(){return B?Object.entries(Zt.y.setKeysByRarities(B)).reverse().flatMap((function(e){return(0,i.Z)(e,2)[1]})).filter((function(e){return!e.includes("Prayers")})):[]}),[B]),G=(0,Z.useMemo)((function(){var e=(0,ot.O)(F,(function(e){return(0,ot.O)(W.eV,(function(e){return 0}))}));o.arts.values.forEach((function(t){return e[t.setKey]&&e[t.setKey][t.slotKey]++}));var t=(0,oe.Z)(F).sort((function(t,n){return+(getNumSlots(e[t])<2)-+(getNumSlots(e[n])<2)}));return N&&{artKeys:t,artSlotCount:e}}),[N,o,F]),q=G.artKeys,V=G.artSlotCount,H=!(null!==(t=g.rainbow)&&void 0!==t&&t.includes(2)),$=!(null!==(n=g.rainbow)&&void 0!==n&&n.includes(4)),Y=(0,Z.useMemo)((function(){return{allow2:F.filter((function(e){var t;return!(null!==(t=g[e])&&void 0!==t&&t.includes(2))})).length,allow4:F.filter((function(e){var t;return!(null!==(t=g[e])&&void 0!==t&&t.includes(4))})).length}}),[F,g]),J=Y.allow2,Q=Y.allow4,ee=F.length-J,te=F.length-Q,re=(0,Z.useMemo)((function(){return Object.keys(f).filter((function(e){return W.q2.includes(e)&&0!==Object.keys(f[e]).length})).length}),[f]),ae=(0,Z.useMemo)((function(){return(0,xe.Z)((0,xe.Z)({},l),{},{data:new se.w((0,xe.Z)((0,xe.Z)({},l.data.data[0]),{},{artSet:(0,ot.O)(W.q2,(function(e){return(0,xt.a9)(4)}))}),void 0)})}),[l]),le=(0,Z.useCallback)((function(){var e=Object.fromEntries(Object.entries(f).filter((function(e){var t=(0,i.Z)(e,2),n=t[0];t[1];return!W.q2.includes(n)})));p({conditional:e})}),[f,p]),de=(0,Z.useCallback)((function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=(0,ot.I8)(g);F.forEach((function(r){var i;t?n[r]=[].concat((0,oe.Z)(null!==(i=n[r])&&void 0!==i?i:[]),[e]):n[r]&&(n[r]=n[r].filter((function(t){return t!==e})))})),y({artSetExclusion:n})}),[F,g,y]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(C.Z,{sx:{display:"flex"},children:[(0,z.jsxs)(h.Z,{sx:{flexGrow:1},children:[(0,z.jsx)(X.Z,{children:(0,z.jsx)("strong",{children:s(gt||(gt=(0,r.Z)(["artSetConfig.title"])))})}),(0,z.jsxs)(ce.Z,{spacing:1,children:[(0,z.jsxs)(X.Z,{children:[s(yt||(yt=(0,r.Z)(["artSetConfig.setEffCond"])))," ",(0,z.jsxs)(A.Z,{color:re?"success":"secondary",children:[re," ",s("artSetConfig.enabled")]})]}),(0,z.jsxs)(X.Z,{children:[s(bt||(bt=(0,r.Z)(["sheet:2set"])))," ",(0,z.jsxs)(A.Z,{color:"success",children:[J," ",(0,z.jsx)(mt.G,{icon:pt.Stf,className:"fa-fw"})," ",s("artSetConfig.allowed")]}),!!ee&&" / ",!!ee&&(0,z.jsxs)(A.Z,{color:"secondary",children:[ee," ",(0,z.jsx)(mt.G,{icon:pt.gPx,className:"fa-fw"})," ",s("artSetConfig.excluded")]})]}),(0,z.jsxs)(X.Z,{children:[s(Ct||(Ct=(0,r.Z)(["sheet:4set"])))," ",(0,z.jsxs)(A.Z,{color:"success",children:[Q," ",(0,z.jsx)(mt.G,{icon:pt.Stf,className:"fa-fw"})," ",s("artSetConfig.allowed")]}),!!te&&" / ",!!te&&(0,z.jsxs)(A.Z,{color:"secondary",children:[te," ",(0,z.jsx)(mt.G,{icon:pt.gPx,className:"fa-fw"})," ",s("artSetConfig.excluded")]})]}),(0,z.jsxs)(X.Z,{children:[s(St||(St=(0,r.Z)(["artSetConfig.2rainbow"])))," ",(0,z.jsxs)(A.Z,{color:H?"success":"secondary",children:[(0,z.jsx)(mt.G,{icon:H?pt.Stf:pt.gPx,className:"fa-fw"})," ",H?s("artSetConfig.allowed"):"Excluded"]})]}),(0,z.jsxs)(X.Z,{children:[s(kt||(kt=(0,r.Z)(["artSetConfig.4rainbow"])))," ",(0,z.jsxs)(A.Z,{color:$?"success":"secondary",children:[(0,z.jsx)(mt.G,{icon:$?pt.Stf:pt.gPx,className:"fa-fw"})," ",$?s("artSetConfig.allowed"):"Excluded"]})]})]})]}),(0,z.jsx)(j.Z,{onClick:I,disabled:a,color:"info",sx:{borderRadius:0},children:(0,z.jsx)(jt.Z,{})})]}),B&&(0,z.jsx)(ie.Z,{open:P,onClose:R,children:(0,z.jsxs)(b.Z,{children:[(0,z.jsxs)(h.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[(0,z.jsx)(X.Z,{variant:"h6",children:s(wt||(wt=(0,r.Z)(["artSetConfig.title"])))}),(0,z.jsx)(S.Z,{onClick:R})]}),(0,z.jsx)(U.Z,{}),(0,z.jsxs)(h.Z,{children:[(0,z.jsx)(C.Z,{sx:{mb:1},children:(0,z.jsxs)(h.Z,{children:[(0,z.jsxs)(x.Z,{display:"flex",gap:1,children:[(0,z.jsx)(X.Z,{children:(0,z.jsx)("strong",{children:s(At||(At=(0,r.Z)(["artSetConfig.modal.setCond.title"])))})}),(0,z.jsx)(X.Z,{sx:{flexGrow:1},children:(0,z.jsxs)(A.Z,{color:re?"success":"secondary",children:[re," ",s("artSetConfig.selected")]})}),(0,z.jsx)(j.Z,{size:"small",onClick:le,color:"error",startIcon:(0,z.jsx)(fe.Z,{}),children:s(Dt||(Dt=(0,r.Z)(["artSetConfig.modal.setCond.reset"])))})]}),(0,z.jsx)(X.Z,{children:s(Kt||(Kt=(0,r.Z)(["artSetConfig.modal.setCond.text"])))})]})}),(0,z.jsx)(C.Z,{sx:{mb:1},children:(0,z.jsxs)(h.Z,{children:[(0,z.jsx)(X.Z,{sx:{flexGrow:1},children:(0,z.jsx)("strong",{children:(0,z.jsxs)(Ye.c,{t:s,i18nKey:"artSetConfig.modal.ArtSetFilter.title",children:["Artifact Sets ",(0,z.jsxs)(ne.Z,{color:"success",children:["Allowed",(0,z.jsx)(mt.G,{icon:pt.Stf,className:"fa-fw"})]})," / ",(0,z.jsxs)(ne.Z,{color:"secondary",variant:"light",children:["Excluded",(0,z.jsx)(mt.G,{icon:pt.gPx,className:"fa-fw"})]})]})})}),(0,z.jsx)(X.Z,{children:(0,z.jsxs)(Ye.c,{t:s,i18nKey:"artSetConfig.modal.ArtSetFilter.intro",children:["You can allow/exclude which sets you want the builder to consider. In the following examples, ",(0,z.jsx)("strong",{children:"A"})," is on-set, and ",(0,z.jsx)("strong",{children:"R"})," is rainbow(off-set)"]})}),(0,z.jsx)(X.Z,{children:(0,z.jsxs)(Ye.c,{t:s,i18nKey:"artSetConfig.modal.ArtSetFilter.2set",children:[(0,z.jsx)("strong",{children:(0,z.jsxs)(ne.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.jsx)(mt.G,{icon:pt.gPx,className:"fa-fw"})," 2-Set"]})})," would exclude 2-Set builds: ",(0,z.jsxs)("strong",{children:[(0,z.jsx)(ne.Z,{color:"secondary",variant:"light",children:"AA"}),"RRR"]})," and ",(0,z.jsxs)("strong",{children:[(0,z.jsx)(ne.Z,{color:"secondary",variant:"light",children:"AAA"}),"RR"]}),"."]})}),(0,z.jsx)(X.Z,{children:(0,z.jsxs)(Ye.c,{t:s,i18nKey:"artSetConfig.modal.ArtSetFilter.4set",children:[(0,z.jsx)("strong",{children:(0,z.jsxs)(ne.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.jsx)(mt.G,{icon:pt.gPx,className:"fa-fw"})," 4-Set"]})})," would exclude 4-Set builds: ",(0,z.jsxs)("strong",{children:[(0,z.jsx)(ne.Z,{color:"secondary",variant:"light",children:"AAAA"}),"R"]})," and ",(0,z.jsx)("strong",{children:(0,z.jsx)(ne.Z,{color:"secondary",variant:"light",children:"AAAAA"})}),"."]})}),(0,z.jsx)(X.Z,{children:(0,z.jsxs)(Ye.c,{t:s,i18nKey:"artSetConfig.modal.ArtSetFilter.2rain",children:[(0,z.jsx)("strong",{children:(0,z.jsxs)(ne.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.jsx)(mt.G,{icon:pt.gPx,className:"fa-fw"})," 3-Rainbow"]})})," would exclude 2-Set + 3-Rainbow builds: ",(0,z.jsxs)("strong",{children:["AA",(0,z.jsx)(ne.Z,{color:"secondary",variant:"light",children:"RRR"})]})," and ",(0,z.jsxs)("strong",{children:["AAA",(0,z.jsx)(ne.Z,{color:"secondary",variant:"light",children:"RR"})]}),"."]})}),(0,z.jsx)(X.Z,{children:(0,z.jsxs)(Ye.c,{t:s,i18nKey:"artSetConfig.modal.ArtSetFilter.4rain",children:[(0,z.jsx)("strong",{children:(0,z.jsxs)(ne.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.jsx)(mt.G,{icon:pt.gPx,className:"fa-fw"})," 5-Rainbow"]})})," would exclude full 5-Rainbow builds: ",(0,z.jsx)("strong",{children:(0,z.jsx)(ne.Z,{color:"secondary",variant:"light",children:"RRRRR"})}),"."]})})]})}),(0,z.jsxs)(ue.ZP,{container:!0,columns:{xs:2,lg:3},sx:{mb:1},spacing:1,children:[(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(AllSetAllowExcludeCard,{setNum:2,numAllow:J,numExclude:ee,setAllExclusion:de})}),(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(AllSetAllowExcludeCard,{setNum:4,numAllow:Q,numExclude:te,setAllExclusion:de})}),(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(C.Z,{children:(0,z.jsxs)(h.Z,{children:[(0,z.jsx)(X.Z,{gutterBottom:!0,children:(0,z.jsx)("strong",{children:(0,z.jsxs)(Ye.c,{t:s,i18nKey:"artSetConfig.alExRainbow",children:[(0,z.jsxs)(ne.Z,{color:"success",children:["Allow ",(0,z.jsx)(mt.G,{icon:pt.Stf,className:"fa-fw"})]})," / ",(0,z.jsxs)(ne.Z,{color:"secondary",variant:"light",children:["Exclude ",(0,z.jsx)(mt.G,{icon:pt.gPx,className:"fa-fw"})]})," Rainbow Builds"]})})}),(0,z.jsxs)(x.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.jsx)(j.Z,{fullWidth:!0,onClick:function onClick(){return y({type:"artSetExclusion",setKey:"rainbow",num:2})},color:H?"success":"secondary",startIcon:H?(0,z.jsx)(he.Z,{}):(0,z.jsx)(pe.Z,{}),endIcon:(0,z.jsx)(mt.G,{icon:H?pt.Stf:pt.gPx,className:"fa-fw"}),children:s(Pt||(Pt=(0,r.Z)(["artSetConfig.2rainbow"])))}),(0,z.jsx)(j.Z,{fullWidth:!0,onClick:function onClick(){return y({type:"artSetExclusion",setKey:"rainbow",num:4})},color:$?"success":"secondary",startIcon:$?(0,z.jsx)(he.Z,{}):(0,z.jsx)(pe.Z,{}),endIcon:(0,z.jsx)(mt.G,{icon:$?pt.Stf:pt.gPx,className:"fa-fw"}),children:s(Et||(Et=(0,r.Z)(["artSetConfig.4rainbow"])))})]})]})})})]}),(0,z.jsx)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,lg:3},children:q.map((function(e){return(0,z.jsx)(ArtifactSetCard,{setKey:e,sheet:B(e),fakeDataContextObj:ae,slotCount:V[e]},e)}))})]}),(0,z.jsx)(U.Z,{}),(0,z.jsx)(h.Z,{sx:{py:1},children:(0,z.jsx)(S.Z,{large:!0,onClick:R})})]})})]})}function AllSetAllowExcludeCard(e){var t=e.numAllow,n=e.numExclude,r=e.setNum,i=e.setAllExclusion,a=(0,v.$)(["page_character_optimize","sheet"]).t;return(0,z.jsx)(C.Z,{children:(0,z.jsxs)(h.Z,{children:[(0,z.jsxs)(X.Z,{gutterBottom:!0,children:[(0,z.jsx)("strong",{children:a("sheet:".concat(r,"set"))})," ",(0,z.jsxs)(A.Z,{color:"success",children:[t," ",(0,z.jsx)(mt.G,{icon:pt.Stf,className:"fa-fw"})," ",a("artSetConfig.allowed")]}),!!n&&" / ",!!n&&(0,z.jsxs)(A.Z,{color:"secondary",children:[n," ",(0,z.jsx)(mt.G,{icon:pt.gPx,className:"fa-fw"})," ",a("artSetConfig.excluded")]})]}),(0,z.jsxs)(x.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.jsx)(j.Z,{fullWidth:!0,disabled:!n,onClick:function onClick(){return i(r,!1)},color:"success",startIcon:(0,z.jsx)(mt.G,{icon:pt.Stf,className:"fa-fw"}),children:a("artSetConfig.allowAll".concat(r,"set"))}),(0,z.jsx)(j.Z,{fullWidth:!0,disabled:!t,onClick:function onClick(){return i(r,!0)},color:"secondary",startIcon:(0,z.jsx)(mt.G,{icon:pt.gPx,className:"fa-fw"}),children:a("artSetConfig.excludeAll".concat(r,"set"))})]})]})})}function ArtifactSetCard(e){var t,n,a,s=e.sheet,l=e.setKey,o=e.fakeDataContextObj,c=e.slotCount,u=(0,v.$)("sheet").t,d=useBuildSetting((0,Z.useContext)(D.K).character.key),f=d.buildSetting,p=d.buildSettingDispatch,m=null!==(t=null===f||void 0===f||null===(n=f.artSetExclusion)||void 0===n?void 0:n[l])&&void 0!==t?t:[],g=!m.includes(4),y=(0,Z.useMemo)((function(){return getNumSlots(c)}),[c]),b=(0,Z.useMemo)((function(){return!g||y<4?[]:Object.keys(s.setEffects).filter((function(e){var t;return null===(t=s.setEffects[e])||void 0===t?void 0:t.document.some((function(e){return"states"in e}))}))}),[s.setEffects,g,y]),S=m.includes(2),k=m.includes(4);return(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsxs)(C.Z,{sx:{height:"100%",opacity:y<2?"50%":void 0},children:[(0,z.jsxs)(x.Z,{className:"grad-".concat(s.rarity[0],"star"),width:"100%",sx:{display:"flex"},children:[(0,z.jsx)(x.Z,{component:"img",src:s.defIconSrc,sx:{height:100,width:"auto",mx:-1}}),(0,z.jsxs)(x.Z,{sx:{flexGrow:1,px:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,z.jsx)(X.Z,{variant:"h6",children:null!==(a=s.name)&&void 0!==a?a:""}),(0,z.jsxs)(x.Z,{display:"flex",gap:1,children:[(0,z.jsx)(X.Z,{variant:"subtitle1",children:s.rarity.map((function(e,t){return(0,z.jsxs)("span",{children:[e," ",(0,z.jsx)(_t.q,{stars:1})," ",t<s.rarity.length-1?"/ ":null]},e)}))}),(0,z.jsx)(Ot.Z,{title:(0,z.jsxs)(x.Z,{children:[(0,z.jsx)(X.Z,{children:(0,z.jsx)(A.Z,{color:"success",children:u(It||(It=(0,r.Z)(["2set"])))})}),(0,z.jsx)(X.Z,{children:(0,z.jsx)(Nt.v,{ns:"artifact_".concat(l,"_gen"),key18:"setEffects.2"})}),(0,z.jsxs)(x.Z,{paddingTop:2,sx:{opacity:m.includes(4)?.6:1},children:[(0,z.jsx)(X.Z,{children:(0,z.jsx)(A.Z,{color:"success",children:u(Mt||(Mt=(0,r.Z)(["4set"])))})}),(0,z.jsx)(X.Z,{children:(0,z.jsx)(Nt.v,{ns:"artifact_".concat(l,"_gen"),key18:"setEffects.4"})})]})]})})]}),(0,z.jsx)(x.Z,{sx:{display:"flex",gap:1},children:Object.entries(c).map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return(0,z.jsx)(X.Z,{sx:{flexGrow:1},variant:"subtitle2",children:(0,z.jsxs)(A.Z,{sx:{width:"100%"},color:r?"primary":"secondary",children:[(0,Tt.Ir)(n),r]})},n)}))})]})]}),(0,z.jsxs)(we.Z,{sx:{".MuiButton-root":{borderRadius:0}},fullWidth:!0,children:[y>=2&&(0,z.jsx)(j.Z,{startIcon:S?(0,z.jsx)(pe.Z,{}):(0,z.jsx)(he.Z,{}),onClick:function onClick(){return p({type:"artSetExclusion",setKey:l,num:2})},color:S?"secondary":"success",endIcon:(0,z.jsx)(mt.G,{icon:S?pt.gPx:pt.Stf,className:"fa-fw"}),children:u(Rt||(Rt=(0,r.Z)(["2set"])))}),y>=4&&(0,z.jsx)(j.Z,{startIcon:k?(0,z.jsx)(pe.Z,{}):(0,z.jsx)(he.Z,{}),onClick:function onClick(){return p({type:"artSetExclusion",setKey:l,num:4})},color:k?"secondary":"success",endIcon:(0,z.jsx)(mt.G,{icon:k?pt.gPx:pt.Stf,className:"fa-fw"}),children:u(Bt||(Bt=(0,r.Z)(["4set"])))})]}),!!b.length&&(0,z.jsx)(K.R.Provider,{value:o,children:(0,z.jsx)(h.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:b.map((function(e){return(0,z.jsx)(SetEffectDisplay,{setKey:l,setNumKey:parseInt(e),hideHeader:!0,conditionalsOnly:!0},e)}))})})]})},l)}function getNumSlots(e){return Object.values(e).reduce((function(e,t){return e+(t?1:0)}),0)}var Lt=[0,4,8,12,16,20];function AssumeFullLevelToggle(e){var t=e.mainStatAssumptionLevel,n=void 0===t?0:t,r=e.setmainStatAssumptionLevel,i=e.disabled,a=(0,v.$)("page_character_optimize").t;return(0,z.jsx)(et.Z,{fullWidth:!0,color:n?"success":"primary",disabled:i,title:n?a("mainStat.assumptionLvl.lvl",{lvl:n}):a("mainStat.assumptionLvl.no"),children:Lt.map((function(e){return(0,z.jsx)(Ve.Z,{onClick:function onClick(){return r(e)},children:e?a("mainStat.assumptionLvl.lvl",{lvl:e}):a("mainStat.assumptionLvl.no")},e)}))})}function BonusStatsCard(){var e=(0,Z.useContext)(D.K).character.bonusStats,t=(0,Z.useContext)(K.R).data,n=(0,Z.useContext)(P.M).setFormulaData,r=Object.keys(e);if(!r.length)return null;var i=r.map((function(e){return t.get(Ze.ri.customBonus[e])}));return(0,z.jsxs)(C.Z,{children:[(0,z.jsx)(h.Z,{children:(0,z.jsx)(X.Z,{children:"Bonus Stats"})}),(0,z.jsx)(U.Z,{}),(0,z.jsx)(h.Z,{children:i.map((function(e){return(0,z.jsx)(Ie.JW,{node:e,data:t,setFormulaData:n},JSON.stringify(e.info))}))})]})}var Wt=n(57482),Ft=n(52771),Gt=(0,ye.ZP)("strong")({fontFamily:"monospace"}),qt=(0,ye.ZP)(Wt.Z)((function(e){e.theme;return{height:10,borderRadius:5}}));function BuildAlert(e){var t=e.status,n=t.type,r=t.tested,i=(t.failed,t.skipped),a=t.total,s=t.startTime,l=t.finishTime,o=e.characterName,c=isFinite(a),u="inactive"!==n,d=a-i,x=(0,z.jsx)(Gt,{children:r.toLocaleString()}),f=(0,z.jsx)(Gt,{children:d.toLocaleString()}),h=!!i&&(0,z.jsxs)("span",{children:["(",(0,z.jsx)("b",{children:(0,z.jsx)(Gt,{children:i.toLocaleString()})})," skipped)"]}),p=(0,z.jsx)(Gt,{children:(0,Ft.e6)(Math.round((null!==l&&void 0!==l?l:performance.now())-(null!==s&&void 0!==s?s:NaN)))}),m="",j="",Z=void 0;if(u)Z=100*r/d,m=(0,z.jsxs)(X.Z,{children:["Generating and testing ",x,c?(0,z.jsxs)(z.Fragment,{children:["/",f]}):void 0," build configurations against the criteria for ",(0,z.jsx)("b",{children:o}),". ",h]}),j=(0,z.jsxs)(X.Z,{children:["Time elapsed: ",p]});else{if(!(r+i))return null;Z=100,m=(0,z.jsxs)(X.Z,{children:["Generated and tested ",x," Build configurations against the criteria for ",(0,z.jsx)("b",{children:o}),". ",h]}),j=(0,z.jsxs)(X.Z,{children:["Total duration: ",p]})}return(0,z.jsxs)($e.Z,{severity:"success",variant:"filled",sx:{"& .MuiAlert-message":{flexGrow:1}},children:[m,j,void 0!==Z&&(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,alignItems:"center",children:[c&&(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsx)(X.Z,{children:"".concat(Z.toFixed(1),"%")})}),(0,z.jsx)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.jsx)(qt,{variant:c?"determinate":"indeterminate",value:Z,color:"primary"})})]})]})}var zt=n(19701),Vt=n(98268),Ht=n(63204),$t=n(66647),Ut=n(13967),Yt=n(12065),Jt=n(10658),Xt=n(98620),Qt=n(63372),en=n(20005),tn=n(87174),nn=n(64929);function ArtifactCardNano(e){var t,n,r=e.artifactId,i=e.slotKey,a=e.mainStatAssumptionLevel,s=void 0===a?0:a,l=e.showLocation,o=void 0!==l&&l,c=e.onClick,u=e.BGComponent,d=void 0===u?b.Z:u,f=(0,Qt.Z)(r),h=(0,Z.useContext)(M.t).database,p=(0,_.Z)((function(){return Zt.y.get(null===f||void 0===f?void 0:f.setKey)}),[null===f||void 0===f?void 0:f.setKey]),m=(0,Z.useCallback)((function(e){return(0,z.jsx)($t.Z,{onClick:c,sx:{height:"100%"},children:e})}),[c]),j=(0,Ut.Z)();if(!f)return(0,z.jsx)(d,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center"},children:(0,z.jsx)(x.Z,{component:"img",src:Jt.Z.slot[i],sx:{width:"25%",height:"auto",opacity:.7}})});var v=f.slotKey,g=f.rarity,y=f.level,C=f.mainStatKey,S=f.substats,k=f.location,w=Math.max(Math.min(s,4*g),y),A=ve.ZP.unit(C),D=W.Kj.find((function(e){return f.mainStatKey.includes(e)})),K=D?(0,Yt.Fq)(j.palette[D].main,.6):(0,Yt.Fq)(j.palette.secondary.main,.6);return(0,z.jsx)(d,{sx:{height:"100%"},children:(0,z.jsx)(en.Z,{condition:!!c,wrapper:m,children:(0,z.jsxs)(x.Z,{display:"flex",height:"100%",children:[(0,z.jsxs)(x.Z,{className:"grad-".concat(g,"star"),sx:{position:"relative",flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,z.jsx)(nn.Z,{art:f,children:(0,z.jsx)(x.Z,{component:"img",src:null!==(t=null===p||void 0===p?void 0:p.slotIcons[v])&&void 0!==t?t:"",sx:{m:-1,maxHeight:"110%",maxWidth:"110%"}})}),(0,z.jsxs)(x.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[(0,z.jsx)(me.Z,{size:"small",label:(0,z.jsx)("strong",{children:" +".concat(y)}),color:Xt.ZP.levelVariant(y)}),o&&(0,z.jsx)(me.Z,{size:"small",label:(0,z.jsx)(LocationIcon,{charKey:k&&h.chars.LocationToCharacterKey(k)}),color:"secondary",sx:{overflow:"visible",".MuiChip-label":{overflow:"visible"}}})]}),(0,z.jsx)(me.Z,{size:"small",sx:{position:"absolute",bottom:0,mb:1,backgroundColor:K},label:(0,z.jsxs)(X.Z,{sx:{display:"flex",gap:.5,px:1,zIndex:1},children:[(0,z.jsx)(Xe.Z,{placement:"top",title:(0,z.jsx)(X.Z,{children:(0,z.jsx)(tn._,{statKey:C})}),disableInteractive:!0,children:(0,z.jsx)("span",{children:ke.Z[C]})}),(0,z.jsxs)(ne.Z,{color:w!==y?"warning":void 0,children:[(0,ve.qs)(null!==(n=Xt.ZP.mainStatValue(C,g,w))&&void 0!==n?n:0,ve.ZP.unit(C)),A]})]})})]}),(0,z.jsx)(x.Z,{display:"flex",flexDirection:"column",justifyContent:"space-between",sx:{p:1},children:S.map((function(e,t){return(0,z.jsx)(SubstatDisplay,{stat:e},t+e.key)}))})]})})})}function SubstatDisplay(e){var t,n,r=e.stat;if(!r.value)return null;var i=null!==(t=null===(n=r.rolls)||void 0===n?void 0:n.length)&&void 0!==t?t:0,a="roll".concat((0,ot.uZ)(i,1,6)),s=ve.ZP.unit(r.key);return(0,z.jsx)(x.Z,{display:"flex",gap:1,alignContent:"center",children:(0,z.jsxs)(X.Z,{sx:{flexGrow:1,display:"flex",gap:.5},color:i?"".concat(a,".main"):"error.main",component:"span",children:[(0,z.jsx)(Xe.Z,{placement:"top",title:(0,z.jsx)(X.Z,{children:r.key&&(0,z.jsx)(tn._,{statKey:r.key})}),disableInteractive:!0,children:(0,z.jsx)("span",{children:ke.Z[r.key]})}),(0,z.jsx)("span",{children:"".concat((0,ve.qs)(r.value,ve.ZP.unit(r.key))).concat(s)})]})})}function LocationIcon(e){var t=e.charKey,n=(0,O.Z)().gender,r=(0,_.Z)((function(){return I.Z.get(t,n)}),[t,n]);return r?(0,z.jsx)(Xe.Z,{placement:"right-end",title:(0,z.jsx)(X.Z,{children:r.name}),children:(0,z.jsx)(re.Z,{src:r.thumbImgSide,size:2.5,sx:{marginTop:"-1.5em",marginLeft:"-0.5em"}})}):(0,z.jsx)(Ht.Z,{})}var rn=n(16002);function StatDisplayComponent(){var e=(0,Z.useContext)(nt),t=(0,Z.useContext)(K.R),n=t.data,r=t.oldData,a=(0,Z.useContext)(P.M).setFormulaData,s=(0,Z.useContext)(M.t).database,l=(0,Z.useMemo)((function(){return(0,ae.U)(n).filter((function(e){var t=(0,i.Z)(e,2)[1];return Object.values(t).some((function(e){return!e.isEmpty}))}))}),[n]);return(0,Z.useMemo)((function(){return(0,z.jsx)(x.Z,{sx:{mr:-1,mb:-1},children:(0,z.jsx)(rn.ZP,{columns:{xs:1,sm:2,md:3,xl:4},spacing:1,children:l.map((function(t){var l=(0,i.Z)(t,2),o=l[0],c=l[1];return(0,z.jsx)(Section,{displayNs:c,sectionKey:o,optimizationTarget:e,data:n,oldData:r,setFormulaData:a,database:s},o)}))})})}),[n,s,r,e,l,a])}function Section(e){var t=e.displayNs,n=e.sectionKey,r=e.optimizationTarget,a=e.data,s=e.oldData,l=e.setFormulaData,o=e.database,c=(0,_.Z)((function(){return(0,ae.f)(a,n,o)}),[a,n]),u=(0,Z.useMemo)((function(){return(0,ot.xh)(t,(function(e,t){return(0,xt.UF)(["display",n,t])}))}),[t,n]);return(0,Z.useMemo)((function(){if(!c)return(0,z.jsx)(b.Z,{});var e=c.title,o=c.icon,d=c.action;return(0,z.jsxs)(b.Z,{children:[(0,z.jsx)(te.Z,{avatar:o&&(0,z.jsx)(re.Z,{size:2,sx:{m:-1},src:o}),title:e,action:d&&(0,z.jsx)(A.Z,{children:d})}),(0,z.jsx)(U.Z,{}),(0,z.jsx)(Ie.lD,{sx:{m:0},children:Object.entries(t).map((function(e){var t=(0,i.Z)(e,2),o=t[0],c=t[1];return(0,z.jsx)(Ie.JW,{data:a,setFormulaData:l,node:c,oldValue:s?s.get(u[o]).value:void 0,component:de.ZP,emphasize:JSON.stringify(r)===JSON.stringify([n,o])},o)}))})]})}),[a,t,u,c,s,r,n,l])}var an=n(66218),sn=n(74480),ln=n(41717);function WeaponCardNano(e){var t=e.weaponId,n=e.showLocation,r=void 0!==n&&n,i=e.onClick,a=e.BGComponent,s=void 0===a?b.Z:a,l=(0,sn.Z)(t),o=(0,_.Z)((function(){return(null===l||void 0===l?void 0:l.key)&&an.Z.get(l.key)}),[null===l||void 0===l?void 0:l.key]),c=(0,Z.useCallback)((function(e){return(0,z.jsx)($t.Z,{sx:{height:"100%"},onClick:i,children:e})}),[i]),u=(0,Z.useMemo)((function(){return o&&l&&(0,it.mP)([o.data,(0,it.v0)(l)])}),[o,l]);if(!l||!o||!u)return(0,z.jsx)(s,{sx:{height:"100%"},children:(0,z.jsx)(f.Z,{variant:"rectangular",sx:{width:"100%",height:"100%"}})});var d=l.refinement,h=l.location;return(0,z.jsx)(s,{sx:{height:"100%"},children:(0,z.jsx)(en.Z,{condition:!!i,wrapper:c,children:(0,z.jsxs)(x.Z,{display:"flex",height:"100%",alignItems:"stretch",children:[(0,z.jsxs)(x.Z,{className:"grad-".concat(o.rarity,"star"),sx:{height:"100%",position:"relative",flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end"},children:[(0,z.jsx)(ln.Z,{sheet:o,children:(0,z.jsx)(x.Z,{component:"img",src:o.getImg(l.ascension),sx:{mx:-1,maxHeight:"100%",maxWidth:"100%"}})}),(0,z.jsxs)(x.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[(0,z.jsx)(me.Z,{size:"small",label:(0,z.jsx)("strong",{children:an.Z.getLevelString(l)}),color:"primary"}),r&&(0,z.jsx)(me.Z,{size:"small",label:(0,z.jsx)(WeaponCardNano_LocationIcon,{location:h}),color:"secondary",sx:{overflow:"visible",".MuiChip-label":{overflow:"visible"}}})]}),(0,z.jsx)(x.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"flex-end",alignItems:"flex-end"},children:o.hasRefinement&&(0,z.jsx)(me.Z,{size:"small",color:"info",label:(0,z.jsxs)("strong",{children:["R",d]})})})]}),(0,z.jsxs)(x.Z,{display:"flex",flexDirection:"column",sx:{p:1},children:[(0,z.jsx)(WeaponStat,{node:u.get(Ze.qH.weapon.main)}),(0,z.jsx)(WeaponStat,{node:u.get(Ze.qH.weapon.sub)})]})]})})})}function WeaponStat(e){var t=e.node;return t.info.name?(0,z.jsx)(x.Z,{display:"flex",gap:1,alignContent:"center",children:(0,z.jsxs)(X.Z,{sx:{flexGrow:1,display:"flex",gap:1},component:"span",children:[(0,z.jsx)(Xe.Z,{placement:"top",title:(0,z.jsx)(X.Z,{children:t.info.name}),disableInteractive:!0,children:(0,z.jsx)("span",{children:t.info.icon})}),(0,z.jsx)("span",{children:(0,se.p)(t)})]})}):null}function WeaponCardNano_LocationIcon(e){var t=e.location,n=(0,Z.useContext)(M.t).database,r=(0,O.Z)().gender,i=(0,_.Z)((function(){return I.Z.get(t?n.chars.LocationToCharacterKey(t):"",r)}),[t,r]);return i?(0,z.jsx)(Xe.Z,{placement:"right-end",title:(0,z.jsx)(X.Z,{children:i.name}),children:(0,z.jsx)(re.Z,{src:i.thumbImgSide,sx:{height:"3em",marginTop:"-1.5em",marginLeft:"-0.5em"}})}):(0,z.jsx)(Ht.Z,{})}var on=n(72838),cn=n(80616);function ArtifactSetBadges(e){var t=e.artifacts,n=e.currentlyEquipped,r=void 0!==n&&n,a=(0,Z.useMemo)((function(){return t.filter((function(e){return e})).reduce((function(e,t){return e[t.setKey]?e[t.setKey].push(t.slotKey):e[t.setKey]=[t.slotKey],e}),{})}),[t]);return(0,z.jsx)(z.Fragment,{children:Object.entries(a).sort((function(e,t){var n=(0,i.Z)(e,2),r=(n[0],n[1]),a=(0,i.Z)(t,2);a[0];return a[1].length-r.length})).map((function(e){var t=(0,i.Z)(e,2),n=t[0],a=t[1];return(0,z.jsx)(ArtifactSetBadge,{setKey:n,currentlyEquipped:r,slotarr:a},n)}))})}function ArtifactSetBadge(e){var t,n=e.setKey,r=e.currentlyEquipped,i=void 0!==r&&r,a=e.slotarr,s=(0,_.Z)((function(){return Zt.y.get(n)}),[]);if(!s)return null;var l=a.length,o=Object.keys(s.setEffects).map((function(e){return parseInt(e)})).filter((function(e){return e<=l}));return(0,z.jsx)(x.Z,{children:(0,z.jsx)(cn.Z,{artifactSheet:s,numInSet:l,children:(0,z.jsx)(A.Z,{sx:{height:"100%"},color:i?"success":"primary",children:(0,z.jsxs)(X.Z,{children:[a.map((function(e){return(0,Tt.Ir)(e)}))," ",null!==(t=s.name)&&void 0!==t?t:"",o.map((function(e){return(0,z.jsx)(A.Z,{sx:{ml:.5},color:"success",children:e},e)}))]})})})})}function BuildDisplayItem(e){var t=e.label,n=e.compareBuild,r=e.extraButtonsRight,a=e.extraButtonsLeft,s=e.disabled,l=(0,Z.useContext)(D.K).character,o=l.key,c=l.equippedArtifacts,u=useBuildSetting(o).buildSetting.mainStatAssumptionLevel,d=(0,Z.useContext)(M.t).database,x=(0,Z.useContext)(K.R),p=x.data,m=x.oldData,j=(0,Z.useState)(void 0),v=(0,i.Z)(j,2),g=v[0],y=v[1],b=(0,Z.useCallback)((function(){return y(void 0)}),[y]),S=(0,Z.useCallback)((function(){window.confirm("Do you want to equip this build to this character?")&&(W.eV.forEach((function(e){var t=p.get(Ze.ri.art[e].id).value;t&&d.arts.set(t,{location:(0,W.V7)(o)})})),d.weapons.set(p.get(Ze.ri.weapon.id).value,{location:(0,W.V7)(o)}))}),[o,p,d]),k=(0,Z.useMemo)((function(){var e=(0,xe.Z)({},x);return n||(e.oldData=void 0),e}),[x,n]),w=(0,Z.useMemo)((function(){return Object.fromEntries(W.eV.map((function(e){return[e,p.get(Ze.ri.art[e].id).value]})))}),[p]),A=(0,Z.useMemo)((function(){return w&&Object.values(w).map((function(e){return d.arts.get(e)})).filter((function(e){return e}))}),[w,d.arts]),P=(0,Z.useMemo)((function(){return(0,z.jsx)(WeaponCardNano,{showLocation:!0,weaponId:p.get(Ze.ri.weapon.id).value})}),[p]),E=(0,Z.useMemo)((function(){return W.eV.map((function(e){return(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(ArtifactCardNano,{showLocation:!0,slotKey:e,artifactId:w[e],mainStatAssumptionLevel:u,onClick:function onClick(){var t=c[e],n=w[e];y({oldId:t!==n?t:void 0,newId:n})}})},e)}))}),[y,c,u,w]);if(!m)return null;var I=W.eV.every((function(e){return w[e]===m.get(Ze.ri.art[e].id).value}))&&p.get(Ze.ri.weapon.id).value===m.get(Ze.ri.weapon.id).value;return(0,z.jsx)(C.Z,{children:(0,z.jsxs)(Z.Suspense,{fallback:(0,z.jsx)(f.Z,{variant:"rectangular",width:"100%",height:600}),children:[g&&(0,z.jsx)(CompareArtifactModal,{newOld:g,mainStatAssumptionLevel:u,onClose:b}),(0,z.jsxs)(h.Z,{children:[(0,z.jsx)(BuildHeader,{label:t,currentlyEquipped:I,artifacts:A,extraButtonsLeft:a,equipBuild:S,disabled:s,extraButtonsRight:r}),(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,sx:{pb:1},columns:{xs:2,sm:3,md:4,lg:6},children:[(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:P}),E]}),(0,z.jsx)(K.R.Provider,{value:k,children:(0,z.jsx)(StatDisplayComponent,{})})]})]})})}function BuildHeader(e){var t=e.label,n=e.currentlyEquipped,r=e.artifacts,i=e.extraButtonsLeft,a=e.equipBuild,s=e.disabled,l=e.extraButtonsRight;return(0,Z.useMemo)((function(){return(0,z.jsxs)(x.Z,{display:"flex",gap:1,sx:{pb:1},flexWrap:"wrap",children:[void 0!==t&&(0,z.jsx)(A.Z,{color:"info",children:(0,z.jsx)(X.Z,{children:(0,z.jsxs)("strong",{children:[t,n?" (Equipped)":""]})})}),(0,z.jsx)(ArtifactSetBadges,{artifacts:r,currentlyEquipped:n}),(0,z.jsx)(x.Z,{sx:{flexGrow:1,display:"flex",justifyContent:"flex-end"}}),i,(0,z.jsx)(j.Z,{size:"small",color:"success",onClick:a,disabled:s||n,startIcon:(0,z.jsx)(zt.Z,{}),children:"Equip Build"}),l]})}),[r,n,s,a,i,l,t])}function CompareArtifactModal(e){var t=e.newOld,n=t.newId,r=t.oldId,i=e.mainStatAssumptionLevel,a=e.onClose,s=(0,Z.useContext)(M.t).database,l=(0,Z.useContext)(D.K).character.key,o=(0,Z.useCallback)((function(){window.confirm("Do you want to equip this artifact to this character?")&&(s.arts.set(n,{location:(0,W.V7)(l)}),a())}),[n,s,l,a]);return(0,z.jsx)(ie.Z,{open:!!n,onClose:a,containerProps:{maxWidth:r?"md":"xs"},children:(0,z.jsx)(b.Z,{children:(0,z.jsxs)(h.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"stretch",gap:2,height:"100%"},children:[r&&(0,z.jsx)(x.Z,{minWidth:320,children:(0,z.jsx)(on.Z,{artifactId:r,mainStatAssumptionLevel:i,canExclude:!0,canEquip:!0,editorProps:{disableSet:!0,disableSlot:!0}})}),r&&(0,z.jsx)(x.Z,{display:"flex",flexGrow:1}),r&&(0,z.jsx)(x.Z,{display:"flex",alignItems:"center",justifyContent:"center",children:(0,z.jsx)(j.Z,{onClick:o,sx:{display:"flex"},children:(0,z.jsx)(Vt.Z,{sx:{fontSize:40}})})}),r&&(0,z.jsx)(x.Z,{display:"flex",flexGrow:1}),(0,z.jsx)(x.Z,{minWidth:320,children:(0,z.jsx)(on.Z,{artifactId:n,mainStatAssumptionLevel:i,canExclude:!0,canEquip:!0,editorProps:{disableSet:!0,disableSlot:!0}})})]})})})}var un=n(72456),dn=n(10889),xn=n(20601),fn=n(72730),hn=n(82839),pn=n(90466),mn=n(17684),jn=n(12891),Zn=n(35667),vn=n(27281),gn=n(62066),yn=n(64694);function useBuildResult(e){var t=(0,Z.useContext)(M.t).database,n=(0,Z.useState)((function(){return t.buildResult.get(e)})),r=(0,i.Z)(n,2),a=r[0],s=r[1];return(0,Z.useEffect)((function(){return s(t.buildResult.get(e))}),[t,e]),(0,Z.useEffect)((function(){return t.buildResult.follow(e,(function(e,t,n){return"update"===t&&s(n)}))}),[e,s,t]),{buildResult:a,buildResultDispatch:(0,Z.useCallback)((function(n){return e&&t.buildResult.set(e,n)}),[e,t])}}var bn=n(72814);function CustomDot(e){var t=e.cx,n=e.cy,r=e.payload,i=e.selectedPoint,a=e.radiusSelected,s=void 0===a?6:a,l=e.radiusUnselected,o=void 0===l?3:l,c=e.colorSelected,u=void 0===c?"red":c,d=e.colorUnselected,x=e.shape,f=void 0===x?"circle":x;if(!t||!n||!r)return null;var h=i&&i.x===r.x&&i.y===r.y;return(0,z.jsx)("g",{className:"custom-dot","data-chart-x":t,"data-chart-y":n,"data-x-value":r.x,"data-y-value":r.y,"data-radius":h?o:s,children:h?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(CustomShape,{id:"customShapeSelected",shape:f,cx:t,cy:n,r:s/2,fill:u}),(0,z.jsx)(CustomShape,{id:"customShapeBorder",shape:f,cx:t,cy:n,r:s,fill:"none",stroke:u})]}):(0,z.jsx)(CustomShape,{id:"customShapeUnselected",shape:f,cx:t,cy:n,r:o,fill:d})})}function CustomShape(e){var t=e.shape,n=e.id,r=e.cx,i=e.cy,a=e.r,s=e.fill,l=e.stroke;switch(t){case"circle":return(0,z.jsx)("circle",{id:n,cx:r,cy:i,r:a,fill:s,stroke:l});case"square":return(0,z.jsx)("rect",{id:n,x:r-a,y:i-a,width:2*a,height:2*a,fill:s,stroke:l});case"diamond":return(0,z.jsx)("polygon",{id:n,points:"".concat(r,",").concat(i+2.5*a," ").concat(r+1.5*a,",").concat(i," ").concat(r,",").concat(i-2.5*a," ").concat(r-1.5*a,",").concat(i),fill:s,stroke:l})}}var Cn=n(49484),Sn=n(52991),kn=["xLabel","xUnit","yLabel","yUnit","selectedPoint","setSelectedPoint","addBuildToList","graphBuilds"];function CustomTooltip(e){var t=e.xLabel,n=e.xUnit,r=e.yLabel,i=e.yUnit,a=e.selectedPoint,s=e.setSelectedPoint,l=e.addBuildToList,o=e.graphBuilds,c=(0,ge.Z)(e,kn),u=(0,Z.useContext)(M.t).database,d=(0,Z.useContext)(K.R).data,x=(0,v.$)("page_character_optimize").t,p=useBuildResult((0,Z.useContext)(D.K).character.key).buildResult.builds,m=(0,Z.useMemo)((function(){return![].concat((0,oe.Z)(p),(0,oe.Z)(null!==o&&void 0!==o?o:[])).some((function(e){return e.every((function(e){return null===a||void 0===a?void 0:a.artifactIds.includes(e)}))}))}),[p,o,a]),g=(0,Z.useMemo)((function(){return a&&a.artifactIds&&Object.fromEntries(a.artifactIds.map((function(e){var t=u.arts.get(e);return[null===t||void 0===t?void 0:t.slotKey,t]})).filter((function(e){return e})))}),[u.arts,a]),y=(0,Z.useCallback)((function(e){e.target.id.includes("customShape")||e.target.id.includes("chartContainer")||s(void 0)}),[s]),C=g&&W.eV.every((function(e){var t;return(null===(t=g[e])||void 0===t?void 0:t.id)===d.get(Ze.qH.art[e].id).value}));return c.active&&a?(0,z.jsx)(Cn.Z,{onClickAway:y,children:(0,z.jsx)(b.Z,{sx:{minWidth:"400px",maxWidth:"400px"},onClick:function onClick(e){return e.stopPropagation()},children:(0,z.jsx)(h.Z,{children:(0,z.jsxs)(ce.Z,{gap:1,children:[(0,z.jsxs)(ce.Z,{direction:"row",alignItems:"start",gap:1,children:[(0,z.jsxs)(ce.Z,{spacing:.5,flexGrow:99,children:[C&&(0,z.jsx)(A.Z,{color:"info",children:(0,z.jsx)("strong",{children:x("currentlyEquippedBuild")})}),(0,z.jsx)(Z.Suspense,{fallback:(0,z.jsx)(f.Z,{width:300,height:50}),children:(0,z.jsx)(ArtifactSetBadges,{artifacts:Object.values(g),currentlyEquipped:C})})]}),(0,z.jsx)(ue.ZP,{item:!0,flexGrow:1}),(0,z.jsx)(S.Z,{onClick:function onClick(){return s(void 0)}})]}),(0,z.jsx)(ue.ZP,{container:!0,direction:"row",spacing:.75,columns:5,children:W.eV.map((function(e){return(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(Z.Suspense,{fallback:(0,z.jsx)(f.Z,{width:75,height:75}),children:(0,z.jsx)(Sn.Z,{artifactObj:g[e],slotKey:e})})},e)}))}),(0,z.jsxs)(X.Z,{children:[(0,z.jsx)("strong",{children:t}),": ",(0,ve.EC)("%"===n?a.x/100:a.x,n)]}),(0,z.jsxs)(X.Z,{children:[(0,z.jsx)("strong",{children:r}),": ",(0,ve.EC)("%"===i?a.y/100:a.y,i)]}),(0,z.jsx)(Xe.Z,{title:m?"":x("tcGraph.buildAlreadyInList"),placement:"top",children:(0,z.jsx)("span",{children:(0,z.jsx)(j.Z,{sx:{width:"100%"},disabled:!m,color:"info",onClick:function onClick(){return l(a.artifactIds)},children:x("addBuildToList")})})})]})})})}):null}var wn,An,Dn,Kn,Pn,En,In,Mn=n(15671),Rn=n(43144),Bn=function(){function EnhancedPoint(e,t,n){(0,Mn.Z)(this,EnhancedPoint),this.x=void 0,this.trueY=void 0,this.artifactIds=void 0,this.min=void 0,this.current=void 0,this.highlighted=void 0,this.x=e,this.trueY=t,this.artifactIds=n}return(0,Rn.Z)(EnhancedPoint,[{key:"y",get:function get(){return this.trueY||this.current||this.highlighted},set:function set(e){this.trueY=e}}]),EnhancedPoint}();function ChartCard(e){var t=e.plotBase,n=e.setPlotBase,a=e.disabled,s=void 0!==a&&a,l=e.showTooltip,o=void 0!==l&&l,c=e.chartData,u=e.graphBuilds,d=e.setGraphBuilds,x=(0,v.$)(["page_character_optimize","ui"]).t,f=(0,Z.useContext)(K.R).data,p=(0,Z.useState)(!1),m=(0,i.Z)(p,2),g=m[0],y=m[1],S=(0,Z.useState)(!0),k=(0,i.Z)(S,2),w=k[0],A=k[1],P=(0,Z.useContext)(M.t).database,E=useBuildResult((0,Z.useContext)(D.K).character.key).buildResult.builds,I=(0,Z.useState)(-1/0),R=(0,i.Z)(I,2),B=R[0],T=R[1],O=(0,Z.useState)(1/0),_=(0,i.Z)(O,2),N=_[0],L=_[1],F=(0,Z.useCallback)((function(e,t){if("number"===typeof t)throw new TypeError;var n=(0,i.Z)(t,2),r=n[0],a=n[1];T(r),L(a)}),[T,L]);(0,Z.useEffect)((function(){T(-1/0),L(1/0)}),[c]);var G=(0,Z.useMemo)((function(){var e,t;if(!c)return{displayData:null,downloadData:null};var n,r=1/0,i=-1/0,a=(0,ot.Uq)(W.eV,(function(e){var t;return[e,null!==(t=null===f||void 0===f?void 0:f.get(Ze.qH.art[e].id).value)&&void 0!==t?t:""]})),s=[].concat((0,oe.Z)(E),(0,oe.Z)(null!==u&&void 0!==u?u:[])).map((function(e){return convertArtiIdsToArtiSlotMap(e,P)})),l=c.data.map((function(e){var t=e.value,n=e.plot,l=e.artifactIds;if(void 0===n)return null;n<r&&(r=n),n>i&&(i=n);var o=new Bn(n,t,l),c=convertArtiIdsToArtiSlotMap(l,P);return W.eV.every((function(e){return a[e]===c[e]}))?(o.current=t,o.y=void 0,o):(s.some((function(e){return W.eV.every((function(t){return e[t]===c[t]}))}))&&(o.highlighted=t,o.y=void 0),o)})).sort((function(e,t){return e.x-t.x})),o=[],d=(0,ut.Z)(l);try{for(d.s();!(n=d.n()).done;){for(var x=n.value,h=void 0;h=o.pop();)if(h.y>x.y){o.push(h);break}o.push(x)}}catch(m){d.e(m)}finally{d.f()}(null===(e=o[0])||void 0===e?void 0:e.x)!==(null===(t=l[0])||void 0===t?void 0:t.x)&&(l[0].min=o[0].y),o.forEach((function(e){e.min=e.y}));var p={minimum:o.map((function(e){return[e.x,e.y]})),allData:l.map((function(e){return[e.x,e.y]}))};return{displayData:l.filter((function(e){return e&&e.x>=B&&e.x<=N})),downloadData:p,sliderMin:r,sliderMax:i}}),[c,E,f,P,u,B,N]),q=G.displayData,V=G.downloadData,H=G.sliderMin,$=G.sliderMax,Y=t&&(0,ot.Hm)(null===f||void 0===f?void 0:f.getDisplay(),t),J=x(t&&(!Y||Y.isEmpty)?"page_character_optimize:targetSelector.invalidTarget":"page_character_optimize:targetSelector.selectGraphTarget");return(0,z.jsxs)(C.Z,{children:[(0,z.jsx)(h.Z,{children:(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsx)(X.Z,{children:x(wn||(wn=(0,r.Z)(["tcGraph.vs"])))})}),(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsx)(Xe.Z,{placement:"top",title:o?x("page_character_optimize:selectTargetFirst"):"",children:(0,z.jsx)("span",{children:(0,z.jsx)(bn.Z,{optimizationTarget:t,setTarget:function setTarget(e){return n(e)},defaultText:J,disabled:s})})})}),(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsx)(Xe.Z,{title:t?x("ui:reset"):"",placement:"top",children:(0,z.jsx)("span",{children:(0,z.jsx)(j.Z,{color:"error",onClick:function onClick(){return n(void 0)},disabled:!t,children:(0,z.jsx)(fe.Z,{})})})})}),(0,z.jsx)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.jsx)(Ot.Z,{placement:"top",title:x("page_character_optimize:tcGraph.desc")})}),!!V&&(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsx)(j.Z,{size:"small",startIcon:w?(0,z.jsx)(he.Z,{}):(0,z.jsx)(pe.Z,{}),color:w?"success":"secondary",onClick:function onClick(){return A(!w)},children:x(An||(An=(0,r.Z)(["tcGraph.showStatThr"])))})}),!!V&&(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsx)(j.Z,{size:"small",color:"info",startIcon:(0,z.jsx)(un.Z,{}),onClick:function onClick(){return y(!g)},children:x(Dn||(Dn=(0,r.Z)(["tcGraph.downloadData"])))})})]})}),q&&q.length&&(0,z.jsx)(U.Z,{}),c&&q&&q.length&&(0,z.jsxs)(h.Z,{children:[(0,z.jsx)(je.Z,{in:!!V&&g,children:(0,z.jsx)(b.Z,{sx:{mb:2},children:(0,z.jsxs)(h.Z,{children:[(0,z.jsx)(X.Z,{children:"Min Data"}),(0,z.jsx)(DataDisplay,{data:null===V||void 0===V?void 0:V.minimum}),(0,z.jsx)(X.Z,{children:"All Data"}),(0,z.jsx)(DataDisplay,{data:null===V||void 0===V?void 0:V.allData})]})})}),(0,z.jsx)(Chart,{displayData:q,plotNode:c.plotNode,valueNode:c.valueNode,showMin:w,graphBuilds:u,setGraphBuilds:d}),q.length>1&&(0,z.jsx)(dn.ZP,{marks:!0,value:[B,N],onChange:F,onChangeCommitted:F,min:H,max:$,step:($-H)/20,valueLabelDisplay:"auto",valueLabelFormat:function valueLabelFormat(e){var t,n;return(0,ve.EC)("%"===(null===(t=c.plotNode.info)||void 0===t?void 0:t.unit)?e/100:e,null===(n=c.plotNode.info)||void 0===n?void 0:n.unit)},sx:{ml:"6%",width:"93%"}})]})]})}var Tn=(0,ye.ZP)("textarea")({width:"100%",fontFamily:"monospace",resize:"vertical",minHeight:"5em"});function DataDisplay(e){var t=e.data;return(0,z.jsx)(Tn,{readOnly:!0,value:JSON.stringify(t),onClick:function onClick(e){var t=e.target;t.selectionStart=0,t.selectionEnd=t.value.length}})}var On="#8884d8",_n="cyan",Nn="#46a046",Ln="#ff7300";function Chart(e){var t,n,a,s,l=e.displayData,o=e.plotNode,c=e.valueNode,u=e.showMin,d=e.graphBuilds,x=e.setGraphBuilds,f=(0,v.$)("page_character_optimize").t,h=(0,Z.useState)(),p=(0,i.Z)(h,2),m=p[0],j=p[1],g=(0,Z.useCallback)((function(e){return x([].concat((0,oe.Z)(null!==d&&void 0!==d?d:[]),[e]))}),[x,d]),y=(0,Z.useCallback)((function(e){e&&e.chartX&&e.chartY&&j(function getNearestPoint(e,t,n,r){var i=Array.from(document.querySelectorAll(".custom-dot")).reduce((function(n,r){var i=n.dataset,a=i.chartX,s=i.chartY,l=Math.sqrt(Math.pow(e-a,2)+Math.pow(t-s,2)),o=r.dataset,c=o.chartX,u=o.chartY;return l<=Math.sqrt(Math.pow(e-c,2)+Math.pow(t-u,2))?n:r})).dataset;return Math.sqrt(Math.pow(e-i.chartX,2)+Math.pow(t-i.chartY,2))<n?r.find((function(e){return e.x===+i.xValue&&e.y===+i.yValue})):void 0}(e.chartX,e.chartY,20,l))}),[j,l]),b=getLabelFromNode(o,f),C=getLabelFromNode(c,f);return(0,z.jsx)(xn.h,{width:"100%",height:600,children:(0,z.jsxs)(fn.c,{id:"chartContainer",data:l,onClick:y,style:{cursor:"pointer"},children:[(0,z.jsx)(hn.q,{strokeDasharray:"3 3"}),(0,z.jsx)(pn.K,{dataKey:"x",scale:"linear",unit:null===(t=o.info)||void 0===t?void 0:t.unit,domain:["auto","auto"],tick:{fill:"white"},type:"number",tickFormatter:function tickFormatter(e){return e>1e4?e.toFixed():e.toFixed(1)},label:(0,z.jsx)(mn._,{fill:"white",dy:10,children:b}),height:50}),(0,z.jsx)(jn.B,{name:"DMG",domain:["auto","auto"],unit:null===(n=c.info)||void 0===n?void 0:n.unit,allowDecimals:!1,tick:{fill:"white"},type:"number",label:(0,z.jsx)(mn._,{fill:"white",angle:-90,dx:-40,children:C}),width:100}),(0,z.jsx)(Zn.u,{content:(0,z.jsx)(CustomTooltip,{xLabel:b,xUnit:null===(a=o.info)||void 0===a?void 0:a.unit,yLabel:C,yUnit:null===(s=c.info)||void 0===s?void 0:s.unit,selectedPoint:m,setSelectedPoint:j,addBuildToList:g,graphBuilds:d}),trigger:"click",wrapperStyle:{pointerEvents:"auto",cursor:"auto"},cursor:!1}),(0,z.jsx)(vn.D,{payload:[].concat((0,oe.Z)(u?[{id:"min",value:f(Kn||(Kn=(0,r.Z)(["tcGraph.statReqThr"]))),type:"line",color:Ln}]:[]),[{id:"trueY",value:f(Pn||(Pn=(0,r.Z)(["tcGraph.generatedBuilds"]))),type:"circle",color:On},{id:"highlighted",value:f(En||(En=(0,r.Z)(["tcGraph.highlightedBuilds"]))),type:"square",color:_n},{id:"current",value:f(In||(In=(0,r.Z)(["tcGraph.currentBuild"]))),type:"diamond",color:Nn}])}),u&&(0,z.jsx)(gn.x,{dataKey:"min",stroke:Ln,type:"stepBefore",connectNulls:!0,strokeWidth:2,isAnimationActive:!1,dot:!1,activeDot:!1}),(0,z.jsx)(yn.b,{dataKey:"trueY",isAnimationActive:!1,shape:(0,z.jsx)(CustomDot,{selectedPoint:m,colorUnselected:On})}),(0,z.jsx)(yn.b,{dataKey:"highlighted",isAnimationActive:!1,shape:(0,z.jsx)(CustomDot,{shape:"square",selectedPoint:m,colorUnselected:_n})}),(0,z.jsx)(yn.b,{dataKey:"current",isAnimationActive:!1,shape:(0,z.jsx)(CustomDot,{shape:"diamond",selectedPoint:m,colorUnselected:Nn})})]})})}function convertArtiIdsToArtiSlotMap(e,t){var n=Object.fromEntries(e.map((function(e){var n=t.arts.get(e);return n?[n.slotKey,n.id]:[]})));return(0,ot.Uq)(W.eV,(function(e){var t;return[e,null!==(t=n[e])&&void 0!==t?t:""]}))}function getLabelFromNode(e,t){var n,r,i,a,s,l,o;return"string"===typeof(null===(n=e.info)||void 0===n?void 0:n.name)?e.info.name:"".concat(t("".concat(null===(r=e.info)||void 0===r||null===(i=r.name)||void 0===i?void 0:i.props.ns,":").concat(null===(a=e.info)||void 0===a||null===(s=a.name)||void 0===s?void 0:s.props.key18))).concat(null!==(l=e.info)&&void 0!==l&&l.textSuffix?" ".concat(null===(o=e.info)||void 0===o?void 0:o.textSuffix):"")}var Wn,Fn,Gn=["sands","goblet","circlet"];function MainStatSelectionCard(e){var t=e.disabled,n=void 0!==t&&t,r=useBuildSetting((0,Z.useContext)(D.K).character.key),i=r.buildSetting.mainStatKeys,a=r.buildSettingDispatch;return(0,z.jsx)(x.Z,{display:"flex",flexDirection:"column",gap:1,children:Gn.map((function(e){return(0,z.jsx)(MainStatSelectionCardFactory,{mainStatKeySlotKey:i[e],slotKey:e,disabled:n,buildSettingDispatch:a},e)}))})}function MainStatSelectionCardFactory(e){var t=e.mainStatKeySlotKey,n=e.slotKey,r=e.disabled,i=e.buildSettingDispatch,a=(0,v.$)("artifact").t,s=useMemoEq((function(){return t}),or),l=s.length;return(0,Z.useMemo)((function(){return(0,z.jsxs)(x.Z,{children:[(0,z.jsx)(U.Z,{}),(0,z.jsxs)(h.Z,{sx:{pt:1},children:[(0,z.jsxs)(x.Z,{sx:{display:"flex",gap:1,alignItems:"center",pb:1},children:[(0,z.jsx)(Xe.Z,{placement:"top",title:(0,z.jsx)(X.Z,{children:a("slotName.".concat(n))}),children:(0,z.jsx)("span",{children:(0,Tt.Ir)(n)})}),(0,z.jsx)(x.Z,{flexGrow:1,children:(0,z.jsx)(A.Z,{color:"info",children:l?"".concat(l," Selected"):"Any"})}),(0,z.jsx)(j.Z,{color:"error",size:"small",disabled:!l||r,sx:{mt:-1,mb:-1},onClick:function onClick(){return i({type:"mainStatKey",slotKey:n})},children:(0,z.jsx)(fe.Z,{})})]}),(0,z.jsx)(ue.ZP,{container:!0,spacing:1,children:Xt.ZP.slotMainStats(n).map((function(e,t){var a=W.Kj.find((function(t){return e.includes(t)})),l=s.includes(e)?null!==a&&void 0!==a?a:"success":"secondary";return(0,z.jsx)(MainStatSelectionCardInnerFactoryAbstractBuilderMethod,{i:t,slotKey:n,mainStatKey:e,color:l,disabled:r,buildSettingDispatch:i},e)}))})]})]})}),[n,a,l,r,i,s])}function MainStatSelectionCardInnerFactoryAbstractBuilderMethod(e){var t=e.i,n=e.slotKey,r=e.mainStatKey,i=e.color,a=e.disabled,s=e.buildSettingDispatch;return(0,Z.useMemo)((function(){return(0,z.jsx)(ue.ZP,{item:!0,flexGrow:1,xs:t<3&&"goblet"!==n?4:void 0,children:(0,z.jsx)(Xe.Z,{placement:"top",title:(0,z.jsx)(X.Z,{children:(0,z.jsx)("strong",{children:(0,z.jsx)(tn._,{statKey:r})})}),disableInteractive:!0,children:(0,z.jsx)(j.Z,{fullWidth:!0,size:"small",color:i,sx:{fontSize:"1.2em",height:"100%",pointerEvents:a?"none":void 0,cursor:a?"none":void 0},onClick:function onClick(){return s({type:"mainStatKey",slotKey:n,mainStatKey:r})},children:ke.Z[r]})})})}),[s,i,a,t,r,n])}function OptimizationTargetEditorList(e){var t=e.statFilters,n=e.setStatFilters,r=e.disabled,a=void 0!==r&&r,s=(0,Z.useCallback)((function(e,r,i){var a,s=(0,xe.Z)({},t),l=JSON.stringify(r),o=r?(0,oe.Z)(t[l]):void 0,c=JSON.stringify(e),u=(0,oe.Z)(null!==(a=t[c])&&void 0!==a?a:[]);void 0!==i&&o?u.push(o[i]):u.push({value:0,disabled:!1}),s[c]=u,void 0!==i&&o&&(o.splice(i,1),o.length?s[l]=o:delete s[l]),n((0,xe.Z)({},s))}),[n,t]),l=(0,Z.useCallback)((function(e,r){var i=(0,xe.Z)({},t),a=JSON.stringify(e),s=(0,oe.Z)(t[a]);s.splice(r,1),s.length?i[a]=s:delete i[a],n((0,xe.Z)({},i))}),[n,t]),o=(0,Z.useCallback)((function(e,r,i){var a=(0,xe.Z)({},t),s=JSON.stringify(e),l=(0,oe.Z)(t[s]);l[r]=(0,xe.Z)((0,xe.Z)({},l[r]),{},{value:i}),a[s]=l,n((0,xe.Z)({},a))}),[n,t]),c=(0,Z.useCallback)((function(e,r,i){var a=(0,xe.Z)({},t),s=JSON.stringify(e),l=(0,oe.Z)(t[s]);l[r]=(0,xe.Z)((0,xe.Z)({},l[r]),{},{disabled:i}),a[s]=l,n((0,xe.Z)({},a))}),[n,t]);return(0,z.jsxs)(z.Fragment,{children:[Object.entries(t).flatMap((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return null===r||void 0===r?void 0:r.map((function(e,t){return(0,z.jsx)(OptimizationTargetEditorItem,{path:JSON.parse(n),setting:e,index:t,setTarget:s,delTarget:l,setValue:o,setDisabled:c,disabled:a},n+t)}))})),(0,z.jsx)(OptimizationTargetEditorItem,{setTarget:s,delTarget:l,setValue:o,setDisabled:c,disabled:a})]})}function OptimizationTargetEditorItem(e){var t,n=e.path,r=e.setting,i=e.index,a=e.setTarget,s=e.delTarget,l=e.setValue,o=e.setDisabled,c=e.disabled,u=(0,v.$)("page_character_optimize").t,d=(0,Z.useContext)(K.R).data,x=(0,Z.useCallback)((function(e){return n&&void 0!==i&&l(n,i,null!==e&&void 0!==e?e:0)}),[l,n,i]),f={p:1,flexBasis:30,flexGrow:0,flexShrink:0},h=(0,ot.Hm)(d.getDisplay(),null!==n&&void 0!==n?n:[]),p="%"===(null===h||void 0===h||null===(t=h.info)||void 0===t?void 0:t.unit);return(0,z.jsxs)(we.Z,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!r&&!!n&&void 0!==i&&(0,z.jsx)(j.Z,{sx:f,color:r.disabled?"secondary":"success",onClick:function onClick(){return o(n,i,!r.disabled)},disabled:c,children:r.disabled?(0,z.jsx)(pe.Z,{}):(0,z.jsx)(he.Z,{})}),(0,z.jsx)(bn.Z,{showEmptyTargets:!0,optimizationTarget:n,setTarget:function setTarget(e){return a(e,n,i)},defaultText:u("targetSelector.selectBuildTarget")}),(0,z.jsx)(Ae.CC,{sx:{flexBasis:150,flexGrow:1},children:(0,z.jsx)(Ae.ZP,{float:!0,disabled:!n||c,value:null===r||void 0===r?void 0:r.value,placeholder:"Stat Value",onChange:x,sx:{px:1},inputProps:{sx:{textAlign:"right"}},endAdornment:p?"%":void 0})}),!!n&&void 0!==i&&(0,z.jsx)(j.Z,{sx:f,color:"error",onClick:function onClick(){return s(n,i)},disabled:c,children:(0,z.jsx)(ze.Z,{fontSize:"small"})})]})}function StatFilterCard(e){var t=e.disabled,n=void 0!==t&&t,i=(0,v.$)("page_character_optimize").t,a=useBuildSetting((0,Z.useContext)(D.K).character.key),s=a.buildSetting.statFilters,l=a.buildSettingDispatch,o=(0,Z.useCallback)((function(e){return l({statFilters:e})}),[l]);return(0,z.jsxs)(x.Z,{children:[(0,z.jsx)(C.Z,{children:(0,z.jsxs)(h.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[(0,z.jsx)(X.Z,{children:i(Wn||(Wn=(0,r.Z)(["constraintFilter.title"])))}),(0,z.jsx)(Ot.Z,{title:(0,z.jsx)(X.Z,{children:i(Fn||(Fn=(0,r.Z)(["constraintFilter.tooltip"])))})})]})}),(0,z.jsx)(x.Z,{display:"flex",flexDirection:"column",gap:.5,children:(0,z.jsx)(OptimizationTargetEditorList,{statFilters:s,setStatFilters:o,disabled:n})})]})}var qn,zn=n(89841),Vn=n(70558),Hn=n(1235),$n=n(68125),Un=n(68087),Yn=n(84684),Jn=n(77208),Xn=Z.lazy((function(){return n.e(381).then(n.bind(n,4332))}));function UseEquipped(e){var t=e.disabled,n=void 0!==t&&t,a=(0,v.$)("page_character_optimize").t,s=(0,Z.useContext)(D.K).character.key,l=useBuildSetting(s),o=l.buildSetting.useEquippedArts,c=l.buildSettingDispatch,u=(0,Z.useContext)(M.t).database,d=(0,R.Z)(!1),f=(0,i.Z)(d,3),p=f[0],m=f[1],g=f[2],y=(0,Z.useState)(u.displayOptimize.get()),k=(0,i.Z)(y,2),w=k[0].equipmentPriority,K=k[1];(0,Z.useEffect)((function(){return u.displayOptimize.follow((function(e,t){return K(t)}))}),[u,K]);var P=(0,Z.useMemo)((function(){return(0,oe.Z)(new Set(w)).filter((function(e){return u.chars.get(e)}))}),[u,w]),E=(0,Z.useCallback)((function(e){return u.displayOptimize.set({equipmentPriority:e})}),[u]),I=(0,Z.useCallback)((function(e,t){var n=(0,oe.Z)(P),r=n[e];n.splice(e,1),n.splice(t,0,r),E(n)}),[P,E]),B=(0,Z.useCallback)((function(e){var t=(0,oe.Z)(P);t.splice(e,1),E(t)}),[P,E]),T=(0,Z.useCallback)((function(e){return E([].concat((0,oe.Z)(P),[e]))}),[P,E]),O=(0,Z.useCallback)((function(){return E([])}),[E]),_=(0,Z.useMemo)((function(){var e=P.length,t=P.indexOf(s);return t>=0&&(e=t),e}),[s,P]),N=(0,Z.useMemo)((function(){return u.chars.keys.length-1-_}),[_,u]),L=(0,Z.useMemo)((function(){return u.chars.keys.length-P.length}),[P,u]);return(0,z.jsxs)(x.Z,{display:"flex",gap:1,children:[(0,z.jsx)(ie.Z,{open:p,onClose:g,containerProps:{maxWidth:"sm"},children:(0,z.jsxs)(b.Z,{children:[(0,z.jsx)(h.Z,{children:(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,children:[(0,z.jsx)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.jsx)(X.Z,{variant:"h6",children:a(qn||(qn=(0,r.Z)(["useEquipped.modal.title"])))})}),(0,z.jsx)(ue.ZP,{item:!0,sx:{mb:-1},children:(0,z.jsx)(S.Z,{onClick:g})})]})}),(0,z.jsx)(U.Z,{}),(0,z.jsxs)(h.Z,{children:[(0,z.jsx)(C.Z,{sx:{mb:1},children:(0,z.jsxs)(h.Z,{children:[(0,z.jsx)(X.Z,{gutterBottom:!0,children:(0,z.jsx)(Ye.c,{t:a,i18nKey:"useEquipped.modal.desc1",children:"When generating a build, the Optimizer will only consider equipped artifacts from characters below the current character or those not on the list."})}),(0,z.jsx)(X.Z,{gutterBottom:!0,children:(0,z.jsx)(Ye.c,{t:a,i18nKey:"useEquipped.modal.desc2",children:"If the current character is not on the list, the Optimizer will only consider equipped artifacts from others characters that are not on the list."})})]})}),(0,z.jsxs)(x.Z,{display:"flex",flexDirection:"column",gap:2,children:[P.map((function(e,t){return(0,z.jsx)(SelectItem,{characterKey:e,rank:t+1,maxRank:P.length,setRank:function setRank(e){return e&&I(t,e-1)},onRemove:function onRemove(){return B(t)},numAbove:_},e)})),(0,z.jsxs)(x.Z,{sx:{display:"flex",gap:1},children:[(0,z.jsx)(NewItem,{onAdd:T,list:P}),(0,z.jsx)(j.Z,{color:"error",onClick:O,startIcon:(0,z.jsx)(fe.Z,{}),children:(0,z.jsx)(Ye.c,{t:a,i18nKey:"useEquipped.modal.clearList",children:"Clear List"})})]}),!!N&&(0,z.jsx)(A.Z,{color:"success",children:(0,z.jsx)(X.Z,{children:(0,z.jsxs)(Ye.c,{t:a,i18nKey:"useEquipped.modal.usingNum",count:L,children:["Using artifacts from ",(0,z.jsx)("strong",{children:{count:L}})," unlisted characters"]})})})]})]})]})}),(0,z.jsxs)(we.Z,{sx:{display:"flex",width:"100%"},children:[(0,z.jsx)(j.Z,{sx:{flexGrow:1},onClick:function onClick(){return c({useEquippedArts:!o})},disabled:n,startIcon:o?(0,z.jsx)(he.Z,{}):(0,z.jsx)(pe.Z,{}),color:o?"success":"secondary",children:(0,z.jsxs)(x.Z,{children:[(0,z.jsx)("span",{children:(0,z.jsx)(Ye.c,{t:a,i18nKey:"useEquipped.title",children:"Use Equipped Artifacts"})}),o&&(0,z.jsx)(A.Z,{children:(0,z.jsxs)(Ye.c,{t:a,i18nKey:"useEquipped.usingNum",count:N,children:["Using from ",(0,z.jsx)("strong",{children:{count:N}})," characters"]})})]})}),o&&(0,z.jsx)(j.Z,{sx:{flexShrink:1},color:"info",onClick:m,disabled:n,children:(0,z.jsx)(jt.Z,{})})]})]})}function SelectItem(e){var t=e.characterKey,n=e.rank,r=e.maxRank,a=e.setRank,s=e.onRemove,l=e.numAbove,o=(0,v.$)("page_character_optimize").t,c=(0,Z.useContext)(M.t).database,u=(0,B.Z)(t),d=(0,q.Z)();if(!u)return null;var f=u.equippedWeapon,h=u.equippedArtifacts;return(0,z.jsxs)(C.Z,{sx:{p:1},children:[(0,z.jsxs)(x.Z,{sx:{pb:1,display:"flex",justifyContent:"space-between",gap:1},children:[(0,z.jsx)(A.Z,{color:"info",children:(0,z.jsxs)(X.Z,{children:["#",n]})}),(0,z.jsx)(A.Z,{sx:{flexGrow:1},color:l===n-1?"warning":n-1<l?"error":"success",children:(0,z.jsx)(X.Z,{children:l===n-1?(0,z.jsx)(Ye.c,{t:o,i18nKey:"useEquipped.modal.status.curr",children:"Current character"}):n-1<l?(0,z.jsx)(Ye.c,{t:o,i18nKey:"useEquipped.modal.status.dont",children:"Don't Use artifacts"}):(0,z.jsx)(Ye.c,{t:o,i18nKey:"useEquipped.modal.status.use",children:"Use artifacts"})})}),(0,z.jsx)(x.Z,{children:(0,z.jsxs)(we.Z,{sx:{flexGrow:1},size:"small",children:[(0,z.jsx)(Ae.CC,{children:(0,z.jsx)(Ae.ZP,{onChange:a,value:n,inputProps:{min:1,max:r,sx:{textAlign:"center"}},sx:{width:"100%",height:"100%",pl:2}})}),(0,z.jsx)(j.Z,{disabled:1===n,onClick:function onClick(){return a(1)},children:(0,z.jsx)(zn.Z,{})}),(0,z.jsx)(j.Z,{disabled:1===n,onClick:function onClick(){return a(n-1)},children:(0,z.jsx)(Vn.Z,{})}),(0,z.jsx)(j.Z,{disabled:n===r,onClick:function onClick(){return a(n+1)},children:(0,z.jsx)(Hn.Z,{})}),(0,z.jsx)(j.Z,{disabled:n===r,onClick:function onClick(){return a(r)},children:(0,z.jsx)($n.Z,{})}),(0,z.jsx)(j.Z,{color:"error",onClick:s,children:(0,z.jsx)(qe.Z,{})})]})})]}),(0,z.jsxs)(ue.ZP,{container:!0,columns:7,spacing:1,children:[(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(Yn.Z,{characterKey:t,onClick:d})}),(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(Jn.Z,{weaponId:f})}),Object.entries(h).map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(Sn.Z,{slotKey:n,artifactObj:c.arts.get(r)})},n)}))]})]})}function NewItem(e){var t=e.onAdd,n=e.list,r=(0,v.$)("page_character_optimize").t,a=(0,R.Z)(!1),s=(0,i.Z)(a,3),l=s[0],o=s[1],c=s[2],u=(0,Z.useCallback)((function(e){return!!e&&!n.includes(e.key)}),[n]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Z.Suspense,{fallback:!1,children:(0,z.jsx)(Xn,{show:l,onHide:c,onSelect:t,filter:u})}),(0,z.jsx)(j.Z,{fullWidth:!0,sx:{height:60},color:"info",onClick:o,startIcon:(0,z.jsx)(Un.Z,{}),children:(0,z.jsx)(Ye.c,{t:r,i18nKey:"useEquipped.modal.add",children:"Add character to list"})})]})}function UseExcluded(e){var t=e.disabled,n=void 0!==t&&t,r=e.artsDirty,i=(0,v.$)("page_character_optimize").t,a=(0,Z.useContext)(D.K).character.key,s=useBuildSetting(a),l=s.buildSetting.useExcludedArts,o=s.buildSettingDispatch,c=(0,Z.useContext)(M.t).database,u=(0,Z.useMemo)((function(){return r&&c.arts.values.reduce((function(e,t){return e+(t.exclude&&t.location!==a?1:0)}),0)}),[c,r,a]);return(0,z.jsx)(j.Z,{fullWidth:!0,onClick:function onClick(){return o({useExcludedArts:!l})},disabled:!u||n,startIcon:l?(0,z.jsx)(he.Z,{}):(0,z.jsx)(pe.Z,{}),color:l?"success":"secondary",children:(0,z.jsxs)(x.Z,{children:[(0,z.jsx)("span",{children:(0,z.jsx)(Ye.c,{t:i,i18nKey:"useExcluded.title",count:u,children:"Use Excluded Artifacts"})}),l&&(0,z.jsx)(A.Z,{children:(0,z.jsxs)(Ye.c,{t:i,i18nKey:"useExcluded.usingNum",count:u,children:["Using ",(0,z.jsx)("strong",{children:{count:u}})," excluded artifacts"]})})]})})}var Qn,er,tr,nr,rr,ir=n(4942),ar=n(50765),sr=(0,xt.yY)((0,ot.I8)({dyn:(0,xe.Z)((0,xe.Z)({},Ze.qH.art),Ze.qH.artSet)})),lr={art:(0,ot.O)([].concat((0,oe.Z)(ar.r),(0,oe.Z)(ar._)),(function(e){return sr.dyn[e]})),artSet:(0,ot.xh)(Ze.qH.artSet,(function(e,t){return sr.dyn[t]}))};function compactArtifacts(e,t,n){var r,i={base:{},values:{flower:[],plume:[],goblet:[],circlet:[],sands:[]}},a=new Set,s=(0,ut.Z)(e);try{for(s.s();!(r=s.n()).done;){var l,o=r.value,c=Xt.ZP.mainStatValue(o.mainStatKey,o.rarity,Math.max(Math.min(t,4*o.rarity),o.level)),u={id:o.id,set:o.setKey,values:(0,xe.Z)((l={},(0,ir.Z)(l,o.setKey,1),(0,ir.Z)(l,o.mainStatKey,o.mainStatKey.endsWith("_")?c/100:c),l),Object.fromEntries(o.substats.map((function(e){return[e.key,e.key.endsWith("_")?e.accurateValue/100:e.accurateValue]}))))};delete u.values[""],i.values[o.slotKey].push(u),Object.keys(u.values).forEach((function(e){return a.add(e)}))}}catch(f){s.e(f)}finally{s.f()}if(i.base=(0,ot.O)((0,oe.Z)(a),(function(e){return 0})),n)for(var d=0,x=Object.values(i.values);d<x.length;d++){x[d].push({id:"",values:{}})}return i}function useMemoEq(e,t){var n=e(),r=(0,Z.useRef)(n);return t(r.current,n)||(r.current=n),r.current}var or=function arrayEq(e,t){return e.length===t.length&&e.every((function(e,n){return t[n]===e}))};function TabBuild(){var e,t,a=(0,v.$)("page_character_optimize").t,s=(0,Z.useContext)(D.K).character,l=s.key,c=s.compareData,u=(0,Z.useContext)(M.t).database,d=(0,Z.useContext)(E),f=d.setChartData,p=d.graphBuilds,m=d.setGraphBuilds,y=(0,Z.useState)({type:"inactive",tested:0,failed:0,skipped:0,total:0}),b=(0,i.Z)(y,2),S=b[0],w=b[1],A="inactive"!==S.type,P=(0,st.Z)(),I=(0,i.Z)(P,2),R=I[0],B=I[1],O=(0,Z.useState)(u.displayOptimize.get()),_=(0,i.Z)(O,2),L=_[0],F=L.equipmentPriority,G=L.threads,V=void 0===G?rt.g:G,H=_[1];(0,Z.useEffect)((function(){return u.displayOptimize.follow((function(e,t){return H(t)}))}),[u,H]);var $=V>rt.g?rt.g:V,Y=(0,Z.useCallback)((function(e){return u.displayOptimize.set({threads:e})}),[u]),J=(0,T.Z)(l),Q=(0,q.Z)();(0,Z.useEffect)((function(){w({type:"inactive",tested:0,failed:0,skipped:0,total:0})}),[l]);var ee=(0,Z.useMemo)((function(){return!u.arts.values.length}),[u]),te=useBuildSetting(l),ne=te.buildSetting,re=te.buildSettingDispatch,ie=ne.mainStatAssumptionLevel,ae=ne.allowPartial,se=ne.maxBuildsToShow,le=ne.levelLow,ce=ne.levelHigh,de=useMemoEq((function(){return ne.plotBase}),(function(e,t){return!!(e&&t&&or(e,t))})),fe=useMemoEq((function(){return ne.optimizationTarget}),(function(e,t){return!!(e&&t&&or(e,t))})),me=useBuildResult(l),je=me.buildResult,Ze=je.builds,ve=je.buildDate,ge=me.buildResultDispatch,ye=(0,N.Z)(l,ie),be=null!==(e=null===ye||void 0===ye?void 0:ye[l])&&void 0!==e?e:{},Ce=be.characterSheet,Se=be.target,ke=fe&&(0,ot.Hm)(null===Se||void 0===Se?void 0:Se.getDisplay(),fe),Ae=["xs","sm"].includes((0,lt.Z)());(0,Z.useEffect)((function(){return u.arts.followAny(B)}),[B,u]);var De=(0,Z.useRef)((function(){}));(0,Z.useEffect)((function(){return function(){return De.current()}}),[]);var Ke=(0,Z.useCallback)((0,Ge.Z)((0,Fe.Z)().mark((function _callee2(){var e,t,r,a,s,o,c,d,x,h,p,m,j,Z,v,g,y,b,C,S,k,A,D,K,P,E,I,M,R,B,T,O,_,L,G,q,z,V,H,U,Y,J,X,Q,ee,te,re,ie,ae,se,le,ce,ue,de,fe,he,pe,me,je,Ze;return(0,Fe.Z)().wrap((function _callee2$(ve){for(;;)switch(ve.prev=ve.next){case 0:if(ie=function _fetchRequestWork(){var e=Y.pop();return e?{command:"iterate",threshold:ee(),filter:e}:void 0},re=function _fetchPruningWork(){var e=U.next(),t=e.done,n=e.value;return t?void 0:{command:"split",minCount:V,threshold:ee(),filter:n}},te=function _fetchContinueWork(){return{command:"split",filter:void 0,minCount:V,threshold:ee()}},ee=function _getThreshold(){return z.buildValues[j-1].val},a=ne.artSetExclusion,s=ne.plotBase,o=ne.statFilters,c=ne.mainStatKeys,d=ne.optimizationTarget,x=ne.mainStatAssumptionLevel,h=ne.useExcludedArts,p=ne.useEquippedArts,m=ne.allowPartial,j=ne.maxBuildsToShow,Z=ne.levelLow,v=ne.levelHigh,l&&d){ve.next=7;break}return ve.abrupt("return");case 7:return g=new Set,p&&((y=F.indexOf(l))<0?F.forEach((function(e){return g.add((0,W.V7)(e))})):F.slice(0,y).forEach((function(e){return g.add((0,W.V7)(e))}))),b=u.arts.values.filter((function(e){if(e.level<Z)return!1;if(e.level>v)return!1;var t=c[e.slotKey];return!(null!==t&&void 0!==t&&t.length&&!t.includes(e.mainStatKey))&&(e.location===(0,W.V7)(l)||!(e.exclude&&!h)&&(!(e.location&&!p)&&!(e.location&&p&&g.has(e.location))))})),C=compactArtifacts(b,x,m),ve.next=13,(0,N.V)(u,l,x,[]);case 13:if(S=ve.sent){ve.next=16;break}return ve.abrupt("return");case 16:if(k=null===(e=(0,it.Qo)(S.teamData,l)[l])||void 0===e?void 0:e.target.data[0]){ve.next=19;break}return ve.abrupt("return");case 19:if(Object.assign(k,(0,it.b3)([k,lr])),A=(0,ot.Hm)(null!==(t=k.display)&&void 0!==t?t:{},d)){ve.next=23;break}return ve.abrupt("return");case 23:for(D=A,K=Object.entries(o).flatMap((function(e){var t=(0,i.Z)(e,2),n=t[0];return t[1].filter((function(e){return!e.disabled})).map((function(e){var t,r,i=(0,ot.Hm)(null!==(t=k.display)&&void 0!==t?t:{},JSON.parse(n));return{value:i,minimum:"%"===(null===(r=i.info)||void 0===r?void 0:r.unit)?e.value/100:e.value}}))})).filter((function(e){return e.value&&e.minimum>-1/0})),f(void 0),P=new Promise((function(e){return De.current=e})),E=[].concat((0,oe.Z)(K.map((function(e){return e.value}))),[A]),I=C,M=filterFeasiblePerm(artSetPerm(a,Object.values(C.values).flatMap((function(e){return e.map((function(e){return e.set}))}))),C),R=[].concat((0,oe.Z)(K.map((function(e){return e.minimum}))),[-1/0]),B={tested:0,failed:0,skipped:0,total:NaN,startTime:performance.now()},(T=s&&(0,ot.Hm)(null!==(r=k.display)&&void 0!==r?r:{},s))&&(E.push(T),R.push(-1/0)),O=I,_=pruneExclusion(_=(0,at.tL)(E,k,(function(e){return"dyn"!==(0,i.Z)(e.path,1)[0]})),a),L=pruneAll(_,R,I,j,a,{reaffine:!0,pruneArtRange:!0,pruneNodeRange:!0,pruneOrder:!0}),_=L.nodes,I=L.arts,_=(0,at.tL)(_,{},(function(e){return!1})),G=T?_.pop():void 0,q=_.pop(),z={buildValues:Array(j).fill(0).map((function(e){return{src:"",val:-1/0}}))},V=16e6,H=16*$,U=M[Symbol.iterator](),Y=[],J=[],X=new Set,Q=[],ae=_.map((function(e,t){return{value:e,min:R[t]}})).filter((function(e){return e.min>-1/0})),se=[],le=function _loop(e){var t=new Worker(new URL(n.p+n.u(349),n.b)),r={command:"setup",id:e,arts:I,optimizationTarget:q,plotBase:G,maxBuilds:j,filters:ae};if(t.postMessage(r,void 0),0===e){var s={command:"count",exclusion:a,arts:[I,O]};t.postMessage(s,void 0)}var l=void 0,o=new Promise((function(e){return l=e}));t.onmessage=function(){var e=(0,Ge.Z)((0,Fe.Z)().mark((function _callee(e){var n,r,a,s,o,c,u,d;return(0,Fe.Z)().wrap((function _callee$(x){for(;;)switch(x.prev=x.next){case 0:n=e.data,x.t0=n.command,x.next="interim"===x.t0?4:"split"===x.t0?9:"iterate"===x.t0?12:"finalize"===x.t0?14:"count"===x.t0?17:21;break;case 4:return B.tested+=n.tested,B.failed+=n.failed,B.skipped+=n.skipped,n.buildValues&&(z.buildValues=z.buildValues.filter((function(e){return e.src!==n.source})),(r=z.buildValues).push.apply(r,(0,oe.Z)(n.buildValues.map((function(e){return{src:n.source,val:e}})))),z.buildValues.sort((function(e,t){return t.val-e.val})).splice(j)),x.abrupt("break",22);case 9:return n.filter?(Y.push(n.filter),X.add(n.id)):X.delete(n.id),J.push(n.id),x.abrupt("break",22);case 12:return J.push(n.id),x.abrupt("break",22);case 14:return t.terminate(),l(n),x.abrupt("return");case 17:return a=(0,i.Z)(n.counts,2),s=a[0],o=a[1],B.total=o,B.skipped+=o-s,x.abrupt("return");case 21:console.log("DEBUG",n);case 22:if(!J.length){x.next=36;break}if(c=J.pop(),u=Q[c],d=void 0,Y.length<H&&!(d=re())&&X.has(c)&&(d=te()),d||(d=ie()),!d){x.next=31;break}u.postMessage(d),x.next=34;break;case 31:return J.push(c),J.length===4*$&&function(){var e={command:"finalize"};Q.forEach((function(t){return t.postMessage(e)}))}(),x.abrupt("break",36);case 34:x.next=22;break;case 36:case"end":return x.stop()}}),_callee)})));return function(t){return e.apply(this,arguments)}}(),Q.push(t),P.then((function(){return t.terminate()})),se.push(o)},ce=0;ce<$;ce++)le(ce);for(ue=0;ue<3;ue++)J.push.apply(J,(0,oe.Z)((0,ot.w6)(0,$-1)));return de=setInterval((function(){return w((0,xe.Z)({type:"active"},B))}),100),ve.next=55,Promise.any([Promise.all(se),P]);case 55:fe=ve.sent,clearInterval(de),De.current=function(){},fe?(T&&(me=mergePlot(fe.map((function(e){return e.plotData}))),je=Object.values(me),"%"===(null===(he=D.info)||void 0===he?void 0:he.unit)&&(je=je.map((function(e){return{value:100*e.value,plot:e.plot,artifactIds:e.artifactIds}}))),"%"===(null===(pe=T.info)||void 0===pe?void 0:pe.unit)&&(je=je.map((function(e){var t=e.value,n=e.plot;return{value:t,plot:100*(null!==n&&void 0!==n?n:0),artifactIds:e.artifactIds}}))),f({valueNode:D,plotNode:T,data:je})),Ze=mergeBuilds(fe.map((function(e){return e.builds})),j),ge({builds:Ze.map((function(e){return e.artifactIds})),buildDate:Date.now()})):(B.tested=0,B.failed=0,B.skipped=0,B.total=0),w((0,xe.Z)((0,xe.Z)({},B),{},{type:"inactive",finishTime:performance.now()}));case 60:case"end":return ve.stop()}}),_callee2)}))),[l,u,ge,$,ne,F,f]),Pe=null!==(t=null===Ce||void 0===Ce?void 0:Ce.name)&&void 0!==t?t:"Character Name",Ee=(0,Z.useCallback)((function(e){re({plotBase:e}),f(void 0)}),[re,f]),Ie=(0,Z.useMemo)((function(){return Se&&ye&&{data:Se,teamData:ye}}),[Se,ye]),Me=(0,Z.useMemo)((function(){return(0,z.jsx)(bn.Z,{optimizationTarget:fe,setTarget:function setTarget(e){return re({optimizationTarget:e})},disabled:A})}),[re,A,fe]),Re=(0,Z.useMemo)((function(){return(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,children:[(0,z.jsx)(ue.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:(0,z.jsx)(x.Z,{children:(0,z.jsx)(Qe.Z,{characterKey:l,onClickTeammate:Q})})}),(0,z.jsxs)(ue.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:[(0,z.jsxs)(C.Z,{children:[(0,z.jsxs)(h.Z,{children:[(0,z.jsx)(X.Z,{gutterBottom:!0,children:a(Qn||(Qn=(0,r.Z)(["mainStat.title"])))}),(0,z.jsx)(Xe.Z,{placement:"top",title:(0,z.jsxs)(x.Z,{children:[(0,z.jsx)(X.Z,{variant:"h6",children:a(er||(er=(0,r.Z)(["mainStat.levelAssTooltip.title"])))}),(0,z.jsx)(X.Z,{children:a(tr||(tr=(0,r.Z)(["mainStat.levelAssTooltip.desc"])))})]}),children:(0,z.jsx)(x.Z,{children:(0,z.jsx)(AssumeFullLevelToggle,{mainStatAssumptionLevel:ie,setmainStatAssumptionLevel:function setmainStatAssumptionLevel(e){return re({mainStatAssumptionLevel:e})},disabled:A})})})]}),(0,z.jsx)(MainStatSelectionCard,{disabled:A})]}),(0,z.jsx)(BonusStatsCard,{})]}),(0,z.jsxs)(ue.ZP,{item:!0,xs:12,sm:6,lg:6,display:"flex",flexDirection:"column",gap:1,children:[(0,z.jsx)(ArtifactSetConfig,{disabled:A}),(0,z.jsx)(UseExcluded,{disabled:A,artsDirty:R}),(0,z.jsx)(UseEquipped,{disabled:A}),(0,z.jsx)(j.Z,{fullWidth:!0,startIcon:ae?(0,z.jsx)(he.Z,{}):(0,z.jsx)(pe.Z,{}),color:ae?"success":"secondary",onClick:function onClick(){return re({allowPartial:!ae})},disabled:A,children:a(nr||(nr=(0,r.Z)(["allowPartial"])))}),(0,z.jsxs)(C.Z,{children:[(0,z.jsx)(h.Z,{children:a(rr||(rr=(0,r.Z)(["levelFilter"])))}),(0,z.jsx)(Je.Z,{levelLow:le,levelHigh:ce,setLow:function setLow(e){return re({levelLow:e})},setHigh:function setHigh(e){return re({levelHigh:e})},setBoth:function setBoth(e,t){return re({levelLow:e,levelHigh:t})},disabled:A})]}),(0,z.jsx)(StatFilterCard,{disabled:A})]})]})}),[ae,R,re,l,A,ce,le,ie,Q,a]),Be=(0,Z.useMemo)((function(){return(0,z.jsxs)(et.Z,{disabled:A||!l,title:(0,z.jsxs)(Ye.c,{t:a,i18nKey:"build",count:se,children:[{count:se}," Builds"]}),children:[(0,z.jsx)(Ve.Z,{children:(0,z.jsx)(X.Z,{variant:"caption",color:"info.main",children:a("buildDropdownDesc")})}),(0,z.jsx)(U.Z,{}),ct.s.map((function(e){return(0,z.jsx)(Ve.Z,{onClick:function onClick(){return re({maxBuildsToShow:e})},children:(0,z.jsxs)(Ye.c,{t:a,i18nKey:"build",count:e,children:[{count:e}," Builds"]})},e)}))]})}),[re,l,A,se,a]),Te=(0,Z.useMemo)((function(){return(0,z.jsxs)(et.Z,{disabled:A||!l,sx:{borderRadius:"4px 0px 0px 4px"},title:(0,z.jsxs)(Ye.c,{t:a,i18nKey:"thread",count:$,children:[{count:$}," Threads"]}),children:[(0,z.jsx)(Ve.Z,{children:(0,z.jsx)(X.Z,{variant:"caption",color:"info.main",children:a("threadDropdownDesc")})}),(0,z.jsx)(U.Z,{}),(0,ot.w6)(1,rt.g).reverse().map((function(e){return(0,z.jsx)(Ve.Z,{onClick:function onClick(){return Y(e)},children:(0,z.jsxs)(Ye.c,{t:a,i18nKey:"thread",count:e,children:[{count:e}," Threads"]})},e)}))]})}),[l,A,$,Y,a]),Oe=(0,Z.useMemo)((function(){return(0,z.jsxs)(we.Z,{children:[!Ae&&Me,Be,Te,(0,z.jsx)(Xe.Z,{placement:"top",title:fe?"":a("selectTargetFirst"),children:(0,z.jsx)("span",{children:(0,z.jsx)(j.Z,{disabled:!l||!fe||!ke||ke.isEmpty,color:A?"error":"success",onClick:A?function(){return De.current()}:Ke,startIcon:A?(0,z.jsx)(qe.Z,{}):(0,z.jsx)(o.Z,{}),sx:{borderRadius:"0px 4px 4px 0px"},children:a(A?"generateButton.cancel":"generateButton.generateBuilds")})})})]})}),[l,Ke,A,Ae,fe,ke,Be,Te,a,Me]),_e=(0,Z.useMemo)((function(){return(0,z.jsx)(x.Z,{children:(0,z.jsx)(ChartCard,{disabled:A||!fe,plotBase:de,setPlotBase:Ee,showTooltip:!fe,graphBuilds:p,setGraphBuilds:m})})}),[A,p,fe,de,m,Ee]),Ne=(0,Z.useMemo)((function(){return(0,z.jsx)(C.Z,{children:(0,z.jsxs)(h.Z,{children:[(0,z.jsxs)(x.Z,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,z.jsx)(X.Z,{sx:{flexGrow:1},children:Ze?(0,z.jsxs)("span",{children:["Showing ",(0,z.jsx)("strong",{children:Ze.length+(p?p.length:0)})," build generated for ",Pe,". ",!!ve&&(0,z.jsxs)("span",{children:["Build generated on: ",(0,z.jsx)("strong",{children:new Date(ve).toLocaleString()})]})]}):(0,z.jsx)("span",{children:"Select a character to generate builds."})}),(0,z.jsx)(j.Z,{disabled:!Ze.length,color:"error",onClick:function onClick(){m(void 0),ge({builds:[],buildDate:0})},children:"Clear Builds"})]}),(0,z.jsxs)(ue.ZP,{container:!0,display:"flex",spacing:1,children:[(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsx)(k.Hn,{size:"small"})}),(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsx)(k.oX,{size:"small"})}),(0,z.jsx)(ue.ZP,{item:!0,flexGrow:1}),(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsxs)(tt.Z,{exclusive:!0,value:c,onChange:function onChange(e,t){return J({compareData:t})},size:"small",children:[(0,z.jsx)(He.Z,{value:!1,disabled:!c,children:"Show new builds"}),(0,z.jsx)(He.Z,{value:!0,disabled:c,children:"Compare vs. equipped"})]})})]})]})})}),[ve,ge,Ze,J,Pe,c,p,m]),Le=(0,Z.useCallback)((function(e){return(0,z.jsxs)(Ye.c,{t:a,i18nKey:"graphBuildLabel",count:e+1,children:["Graph #",{count:e+1}]})}),[a]),We=(0,Z.useCallback)((function(e){return"#".concat(e+1)}),[]),ze=(0,Z.useMemo)((function(){return(0,z.jsxs)(z.Fragment,{children:[p&&(0,z.jsx)(BuildList,{builds:p,characterKey:l,data:Se,compareData:c,disabled:!!A,getLabel:Le,setBuilds:m}),(0,z.jsx)(BuildList,{builds:Ze,characterKey:l,data:Se,compareData:c,disabled:!!A,getLabel:We})]})}),[Ze,l,c,Se,A,Le,We,p,m]),ut=(0,Z.useMemo)((function(){return(0,z.jsx)(nt.Provider,{value:fe,children:ze})}),[ze,fe]);return(0,z.jsxs)(x.Z,{display:"flex",flexDirection:"column",gap:1,children:[ee&&(0,z.jsx)($e.Z,{severity:"warning",variant:"filled",children:(0,z.jsxs)(Ye.c,{t:a,i18nKey:"noArtis",children:["Oops! It looks like you haven't added any artifacts to GO yet! You should go to the ",(0,z.jsx)(Ue.Z,{component:g.rU,to:"/artifacts",children:"Artifacts"})," page and add some!"]})}),Ie&&(0,z.jsxs)(K.R.Provider,{value:Ie,children:[Re,Ae&&Me,Oe,!!l&&(0,z.jsx)(BuildAlert,{status:S,characterName:Pe,maxBuildsToShow:se}),_e,Ne,ut]})]})}function BuildList(e){var t=e.builds,n=e.setBuilds,r=e.characterKey,i=e.data,a=e.compareData,s=e.disabled,l=e.getLabel,o=(0,Z.useCallback)((function(e){if(n){var r=(0,oe.Z)(t);r.splice(e,1),n(r)}}),[t,n]);return(0,Z.useMemo)((function(){return(0,z.jsx)(Z.Suspense,{fallback:(0,z.jsx)(f.Z,{variant:"rectangular",width:"100%",height:600}),children:null===t||void 0===t?void 0:t.map((function(e,t){return r&&i&&(0,z.jsx)(DataContextWrapper,{characterKey:r,build:e,oldData:i,children:(0,z.jsx)(BuildItemWrapper,{index:t,label:l(t),build:e,compareData:a,disabled:s,deleteBuild:n?o:void 0})},t+e.join())}))})}),[t,r,i,l,a,s,n,o])}function BuildItemWrapper(e){var t=e.index,n=e.label,r=e.build,i=e.compareData,a=e.disabled,s=e.deleteBuild,l=(0,v.$)("page_character_optimize").t,o=(0,y.TH)(),u=(0,y.s0)(),d=(0,Z.useCallback)((function(){var e=o.pathname.split("/");e.pop(),u("".concat(e.join("/"),"/theorycraft"),{state:{build:r}})}),[u,r,o.pathname]);return(0,z.jsx)(BuildDisplayItem,{label:n,compareBuild:i,disabled:a,extraButtonsLeft:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(j.Z,{color:"info",size:"small",startIcon:(0,z.jsx)(c.Z,{}),onClick:d,children:l("theorycraftButton")}),s&&(0,z.jsx)(j.Z,{color:"error",size:"small",startIcon:(0,z.jsx)(ze.Z,{}),onClick:function onClick(){return s(t)},children:l("removeBuildButton")})]})})}function DataContextWrapper(e){var t=e.children,n=e.characterKey,r=e.build,a=e.oldData,s=(0,Z.useContext)(M.t).database,l=useBuildSetting(n).buildSetting.mainStatAssumptionLevel,o=(0,st.Z)(),c=(0,i.Z)(o,2),u=c[0],d=c[1];(0,Z.useEffect)((function(){return s.arts.followAny((function(e){return r.includes(e)&&d()}))}),[s,r,d]);var x=(0,Z.useMemo)((function(){return u&&r.map((function(e){return s.arts.get(e)}))}),[u,r,s]),f=(0,N.Z)(n,l,x),h=(0,Z.useMemo)((function(){return f&&{data:f[n].target,teamData:f,oldData:a}}),[f,a,n]);return h?(0,z.jsx)(K.R.Provider,{value:h,children:t}):null}var cr,ur,dr=n(14361),xr=n(90690),fr=n(96874),hr=n(2139),pr=n(65106),mr=n(97719),jr=n(95193),Zr=n(40165),vr=n(15678),gr=n(901),yr=n(90543),br=n(44824),Cr=n(46956),Sr=n(99405);function CompareBuildButton(e){var t=e.artId,n=e.weaponId,a=(0,v.$)("page_character").t,s=(0,R.Z)(!1),l=(0,i.Z)(s,3),o=l[0],c=l[1],u=l[2];return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(ie.Z,{open:o,onClose:u,containerProps:{maxWidth:"xl"},children:(0,z.jsx)(CompareContent,{artId:t,weaponId:n,onHide:u})}),(0,z.jsx)(Zr.Z,{title:(0,z.jsx)(X.Z,{children:a(cr||(cr=(0,r.Z)(["tabEquip.compare"])))}),placement:"top",arrow:!0,children:(0,z.jsx)(j.Z,{color:"info",size:"small",onClick:c,children:(0,z.jsx)(Sr.Z,{})})})]})}function CompareContent(e){var t=e.artId,n=e.weaponId,r=e.onHide,i=(0,Z.useContext)(M.t).database,a=(0,Z.useContext)(D.K).character,s=a.key,l=a.equippedArtifacts,o=useBuildSetting(s).buildSetting.mainStatAssumptionLevel,c=(0,Z.useContext)(K.R).data,u=(0,Z.useMemo)((function(){var e=i.arts.get(null!==t&&void 0!==t?t:""),n=(0,ot.xh)(l,(function(t,n){return n===(null===e||void 0===e?void 0:e.slotKey)?e:i.arts.get(t)}));return Object.values(n).filter((function(e){return e}))}),[i,l,t]),d=(0,N.Z)(s,o,u,n?i.weapons.get(n):void 0),x=(0,Z.useMemo)((function(){return d&&{data:d[s].target,teamData:d,oldData:c}}),[s,d,c]);return(0,z.jsx)(Z.Suspense,{fallback:(0,z.jsx)(f.Z,{variant:"rectangular",width:"100%",height:600}),children:x&&(0,z.jsx)(K.R.Provider,{value:x,children:(0,z.jsx)(BuildDisplayItem,{compareBuild:!0,extraButtonsLeft:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(k.Hn,{size:"small"}),(0,z.jsx)(k.oX,{size:"small"})]}),extraButtonsRight:(0,z.jsx)(z.Fragment,{children:(0,z.jsx)(j.Z,{size:"small",color:"error",onClick:r,children:(0,z.jsx)(qe.Z,{})})})})})})}var kr={xs:6,sm:6,md:9,lg:12,xl:12},wr=(0,Z.lazy)((function(){return n.e(182).then(n.bind(n,37673))}));function ArtifactSwapModal(e){var t=e.onChangeId,n=e.slotKey,a=e.show,s=e.onClose,l=(0,v.$)("page_character").t,o=(0,Z.useContext)(M.t).database,c=(0,Z.useCallback)((function(e){t(e),s()}),[t,s]),u=(0,Z.useCallback)((function(e,t){return(0,xe.Z)((0,xe.Z)((0,xe.Z)({},e),t),{},{slotKeys:[n]})}),[n]),d=(0,Z.useReducer)(u,(0,xe.Z)((0,xe.Z)({},(0,br.Af)()),{},{slotKeys:[n]})),p=(0,i.Z)(d,2),m=p[0],j=p[1],g=(0,st.Z)(),y=(0,i.Z)(g,2),C=y[0],k=y[1];(0,Z.useEffect)((function(){return o.arts.followAny(k)}),[o,k]);var w=(0,lt.Z)(),A=(0,Z.useMemo)((function(){return(0,br.EM)()}),[]),D=(0,Z.useMemo)((function(){var e=(0,Cr.C)(m,A);return C&&o.arts.values.filter(e).map((function(e){return e.id})).slice(0,kr[w])}),[C,o,A,m,w]);return(0,z.jsx)(ie.Z,{open:a,onClose:s,containerProps:{maxWidth:"xl"},children:(0,z.jsxs)(b.Z,{children:[(0,z.jsxs)(h.Z,{sx:{py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.jsxs)(X.Z,{variant:"h6",children:[n?(0,z.jsx)(re.Z,{src:Jt.Z.slot[n]}):null," ",l(ur||(ur=(0,r.Z)(["tabEquip.swapArt"])))]}),(0,z.jsx)(S.Z,{onClick:s})]}),(0,z.jsx)(U.Z,{}),(0,z.jsxs)(h.Z,{children:[(0,z.jsx)(Z.Suspense,{fallback:(0,z.jsx)(f.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.jsx)(wr,{filterOption:m,filterOptionDispatch:j,disableSlotFilter:!0})}),(0,z.jsx)(x.Z,{mt:1,children:(0,z.jsx)(Z.Suspense,{fallback:(0,z.jsx)(f.Z,{variant:"rectangular",width:"100%",height:300}),children:(0,z.jsx)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:D.map((function(e){return(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(on.Z,{artifactId:e,extraButtons:(0,z.jsx)(CompareBuildButton,{artId:e}),onClick:c})},e)}))})})})]})]})})}var Ar,Dr,Kr,Pr,Er,Ir,Mr,Rr=n(58165),Br=n(75308),Tr=n(66045),Or=(0,Br.X)((0,oe.Z)(W.wC));function WeaponSwapModal(e){var t=e.onChangeId,n=e.weaponTypeKey,a=e.show,s=e.onClose,l=(0,v.$)(["page_character","page_weapon","weaponNames_gen"]).t,o=(0,Z.useContext)(M.t).database,c=(0,Z.useCallback)((function(e){t(e),s()}),[t,s]),u=(0,st.Z)(),d=(0,i.Z)(u,2),f=d[0],p=d[1];(0,Z.useEffect)((function(){return o.weapons.followAny(p)}),[p,o]);var m=(0,_.Z)((function(){return an.Z.getAll}),[]),j=(0,Z.useState)([5,4,3]),g=(0,i.Z)(j,2),y=g[0],C=g[1],k=(0,Z.useState)(""),w=(0,i.Z)(k,2),A=w[0],D=w[1],K=(0,Z.useDeferredValue)(A),P=(0,Z.useMemo)((function(){var e,t;return null!==(e=m&&f&&o.weapons.values.filter((0,Cr.C)({weaponType:n,rarity:y,name:K},(0,Tr.Xg)(m))).sort((0,Cr.e)(null!==(t=Tr.gd.level)&&void 0!==t?t:[],!1,(0,Tr.Sn)(m))).map((function(e){return e.id})))&&void 0!==e?e:[]}),[f,o,m,y,n,K]);return(0,z.jsx)(ie.Z,{open:a,onClose:s,children:(0,z.jsxs)(b.Z,{children:[(0,z.jsx)(h.Z,{sx:{py:1},children:(0,z.jsxs)(ue.ZP,{container:!0,children:[(0,z.jsx)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.jsxs)(X.Z,{variant:"h6",children:[n?(0,z.jsx)(re.Z,{src:Jt.Z.weaponTypes[n]}):null," ",l(Ar||(Ar=(0,r.Z)(["page_character:tabEquip.swapWeapon"])))]})}),(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsx)(S.Z,{onClick:s})})]})}),(0,z.jsx)(U.Z,{}),(0,z.jsxs)(h.Z,{children:[(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,mb:1,children:[(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsx)(tt.Z,{sx:{height:"100%"},value:y,size:"small",children:W.wC.map((function(e){return(0,z.jsx)(He.Z,{value:e,onClick:function onClick(){return C(Or(y,e))},children:(0,z.jsxs)(x.Z,{display:"flex",gap:1,children:[(0,z.jsx)("strong",{children:e}),(0,z.jsx)(_t.q,{stars:1})]})},e)}))})}),(0,z.jsx)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.jsx)(Rr.Z,{autoFocus:!0,size:"small",value:A,onChange:function onChange(e){return D(e.target.value)},label:l("page_weapon:weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),(0,z.jsx)(ue.ZP,{container:!0,spacing:1,children:P.map((function(e){return(0,z.jsx)(ue.ZP,{item:!0,xs:6,sm:6,md:4,lg:3,children:(0,z.jsx)(yr.Z,{weaponId:e,onClick:c,extraButtons:(0,z.jsx)(CompareBuildButton,{weaponId:e})})},e)}))})]})]})})}var _r=(0,Z.lazy)((function(){return n.e(923).then(n.bind(n,74476))}));function EquipmentSection(){var e,t=(0,Z.useContext)(D.K),n=t.character,r=n.equippedWeapon,a=n.key,s=t.characterSheet,l=useBuildSetting(a).buildSetting.mainStatAssumptionLevel,o=(0,Z.useContext)(K.R),c=o.teamData,u=o.data,d=null===(e=c[a])||void 0===e?void 0:e.weaponSheet,f=(0,Z.useState)(""),p=(0,i.Z)(f,2),m=p[0],j=p[1],v=(0,Z.useCallback)((function(){return j(r)}),[r]),g=(0,Z.useCallback)((function(){return j("")}),[]);(0,Z.useEffect)((function(){m&&m!==r&&j(r)}),[m,r]);var y=(0,Ut.Z)(),b=(0,jr.Z)(y.breakpoints.up("lg")),S=(0,Z.useMemo)((function(){return d&&d.document.length>0&&(0,z.jsx)(C.Z,{children:(0,z.jsx)(h.Z,{children:(0,z.jsx)(vt.Z,{sections:d.document})})})}),[d]),k=(0,pr.Z)(a).rvFilter,w=(0,Z.useDeferredValue)(k),A=(0,Z.useMemo)((function(){return new Set(w)}),[w]);return(0,z.jsxs)(x.Z,{children:[(0,z.jsx)(Z.Suspense,{fallback:!1,children:(0,z.jsx)(_r,{weaponId:m,footer:!0,onClose:g,extraButtons:(0,z.jsx)(LargeWeaponSwapButton,{weaponTypeKey:s.weaponTypeKey})})}),(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,children:[b&&(0,z.jsxs)(ue.ZP,{item:!0,xs:12,md:12,lg:3,xl:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[S&&S,(0,z.jsx)(ArtifactSectionCard,{})]}),(0,z.jsxs)(ue.ZP,{item:!0,xs:12,md:12,lg:9,xl:9,container:!0,spacing:1,children:[(0,z.jsx)(ue.ZP,{item:!0,xs:12,sm:6,md:4,display:"flex",flexDirection:"column",gap:1,children:(0,z.jsx)(yr.Z,{weaponId:r,onEdit:v,canEquip:!0,extraButtons:(0,z.jsx)(WeaponSwapButton,{weaponTypeKey:s.weaponTypeKey})})}),W.eV.map((function(e){return(0,z.jsx)(ue.ZP,{item:!0,xs:12,sm:6,md:4,children:u.get(Ze.ri.art[e].id).value?(0,z.jsx)(on.Z,{artifactId:u.get(Ze.ri.art[e].id).value,mainStatAssumptionLevel:l,effFilter:A,extraButtons:(0,z.jsx)(ArtifactSwapButton,{slotKey:e}),editorProps:{},canExclude:!0,canEquip:!0}):(0,z.jsx)(ArtSwapCard,{slotKey:e})},e)}))]}),!b&&(0,z.jsxs)(ue.ZP,{item:!0,xs:12,md:12,xl:3,container:!0,spacing:1,children:[S&&(0,z.jsx)(ue.ZP,{item:!0,xs:12,md:6,lg:4,children:S}),(0,z.jsx)(ue.ZP,{item:!0,xs:12,md:6,lg:4,sx:{display:"flex",flexDirection:"column",gap:1},children:(0,z.jsx)(ArtifactSectionCard,{})})]})]})]})}function ArtSwapCard(e){var t=e.slotKey,n=(0,Z.useContext)(D.K).character.key,r=(0,Z.useContext)(M.t).database,a=(0,R.Z)(),s=(0,i.Z)(a,3),l=s[0],o=s[1],c=s[2];return(0,z.jsxs)(C.Z,{sx:{height:"100%",width:"100%",minHeight:300,display:"flex",flexDirection:"column"},children:[(0,z.jsx)(h.Z,{children:(0,z.jsx)(X.Z,{children:(0,z.jsx)(Tt.ZP,{slotKey:t})})}),(0,z.jsx)(U.Z,{}),(0,z.jsxs)(x.Z,{sx:{flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,z.jsx)(ArtifactSwapModal,{slotKey:t,show:l,onClose:c,onChangeId:function onChangeId(e){return r.arts.set(e,{location:(0,W.V7)(n)})}}),(0,z.jsx)(j.Z,{onClick:o,color:"info",sx:{borderRadius:"1em"},children:(0,z.jsx)(mr.Z,{sx:{height:100,width:100}})})]})]})}function WeaponSwapButton(e){var t=e.weaponTypeKey,n=(0,v.$)("page_character").t,a=(0,Z.useContext)(D.K).character.key,s=(0,Z.useContext)(M.t).database,l=(0,R.Z)(),o=(0,i.Z)(l,3),c=o[0],u=o[1],d=o[2];return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Zr.Z,{title:(0,z.jsx)(X.Z,{children:n(Dr||(Dr=(0,r.Z)(["tabEquip.swapWeapon"])))}),placement:"top",arrow:!0,children:(0,z.jsx)(j.Z,{color:"info",size:"small",onClick:u,children:(0,z.jsx)(mr.Z,{})})}),(0,z.jsx)(WeaponSwapModal,{weaponTypeKey:t,onChangeId:function onChangeId(e){return s.weapons.set(e,{location:(0,W.V7)(a)})},show:c,onClose:d})]})}function LargeWeaponSwapButton(e){var t=e.weaponTypeKey,n=(0,v.$)("page_character").t,a=(0,Z.useContext)(D.K).character.key,s=(0,Z.useContext)(M.t).database,l=(0,R.Z)(),o=(0,i.Z)(l,3),c=o[0],u=o[1],d=o[2];return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(j.Z,{color:"info",onClick:u,startIcon:(0,z.jsx)(mr.Z,{}),children:n(Kr||(Kr=(0,r.Z)(["tabEquip.swapWeapon"])))}),(0,z.jsx)(WeaponSwapModal,{weaponTypeKey:t,onChangeId:function onChangeId(e){return s.weapons.set(e,{location:(0,W.V7)(a)})},show:c,onClose:d})]})}function ArtifactSwapButton(e){var t=e.slotKey,n=(0,v.$)("page_character").t,a=(0,Z.useContext)(D.K).character.key,s=(0,Z.useContext)(M.t).database,l=(0,R.Z)(),o=(0,i.Z)(l,3),c=o[0],u=o[1],d=o[2];return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Zr.Z,{title:(0,z.jsx)(X.Z,{children:n(Pr||(Pr=(0,r.Z)(["tabEquip.swapArt"])))}),placement:"top",arrow:!0,children:(0,z.jsx)(j.Z,{color:"info",size:"small",onClick:u,children:(0,z.jsx)(mr.Z,{})})}),(0,z.jsx)(ArtifactSwapModal,{slotKey:t,show:c,onClose:d,onChangeId:function onChangeId(e){return s.arts.set(e,{location:(0,W.V7)(a)})}})]})}function ArtifactSectionCard(){var e,t=(0,v.$)(["page_character","artifact"]).t,n=(0,Z.useContext)(M.t).database,a=(0,Z.useContext)(D.K),s=a.character,l=a.character,o=l.key,c=l.equippedArtifacts,u=(0,Z.useContext)(K.R).data,d=(0,_.Z)((function(){return Zt.y.getAll}),[]),x=(0,Z.useMemo)((function(){return!!Object.values(c).filter((function(e){return e})).length}),[c]),f=(0,Z.useCallback)((function(){s&&window.confirm("Do you want to move all currently equipped artifacts to inventory?")&&Object.values(c).forEach((function(e){return n.arts.set(e,{location:""})}))}),[s,n,c]),p=(0,Z.useMemo)((function(){return d&&Zt.y.setEffects(d,u)}),[d,u]),m=(0,pr.Z)(o).rvFilter,g=(0,Z.useCallback)((function(e){return n.charMeta.set(o,{rvFilter:e})}),[n,o]),y=(0,R.Z)(),S=(0,i.Z)(y,3),k=S[0],w=S[1],A=S[2],P=(0,Z.useDeferredValue)(m),E=(0,Z.useMemo)((function(){var e=Object.values(c).reduce((function(e,t){var r=n.arts.get(t);if(r){var i=Xt.ZP.getArtifactEfficiency(r,new Set(P)),a=i.currentEfficiency,s=i.maxEfficiency,l=Xt.ZP.getArtifactEfficiency(r,new Set(ar._)),o=l.currentEfficiency,c=l.maxEfficiency;e.currentEfficiency=e.currentEfficiency+a,e.maxEfficiency=e.maxEfficiency+s,e.currentEfficiency_=e.currentEfficiency_+o,e.maxEfficiency_=e.maxEfficiency_+c}return e}),{currentEfficiency:0,currentEfficiency_:0,maxEfficiency:0,maxEfficiency_:0}),i=e.currentEfficiency,a=e.currentEfficiency_,s=e.maxEfficiency,l=e.maxEfficiency_;return{rvField:{text:t(Er||(Er=(0,r.Z)(["artifact:editor.curSubEff"]))),value:i-a?(0,z.jsxs)("span",{children:[(0,z.jsx)(gr.Z,{value:i,max:4500,valid:!0})," / ",(0,z.jsx)(gr.Z,{value:a,max:4500,valid:!0})]}):(0,z.jsx)(gr.Z,{value:i,max:4500,valid:!0})},rvmField:{text:t(Ir||(Ir=(0,r.Z)(["artifact:editor.maxSubEff"]))),canShow:function canShow(){return!!(a-l)},value:s-l?(0,z.jsxs)("span",{children:[(0,z.jsx)(gr.Z,{value:s,max:4500,valid:!0})," / ",(0,z.jsx)(gr.Z,{value:l,max:4500,valid:!0})]}):(0,z.jsx)(gr.Z,{value:s,max:4500,valid:!0})}}}),[t,P,c,n]),I=E.rvField,B=E.rvmField;return(0,z.jsxs)(C.Z,{children:[x&&(0,z.jsx)(j.Z,{color:"error",onClick:f,fullWidth:!0,sx:{borderBottomRightRadius:0,borderBottomLeftRadius:0},children:t(Mr||(Mr=(0,r.Z)(["tabEquip.unequipArts"])))}),(0,z.jsx)(h.Z,{children:(0,z.jsxs)(ce.Z,{spacing:1,children:[(0,z.jsxs)(b.Z,{children:[(0,z.jsx)(j.Z,{fullWidth:!0,color:"info",startIcon:(0,z.jsx)(jt.Z,{}),sx:{borderBottomLeftRadius:0,borderBottomRightRadius:0},onClick:w,children:"RV Filter"}),(0,z.jsx)(ie.Z,{open:k,onClose:A,children:(0,z.jsx)(b.Z,{children:(0,z.jsx)(h.Z,{children:(0,z.jsx)(vr.Z,{selectedKeys:m,onChange:g})})})}),(0,z.jsxs)(Ie.lD,{children:[(0,z.jsx)(Ie.ms,{field:I,component:de.ZP,data:u}),(null===B||void 0===B||null===(e=B.canShow)||void 0===e?void 0:e.call(B,u))&&(0,z.jsx)(Ie.ms,{field:B,component:de.ZP,data:u})]})]}),d&&p&&Object.entries(p).flatMap((function(e){var t=(0,i.Z)(e,2),n=t[0];return t[1].map((function(e){return(0,z.jsx)(b.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:(0,z.jsx)(SetEffectDisplay,{setKey:n,setNumKey:e},n+e)},n+e)}))}))]})})]})}function TabOverview(){var e=(0,Z.useRef)(),t=(0,Z.useCallback)((function(){var t,n;return null===e||void 0===e||null===(t=e.current)||void 0===t||null===(n=t.scrollIntoView)||void 0===n?void 0:n.call(t,{behavior:"smooth"})}),[e]);return(0,z.jsxs)(ce.Z,{spacing:1,children:[(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,z.jsx)(ue.ZP,{item:!0,xs:8,sm:5,md:4,lg:2.3,children:(0,z.jsx)(CharacterProfileCard,{})}),(0,z.jsxs)(ue.ZP,{item:!0,xs:12,sm:7,md:8,lg:9.7,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.jsx)(EquipmentRow,{onClick:t}),(0,z.jsx)(C.Z,{sx:{flexGrow:1,p:1},children:(0,z.jsx)(StatDisplayComponent,{})})]})]}),(0,z.jsx)(x.Z,{ref:e,children:(0,z.jsx)(EquipmentSection,{})})]})}function EquipmentRow(e){var t=e.onClick,n=(0,Z.useContext)(D.K).character.equippedWeapon,r=(0,Z.useContext)(K.R).data;return(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,sm:2,md:3,lg:6,xl:6},children:[(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(WeaponCardNano,{weaponId:n,BGComponent:C.Z,onClick:t})}),W.eV.map((function(e){return(0,z.jsx)(ue.ZP,{item:!0,xs:1,children:(0,z.jsx)(ArtifactCardNano,{artifactId:r.get(Ze.ri.art[e].id).value,slotKey:e,BGComponent:C.Z,onClick:t})},e)}))]})}function CharacterProfileCard(){var e,t=(0,Z.useContext)(M.t).database,n=(0,Z.useContext)(D.K),r=n.characterSheet,i=n.character,a=i.key,s=i.team,l=(0,Z.useContext)(K.R).data,o=(0,T.Z)(a),c=(0,y.s0)(),u=l.get(Ze.ri.charEle).value,d=r.weaponTypeKey,f=l.get(Ze.ri.lvl).value,h=l.get(Ze.ri.asc).value,p=l.get(Ze.ri.constellation).value,m={auto:l.get(Ze.ri.total.auto).value,skill:l.get(Ze.ri.total.skill).value,burst:l.get(Ze.ri.total.burst).value},j={auto:l.get(Ze.ri.bonus.auto).value,skill:l.get(Ze.ri.bonus.skill).value,burst:l.get(Ze.ri.bonus.burst).value},v=(0,pr.Z)(a).favorite;return(0,z.jsxs)(C.Z,{sx:{height:"100%"},children:[(0,z.jsxs)(x.Z,{sx:{position:"relative"},children:[(0,z.jsxs)(x.Z,{sx:{position:"absolute",width:"100%",height:"100%"},children:[(0,z.jsx)(X.Z,{variant:"h6",sx:{position:"absolute",left:"50%",bottom:0,transform:"translate(-50%, -50%)",opacity:.75},children:(0,z.jsx)(_t.q,{stars:r.rarity,colored:!0})}),(0,z.jsx)(x.Z,{sx:{position:"absolute",left:"50%",bottom:"5%",transform:"translate(-50%, -50%)",opacity:.85,width:"100%",display:"flex",justifyContent:"center",px:1},children:(0,z.jsx)(me.Z,{color:u,sx:{height:"auto"},label:(0,z.jsxs)(X.Z,{variant:"h6",sx:{display:"flex",gap:1,alignItems:"center"},children:[ke.Z[u],(0,z.jsx)(x.Z,{sx:{whiteSpace:"normal",textAlign:"center"},children:r.name}),(0,z.jsx)(re.Z,{src:null===(e=Jt.Z.weaponTypes)||void 0===e?void 0:e[d]})]})})}),(0,z.jsx)(x.Z,{sx:{position:"absolute",left:0,top:0},children:(0,z.jsx)(be.Z,{sx:{p:1},color:"error",onClick:function onClick(){return t.charMeta.set(a,{favorite:!v})},children:v?(0,z.jsx)(dr.Z,{}):(0,z.jsx)(xr.Z,{})})}),(0,z.jsx)(X.Z,{sx:{p:1,position:"absolute",right:0,top:0,opacity:.8},children:(0,z.jsx)(A.Z,{children:(0,hr.wQ)(f,h)})})]}),(0,z.jsx)(x.Z,{src:r.cardImg,component:"img",width:"100%",height:"auto"})]}),(0,z.jsxs)(x.Z,{children:[(0,z.jsx)($t.Z,{sx:{p:1},onClick:function onClick(){return c("talent")},children:(0,z.jsx)(ue.ZP,{container:!0,spacing:1,mt:-1,children:["auto","skill","burst"].map((function(e){var t;return(0,z.jsx)(ue.ZP,{item:!0,xs:4,children:(0,z.jsx)(fr.Z,{badgeContent:m[e],color:j[e]?"info":"secondary",overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},sx:{width:"100%",height:"100%","& > .MuiBadge-badge":{fontSize:"1.25em",padding:".25em .4em",borderRadius:".5em",lineHeight:1,height:"1.25em"}},children:(0,z.jsx)(x.Z,{component:"img",src:null===(t=r.getTalentOfKey(e))||void 0===t?void 0:t.img,width:"100%",height:"auto"})})},e)}))})}),(0,z.jsx)(X.Z,{sx:{textAlign:"center",mt:1},variant:"h6",children:r.constellationName}),(0,z.jsx)(ue.ZP,{container:!0,spacing:1,children:(0,ot.w6)(1,6).map((function(e){var t;return(0,z.jsx)(ue.ZP,{item:!0,xs:4,children:(0,z.jsx)($t.Z,{onClick:function onClick(){return o({constellation:e===p?e-1:e})},children:(0,z.jsx)(x.Z,{component:"img",src:null===(t=r.getTalentOfKey("constellation".concat(e)))||void 0===t?void 0:t.img,sx:(0,xe.Z)({},p>=e?{}:{filter:"brightness(50%)"}),width:"100%",height:"auto"})})},e)}))}),(0,z.jsx)($t.Z,{sx:{p:1},onClick:function onClick(){return c("teambuffs")},children:(0,z.jsx)(ue.ZP,{container:!0,columns:3,spacing:1,children:(0,ot.w6)(0,2).map((function(e){return(0,z.jsx)(ue.ZP,{item:!0,xs:1,height:"100%",children:(0,z.jsx)(Yn.Z,{characterKey:s[e],index:e})},e)}))})})]})]})}var Nr={xs:12,sm:6,md:4};function CharacterTalentPane(){var e=(0,Z.useContext)(D.K),t=e.character,n=e.characterSheet,r=(0,Z.useContext)(K.R).data,a=(0,T.Z)(t.key),s=r.get(Ze.ri.asc).value,l=r.get(Ze.ri.constellation).value,o=(0,Ut.Z)(),c=(0,jr.Z)(o.breakpoints.up("lg")),u=(0,Z.useMemo)((function(){return(0,ot.w6)(1,6).map((function(e){return(0,z.jsx)(SkillDisplayCard,{talentKey:"constellation".concat(e),subtitle:"Constellation Lv. ".concat(e),onClickTitle:function onClickTitle(){return a({constellation:e===l?e-1:e})}})}))}),[l,a]);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(ReactionDisplay,{}),(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,children:[c&&(0,z.jsxs)(ue.ZP,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.jsx)(C.Z,{children:(0,z.jsx)(h.Z,{children:(0,z.jsxs)(X.Z,{variant:"h6",sx:{textAlign:"center"},children:["Constellation Lv. ",l]})})}),u.map((function(e,t){return(0,z.jsx)(x.Z,{sx:{opacity:l>=t+1?1:.5},children:e},t)}))]}),(0,z.jsxs)(ue.ZP,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:[[["auto","Normal/Charged Attack"],["skill","Elemental Skill"],["burst","Elemental Burst"]].map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return(0,z.jsx)(ue.ZP,(0,xe.Z)((0,xe.Z)({item:!0},Nr),{},{children:(0,z.jsx)(SkillDisplayCard,{talentKey:n,subtitle:r})}),n)})),!!n.getTalentOfKey("sprint")&&(0,z.jsx)(ue.ZP,(0,xe.Z)((0,xe.Z)({item:!0},Nr),{},{children:(0,z.jsx)(SkillDisplayCard,{talentKey:"sprint",subtitle:"Alternative Sprint"})})),!!n.getTalentOfKey("passive")&&(0,z.jsx)(ue.ZP,(0,xe.Z)((0,xe.Z)({item:!0},Nr),{},{children:(0,z.jsx)(SkillDisplayCard,{talentKey:"passive",subtitle:"Passive"})})),[["passive1","Unlocked at Ascension 1",1],["passive2","Unlocked at Ascension 4",4],["passive3","Unlocked by Default",0]].map((function(e){var t=(0,i.Z)(e,3),r=t[0],a=t[1],l=t[2],o=s>=l;return n.getTalentOfKey(r)?(0,z.jsx)(ue.ZP,(0,xe.Z)((0,xe.Z)({item:!0,style:{opacity:o?1:.5}},Nr),{},{children:(0,z.jsx)(SkillDisplayCard,{talentKey:r,subtitle:a})}),r):null}))]}),!c&&(0,z.jsxs)(ue.ZP,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:[(0,z.jsx)(ue.ZP,{item:!0,xs:12,children:(0,z.jsx)(C.Z,{children:(0,z.jsx)(h.Z,{children:(0,z.jsxs)(X.Z,{variant:"h6",sx:{textAlign:"center"},children:["Constellation Lv. ",l]})})})}),u.map((function(e,t){return(0,z.jsx)(ue.ZP,(0,xe.Z)((0,xe.Z)({item:!0,sx:{opacity:l>=t+1?1:.5}},Nr),{},{children:e}),t)}))]})]})]})}function ReactionDisplay(){var e=(0,Z.useContext)(K.R).data,t=(0,Z.useContext)(P.M).setFormulaData,n=e.getDisplay().reaction;return(0,z.jsx)(C.Z,{children:(0,z.jsx)(h.Z,{children:(0,z.jsx)(ue.ZP,{container:!0,spacing:1,children:Object.entries(n).filter((function(e){var t=(0,i.Z)(e,2);t[0];return!t[1].isEmpty})).map((function(n){var r=(0,i.Z)(n,2),a=r[0],s=r[1];return(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsx)(b.Z,{children:(0,z.jsx)(h.Z,{sx:{p:1,"&:last-child":{pb:1}},children:(0,z.jsx)(Ie.JW,{node:s,data:e,setFormulaData:t})})})},a)}))})})})}var Lr=[1,1,2,4,6,8,10];function SkillDisplayCard(e){var t=e.talentKey,n=e.subtitle,r=e.onClickTitle,i=(0,Z.useContext)(D.K),a=i.character.talent,s=i.characterSheet,l=i.characterDispatch,o=(0,Z.useContext)(K.R).data,c=(0,Z.useCallback)((function(e){return(0,z.jsx)($t.Z,{onClick:r,children:e})}),[r]),u=(0,Z.useCallback)((function(e,t){return l({talent:(0,xe.Z)((0,xe.Z)({},a),{},(0,ir.Z)({},e,t))})}),[a,l]),d=null;if(t in a){var f=o.get(Ze.ri.bonus[t]).value,p=o.get(Ze.ri.total[t]).value,m=o.get(Ze.ri.asc).value;d=(0,z.jsx)(et.Z,{fullWidth:!0,title:"Talent Lv. ".concat(p),color:f?"info":"primary",sx:{borderRadius:0},children:(0,ot.w6)(1,Lr[m]).map((function(e){return(0,z.jsxs)(Ve.Z,{selected:a[t]===e,disabled:a[t]===e,onClick:function onClick(){return u(t,e)},children:["Talent Lv. ",e+f]},e)}))})}var j=s.getTalentOfKey(t);return(0,z.jsxs)(C.Z,{sx:{height:"100%"},children:[d,(0,z.jsxs)(h.Z,{children:[(0,z.jsx)(en.Z,{condition:!!r,wrapper:c,children:(0,z.jsxs)(ue.ZP,{container:!0,sx:{flexWrap:"nowrap"},children:[(0,z.jsx)(ue.ZP,{item:!0,children:(0,z.jsx)(x.Z,{component:"img",src:null===j||void 0===j?void 0:j.img,sx:{width:60,height:"auto"}})}),(0,z.jsxs)(ue.ZP,{item:!0,flexGrow:1,sx:{pl:1},children:[(0,z.jsx)(X.Z,{variant:"h6",children:null===j||void 0===j?void 0:j.name}),(0,z.jsx)(X.Z,{variant:"subtitle1",children:n})]})]})}),null!==j&&void 0!==j&&j.sections?(0,z.jsx)(vt.Z,{sections:j.sections,hideDesc:!0,hideHeader:function hideHeader(e){var n,r=null===(n=e.header)||void 0===n?void 0:n.action;return!(!r||"string"===typeof r)&&r.props.children.props.key18.includes(t)}}):null]})]})}var Wr,Fr,Gr=n(43992),qr=n(84082),zr=n(11741);function TabTeambuffs(){return(0,z.jsx)(x.Z,{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch",children:(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,children:[(0,z.jsxs)(ue.ZP,{item:!0,xs:12,md:6,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.jsx)(TeamBuffDisplay,{}),(0,z.jsx)(ResonanceDisplay,{})]}),(0,ot.w6)(0,2).map((function(e){return(0,z.jsx)(ue.ZP,{item:!0,xs:12,md:6,lg:3,children:(0,z.jsx)(TeammateDisplay,{index:e})},e)}))]})})}function TeamBuffDisplay(){var e,t,n,r=(0,Z.useContext)(K.R),a=r.data,s=r.oldData,l=(0,Z.useContext)(P.M).setFormulaData,o=a.getTeamBuff(),c=[];return Object.entries(null!==(e=o.total)&&void 0!==e?e:{}).forEach((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return!r.isEmpty&&0!==r.value&&c.push([["total",n],r])})),Object.entries(null!==(t=o.premod)&&void 0!==t?t:{}).forEach((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return!r.isEmpty&&0!==r.value&&c.push([["premod",n],r])})),Object.entries(null!==(n=o.enemy)&&void 0!==n?n:{}).forEach((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return!r.isEmpty&&"number"===typeof r.value&&0!==r.value&&c.push([["enemy",n],r])})),c.length?(0,z.jsxs)(C.Z,{children:[(0,z.jsx)(h.Z,{children:(0,z.jsx)(X.Z,{children:"Team Buffs"})}),(0,z.jsx)(U.Z,{}),(0,z.jsx)(h.Z,{children:(0,z.jsx)(ue.ZP,{container:!0,children:c.map((function(e){var t,n=(0,i.Z)(e,2),r=n[0],o=n[1];return o&&(0,z.jsx)(ue.ZP,{item:!0,xs:12,children:(0,z.jsx)(Ie.JW,{node:o,oldValue:null===(t=(0,ot.Hm)(null===s||void 0===s?void 0:s.getTeamBuff(),r))||void 0===t?void 0:t.value,data:a,setFormulaData:l})},JSON.stringify(o.info))}))})})]}):null}function ResonanceDisplay(){var e=(0,v.$)("page_character").t,t=(0,Z.useContext)(K.R).data,n=(0,Z.useContext)(D.K).character.team.reduce((function(e,t){return e+(t?1:0)}),1);return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(C.Z,{children:(0,z.jsx)($.Z,{title:(0,z.jsxs)("span",{children:[e("tabTeambuff.team_reso")," ",(0,z.jsx)("strong",{children:(0,z.jsxs)(ne.Z,{color:n>=4?"success":"warning",children:["(",n,"/4)"]})})," ",(0,z.jsx)(Ot.Z,{title:(0,z.jsx)(X.Z,{children:e(Wr||(Wr=(0,r.Z)(["tabTeambuff.resonance_tip"])))})})]}),titleTypographyProps:{variant:"subtitle2"}})}),zr.J.map((function(e,n){var r=(0,z.jsx)(Ot.Z,{title:(0,z.jsx)(X.Z,{children:e.desc})}),i=(0,z.jsxs)("span",{children:[e.name," ",r]});return(0,z.jsxs)(C.Z,{sx:{opacity:e.canShow(t)?1:.5},children:[(0,z.jsx)($.Z,{title:i,action:e.icon,titleTypographyProps:{variant:"subtitle2"}}),e.canShow(t)&&(0,z.jsx)(U.Z,{}),e.canShow(t)&&(0,z.jsx)(h.Z,{children:(0,z.jsx)(vt.Z,{sections:e.sections,teamBuffOnly:!0,hideDesc:!0})})]},n)}))]})}function TeammateDisplay(e){var t=e.index,n=(0,Z.useContext)(K.R).teamData,r=(0,v.$)("page_character").t,i=(0,Z.useContext)(D.K),a=i.character,s=i.character.key,l=i.characterDispatch,o=a.team[t],c=(0,Z.useMemo)((function(){return[s].concat((0,oe.Z)(a.team)).filter((function(e,n){return n-1!==t}))}),[a.team,s,t]),u=(0,q.Z)(),d=(0,Z.useCallback)((function(e){return l({type:"team",index:t,charKey:e})}),[t,l]),x=n[o],f=(0,Z.useMemo)((function(){var e;return x&&{character:(0,xe.Z)((0,xe.Z)({},x.character),{},{conditional:null!==(e=a.teamConditional[o])&&void 0!==e?e:{}}),characterSheet:x.characterSheet,characterDispatch:function characterDispatch(e){if(o&&"conditional"in e){var t=e.conditional;l({type:"teamConditional",teamMateKey:o,conditional:t})}}}}),[a,o,x,l]),h=(0,Z.useMemo)((function(){return x&&{data:x.target,teamData:n}}),[x,n]);return(0,z.jsxs)(C.Z,{children:[(0,z.jsx)(TeammateAutocomplete,{characterKey:o,team:c,setChar:d,label:r("teammate",{count:t+1})}),o&&f&&(0,z.jsx)(D.K.Provider,{value:f,children:h&&(0,z.jsx)(K.R.Provider,{value:h,children:(0,z.jsx)(Qe.Z,{characterKey:o,onClickHeader:u,artifactChildren:(0,z.jsx)(D.K.Provider,{value:f,children:(0,z.jsx)(K.R.Provider,{value:h,children:(0,z.jsx)(CharArtifactCondDisplay,{})})}),weaponChildren:(0,z.jsx)(D.K.Provider,{value:f,children:(0,z.jsx)(K.R.Provider,{value:h,children:(0,z.jsx)(CharWeaponCondDisplay,{})})}),characterChildren:(0,z.jsx)(D.K.Provider,{value:f,children:(0,z.jsx)(K.R.Provider,{value:h,children:(0,z.jsx)(CharTalentCondDisplay,{})})}),isTeammateCard:!0})})})]})}function CharArtifactCondDisplay(){var e=(0,Z.useContext)(K.R).data,t=(0,_.Z)((function(){return Zt.y.getAll}),[]),n=(0,Z.useMemo)((function(){return t&&Object.entries(Zt.y.setEffects(t,e)).flatMap((function(e){var n=(0,i.Z)(e,2),r=n[0];return n[1].flatMap((function(e){return t(r).setEffectDocument(e)}))}))}),[t,e]);return n?(0,z.jsx)(vt.Z,{sections:n,teamBuffOnly:!0}):null}function CharWeaponCondDisplay(){var e=(0,Z.useContext)(D.K).character.key,t=(0,Z.useContext)(K.R).teamData[e].weaponSheet;return t.document?(0,z.jsx)(vt.Z,{sections:t.document,teamBuffOnly:!0}):null}function CharTalentCondDisplay(){var e=(0,Z.useContext)(D.K).character.key,t=(0,Z.useContext)(K.R).teamData[e].characterSheet,n=Object.values(t.talent).flatMap((function(e){return e.sections}));return n?(0,z.jsx)(vt.Z,{sections:n,teamBuffOnly:!0}):null}function TeammateAutocomplete(e){var t=e.characterKey,n=e.team,i=e.label,a=e.setChar,s=e.autoCompleteProps,l=void 0===s?{}:s,o=(0,v.$)(["charNames_gen","page_character","sheet_gen"]).t,c=(0,Z.useContext)(M.t).database,u=(0,O.Z)().gender,d=(0,_.Z)((function(){return I.Z.getAll}),[]),x=(0,Z.useCallback)((function(e){var t;return e.startsWith("Traveler")?"".concat(o("charNames_gen:".concat((0,W.LP)(e,u)))," (").concat(o("sheet_gen:element.".concat(null===d||void 0===d||null===(t=d(e,u))||void 0===t?void 0:t.elementKey)),")"):o("charNames_gen:".concat(e))}),[d,o,u]),h=(0,Z.useCallback)((function(e){var t;return""===e?(0,z.jsx)(Gr.Z,{}):d?(0,z.jsx)(G.Z,{src:null===(t=d(e,u))||void 0===t?void 0:t.thumbImgSide,sx:{pr:1}}):(0,z.jsx)(z.Fragment,{})}),[d,u]),p=(0,Z.useCallback)((function(e){return c.charMeta.get(e).favorite}),[c]),m=(0,Z.useCallback)((function(e){var r=e.key;return n.filter((function(e){return e&&e!==t})).includes(r)||r.startsWith("Traveler")&&n.some((function(e,t){return e.startsWith("Traveler")}))}),[n,t]),j=(0,Z.useMemo)((function(){return[{key:"",label:o(Fr||(Fr=(0,r.Z)(["page_character:none"])))}].concat((0,oe.Z)(c.chars.keys.map((function(e){return{key:e,label:x(e),favorite:p(e)}})).sort((function(e,t){return e.favorite&&!t.favorite?-1:!e.favorite&&t.favorite?1:e.label.localeCompare(t.label)}))))}),[o,x,p,c]);return(0,z.jsx)(Z.Suspense,{fallback:(0,z.jsx)(f.Z,{variant:"text",width:100}),children:(0,z.jsx)(qr.Z,(0,xe.Z)({size:"small",label:i,options:j,valueKey:t,clearKey:"",onChange:a,getOptionDisabled:m,toImg:h},l))})}var Vr,Hr=n(49142),$r=n(16649),Ur=n(33439),Yr=n(94294),Jr=n(70867),Xr=n(82095),Qr=n(6805),ei=n(19391),ti=n(11400);var ni=Z.lazy((function(){return n.e(409).then(n.bind(n,44361))}));function TabTheorycraft(){var e,t,n=(0,Z.useContext)(M.t).database,r=(0,Z.useContext)(K.R).data,a=(0,Z.useContext)(D.K),s=a.character,l=a.character,o=l.key,c=l.compareData,u=a.characterSheet,d=a.characterDispatch,h=function useCharTC(e,t){var n=(0,Z.useContext)(M.t).database,r=(0,Z.useState)((function(){return n.charTCs.getWithInit(e,t)})),a=(0,i.Z)(r,2),s=a[0],l=a[1];return(0,Z.useEffect)((function(){return l(n.charTCs.getWithInit(e,t))}),[n,e,t]),(0,Z.useEffect)((function(){return e?n.charTCs.follow(e,(function(e,t,n){return"update"===t&&l(n)})):void 0}),[e,l,n]),s}(o,(0,ti.mT)(u.weaponTypeKey)),p=(0,Z.useCallback)((function(e){return n.charTCs.set(o,e)}),[o,n]),m=(0,Z.useCallback)((function(){p((0,ei.O)((0,ti.mT)(u.weaponTypeKey)))}),[p,u]),v=(0,Z.useCallback)((function(e){p((0,xe.Z)((0,xe.Z)({},h),{},{weapon:(0,xe.Z)((0,xe.Z)({},h.weapon),e)}))}),[p,h]),g=(0,Z.useCallback)((function(e,t){var n=(0,ei.O)(e.key);n.artifact.substats.type=h.artifact.substats.type,n.weapon.level=e.level,n.weapon.ascension=e.ascension,n.weapon.refinement=e.refinement;var r={};t.forEach((function(e){var t;if(e){var i=e.slotKey,a=e.setKey,s=e.substats,l=e.mainStatKey,o=e.level,c=e.rarity;n.artifact.slots[i].level=o,n.artifact.slots[i].statKey=l,n.artifact.slots[i].rarity=c,r[a]=(null!==(t=r[a])&&void 0!==t?t:0)+1,s.forEach((function(e){var t;e.key&&(n.artifact.substats.stats[e.key]=(null!==(t=n.artifact.substats.stats[e.key])&&void 0!==t?t:0)+e.accurateValue)}))}})),n.artifact.sets=Object.fromEntries(Object.entries(r).map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return[n,3===r?2:5===r?4:1!==r||n.startsWith("PrayersFor")?r:0]})).filter((function(e){var t=(0,i.Z)(e,2);t[0];return t[1]}))),p(n)}),[h,p]),b=(null!==(e=(0,y.TH)().state)&&void 0!==e?e:{build:void 0}).build;(0,Z.useEffect)((function(){if(b){var e=n.weapons.get(s.equippedWeapon);g(e,b.map((function(e){return n.arts.get(e)})))}}),[b,n]);var S=(0,Z.useCallback)((function(){var e=n.weapons.get(s.equippedWeapon);g(e,Object.values(s.equippedArtifacts).map((function(e){return n.arts.get(e)})).filter((function(e){return e})))}),[n,s.equippedArtifacts,s.equippedWeapon,g]),k=(0,Z.useMemo)((function(){return(0,xe.Z)((0,xe.Z)({},h.weapon),{},{location:"",lock:!1,id:""})}),[h]),w=(0,Z.useCallback)((function(e){var t=(0,ot.I8)(h);t.artifact=e,p(t)}),[h,p]),A=(0,Z.useCallback)((function(e){var t=(0,ot.I8)(h);t.artifact.substats.type=e,p(t)}),[h,p]),P=(0,Z.useCallback)((function(e){var t=(0,ot.I8)(h);t.artifact.substats.stats=e,p(t)}),[h,p]),E=(0,Z.useDeferredValue)(h),I=(0,Z.useMemo)((function(){var e=(0,xe.Z)({},E.artifact.substats.stats);return Object.values(E.artifact.slots).forEach((function(t){var n,r=t.statKey,i=t.rarity,a=t.level;return e[r]=(null!==(n=e[r])&&void 0!==n?n:0)+Xt.ZP.mainStatValue(r,i,a)})),{art:(0,ot.xh)(e,(function(e,t){return t.endsWith("_")?(0,xt.aQ)(e/100):(0,xt.a9)(e)})),artSet:(0,ot.xh)(E.artifact.sets,(function(e){return(0,xt.a9)(e)}))}}),[E]),R=(0,Z.useMemo)((function(){return{id:"",location:"",key:h.weapon.key,level:h.weapon.level,ascension:h.weapon.ascension,refinement:h.weapon.refinement,lock:!1}}),[h]),B=(0,N.Z)(o,0,I,R),T=(null!==(t=null===B||void 0===B?void 0:B[o])&&void 0!==t?t:{}).target,O=(0,Z.useMemo)((function(){if(B&&T)return{data:T,teamData:B}}),[T,B]),_=(0,Z.useMemo)((function(){if(O)return(0,xe.Z)((0,xe.Z)({},O),{},{oldData:c?r:void 0})}),[O,c,r]);return(0,z.jsxs)(ce.Z,{spacing:1,children:[(0,z.jsx)(C.Z,{children:(0,z.jsxs)(x.Z,{sx:{display:"flex",gap:1,p:1},children:[(0,z.jsxs)(x.Z,{sx:{flexGrow:1,display:"flex",gap:1},children:[(0,z.jsx)(j.Z,{color:"info",onClick:S,startIcon:(0,z.jsx)($r.Z,{}),children:"Copy from equipped"}),(0,z.jsx)(j.Z,{color:"error",onClick:m,startIcon:(0,z.jsx)(Ur.Z,{}),children:"Reset"})]}),(0,z.jsxs)(tt.Z,{exclusive:!0,value:c,onChange:function onChange(e,t){return d({compareData:t})},size:"small",children:[(0,z.jsx)(He.Z,{value:!1,disabled:!c,children:"Show TC stats"}),(0,z.jsx)(He.Z,{value:!0,disabled:c,children:"Compare vs. equipped"})]})]})}),O?(0,z.jsx)(K.R.Provider,{value:O,children:(0,z.jsxs)(ue.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,z.jsxs)(ue.ZP,{item:!0,sx:{flexGrow:-1},children:[(0,z.jsx)(WeaponEditorCard,{weapon:k,setWeapon:v,weaponTypeKey:u.weaponTypeKey}),(0,z.jsx)(ArtifactMainLevelCard,{artifactData:h.artifact,setArtifactData:w})]}),(0,z.jsx)(ue.ZP,{item:!0,sx:{flexGrow:1},children:(0,z.jsx)(ArtifactSubCard,{substats:h.artifact.substats.stats,setSubstats:P,substatsType:h.artifact.substats.type,setSubstatsType:A,mainStatKeys:Object.values(h.artifact.slots).map((function(e){return e.statKey}))})})]})}):(0,z.jsx)(f.Z,{variant:"rectangular",width:"100%",height:500}),(0,z.jsx)(C.Z,{sx:{flexGrow:1,p:1},children:_?(0,z.jsx)(K.R.Provider,{value:_,children:(0,z.jsx)(StatDisplayComponent,{})}):(0,z.jsx)(f.Z,{variant:"rectangular",width:"100%",height:500})})]})}function WeaponEditorCard(e){var t=e.weapon,n=e.setWeapon,r=e.weaponTypeKey,a=t.key,s=t.level,l=void 0===s?0:s,o=t.refinement,c=void 0===o?1:o,u=t.ascension,d=void 0===u?0:u,f=(0,_.Z)((function(){return an.Z.get(a)}),[a]),h=(0,R.Z)(),p=(0,i.Z)(h,3),m=p[0],v=p[1],g=p[2],y=(0,Z.useContext)(K.R).data,S=(0,Z.useContext)(P.M).setFormulaData,k=(0,Z.useMemo)((function(){return f&&t&&(0,it.mP)([f.data,(0,it.v0)(t)])}),[f,t]);return(0,z.jsxs)(C.Z,{sx:{p:1,mb:1},children:[(0,z.jsx)(ni,{ascension:d,show:m,onHide:g,onSelect:function onSelect(e){return n({key:e})},weaponTypeFilter:r}),(0,z.jsxs)(x.Z,{display:"flex",flexDirection:"column",gap:1,children:[(0,z.jsxs)(x.Z,{display:"flex",gap:1,children:[f&&(0,z.jsx)(x.Z,{className:"grad-".concat(f.rarity,"star"),component:"img",src:f.getImg(t.ascension),sx:{flexshrink:1,flexBasis:0,maxWidth:"30%",borderRadius:1}}),(0,z.jsxs)(ce.Z,{spacing:1,flexGrow:1,children:[(0,z.jsx)(j.Z,{fullWidth:!0,color:"info",sx:{flexGrow:1},onClick:v,children:(0,z.jsx)(x.Z,{sx:{maxWidth:"10em"},children:null===f||void 0===f?void 0:f.name})}),(null===f||void 0===f?void 0:f.hasRefinement)&&(0,z.jsx)(Qr.Z,{refinement:c,setRefinement:function setRefinement(e){return n({refinement:e})}})]})]}),f&&(0,z.jsx)(w.Z,{level:l,ascension:d,setBoth:n,useLow:!f.hasRefinement}),(0,z.jsxs)(b.Z,{children:[(0,z.jsx)($.Z,{title:"Main Stats",titleTypographyProps:{variant:"subtitle2"}}),(0,z.jsx)(U.Z,{}),k&&(0,z.jsx)(Ie.lD,{children:[Ze.ri.weapon.main,Ze.ri.weapon.sub,Ze.ri.weapon.sub2].map((function(e,t){var n=k.get(e);return n.isEmpty||!n.value?null:(0,z.jsx)(Ie.JW,{node:n,component:de.ZP,data:y,setFormulaData:S},JSON.stringify(n.info))}))})]}),y&&(null===f||void 0===f?void 0:f.document)&&(0,z.jsx)(vt.Z,{sections:f.document})]})]})}function ArtifactMainLevelCard(e){var t=e.artifactData,n=e.setArtifactData,r=(0,Z.useCallback)((function(e){return function(r){var i=(0,ot.I8)(t);i.slots[e]=r,n(i)}}),[t,n]),i=(0,Z.useCallback)((function(e){var r=(0,ot.I8)(t);r.sets=e,n(r)}),[t,n]);return(0,z.jsxs)(ce.Z,{spacing:1,children:[(0,z.jsx)(C.Z,{sx:{p:1},children:(0,z.jsx)(ce.Z,{spacing:1,children:W.eV.map((function(e){return(0,z.jsx)(ArtifactMainLevelSlot,{slotKey:e,slot:t.slots[e],setSlot:r(e)},e)}))})}),(0,z.jsx)(Z.Suspense,{fallback:(0,z.jsx)(f.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.jsx)(ArtifactSetsEditor,{artSet:t.sets,setArtSet:i})})]})}function ArtifactMainLevelSlot(e){var t,n=e.slotKey,r=e.slot,i=e.setSlot,a=r.level,s=r.statKey,l=r.rarity,o=Xt.ZP.slotMainStats(n),c=(0,Z.useCallback)((function(e){i((0,xe.Z)((0,xe.Z)({},r),e))}),[r,i]),u=(0,Z.useCallback)((function(e){var t,n=null!==(t=Xt.P4[e])&&void 0!==t?t:0;c(a>n?{rarity:e,level:n}:{rarity:e})}),[a,c]);return(0,z.jsxs)(x.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.jsx)(Xr.Z,{icon:Tt.xe[n]}),(0,z.jsx)(b.Z,{sx:{height:"100%",minWidth:"5em",flexGrow:1,display:"flex"},children:1===o.length?(0,z.jsxs)(x.Z,{p:1,justifyContent:"center",alignItems:"center",width:"100%",display:"flex",gap:1,children:[ke.Z[o[0]],ve.ZP.getStr(o[0])]}):(0,z.jsx)(et.Z,{sx:{px:0},fullWidth:!0,title:(0,z.jsx)(tn.x,{statKey:s}),color:null!==(t=ve.ZP.getVariant(s))&&void 0!==t?t:"success",children:o.map((function(e){return(0,z.jsx)(Ve.Z,{disabled:s===e,onClick:function onClick(){return c({statKey:e})},children:(0,z.jsx)(tn._,{statKey:e})},e)}))})}),(0,z.jsx)(et.Z,{sx:{px:0},title:(0,z.jsxs)("span",{children:[l," ",(0,z.jsx)(mt.G,{icon:pt.Tab})]}),children:[5,4,3].map((function(e){return(0,z.jsx)(Ve.Z,{disabled:l===e,onClick:function onClick(){return u(e)},children:(0,z.jsxs)("span",{children:[e," ",(0,z.jsx)(mt.G,{icon:pt.Tab})]})},e)}))}),(0,z.jsx)(Ae.ZP,{startAdornment:"+",value:a,color:Xt.ZP.levelVariant(a),onChange:function onChange(e){return void 0!==e&&c({level:e})},sx:{borderRadius:1,pl:1,my:0,height:"100%"},inputProps:{sx:{pl:.5,width:"2em"},max:20,min:0}}),(0,z.jsx)(b.Z,{sx:{height:"100%",minWidth:"4em"},children:(0,z.jsx)(x.Z,{p:1,textAlign:"center",children:"".concat((0,ve.qs)(Xt.ZP.mainStatValue(s,l,a),ve.ZP.unit(s))).concat(ve.ZP.unit(s))})})]})}function ArtifactSetsEditor(e){var t=e.artSet,n=e.setArtSet,r=(0,_.Z)((function(){return Zt.y.getAll}),[]),a=(0,Z.useCallback)((function(e){e&&r&&n((0,xe.Z)((0,xe.Z)({},t),{},(0,ir.Z)({},e,parseInt(Object.keys(r(e).setEffects)[0]))))}),[t,n,r]),s=(0,Z.useCallback)((function(e){return function(r){return n((0,xe.Z)((0,xe.Z)({},t),{},(0,ir.Z)({},e,r)))}}),[t,n]),l=(0,Z.useCallback)((function(e){return function(){t[e];var r=(0,ge.Z)(t,[e].map(Hr.Z));n((0,xe.Z)({},r))}}),[t,n]),o=5-Object.values(t).reduce((function(e,t){return e+t}),0);return(0,z.jsxs)(ce.Z,{spacing:1,sx:{flexGrow:1},children:[Object.entries(t).map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return(0,z.jsx)(ArtifactSetEditor,{setKey:n,value:r,setValue:s(n),deleteValue:l(n),remaining:o},n)})),(0,z.jsx)(C.Z,{sx:{flexGrow:1},children:(0,z.jsx)(Jr.Y4,{showDefault:!0,disableClearable:!0,size:"small",artSetKey:"",setArtSetKey:a,sx:function sx(e){return{flexGrow:1,".MuiFilledInput-root":{borderBottomRightRadius:e.shape.borderRadius,borderBottomLeftRadius:e.shape.borderRadius}}},defaultText:"New Artifact Set",disable:function disable(e){return Object.keys(t).includes(e)||!(null!==r&&void 0!==r&&r(e))||Object.keys(r(e).setEffects).every((function(e){return parseInt(e)>o}))}})})]})}function ArtifactSetEditor(e){var t=e.setKey,n=e.value,r=e.setValue,i=e.deleteValue,a=e.remaining,s=(0,_.Z)((function(){return Zt.y.get(t)}),[]),l=(0,Z.useMemo)((function(){return n<4||!s?[]:Object.keys(s.setEffects).filter((function(e){var t;return null===(t=s.setEffects[e])||void 0===t?void 0:t.document.some((function(e){return"states"in e}))}))}),[s,n]);return s?(0,z.jsxs)(C.Z,{children:[(0,z.jsxs)(x.Z,{display:"flex",children:[(0,z.jsx)(cn.Z,{artifactSheet:s,numInSet:n,children:(0,z.jsxs)(x.Z,{flexGrow:1,p:1,display:"flex",gap:1,alignItems:"center",children:[(0,z.jsx)(re.Z,{size:2,sx:{m:-1},src:s.defIconSrc}),(0,z.jsx)(x.Z,{children:s.setName}),(0,z.jsx)(Yr.Z,{})]})}),(0,z.jsxs)(we.Z,{children:[(0,z.jsx)(et.Z,{size:"small",title:(0,z.jsxs)(x.Z,{whiteSpace:"nowrap",children:[n,"-set"]}),children:Object.keys(s.setEffects).map((function(e){return parseInt(e)})).map((function(e){return(0,z.jsxs)(Ve.Z,{disabled:n===e||e>a+n,onClick:function onClick(){return r(e)},children:[e,"-set"]},e)}))}),(0,z.jsx)(j.Z,{color:"error",size:"small",onClick:i,children:(0,z.jsx)(ze.Z,{})})]})]}),!!l.length&&(0,z.jsx)(ce.Z,{spacing:1,sx:{p:1},children:l.map((function(e){return(0,z.jsx)(SetEffectDisplay,{setKey:t,setNumKey:parseInt(e),hideHeader:!0,conditionalsOnly:!0},e)}))})]}):null}function ArtifactSubCard(e){var t=e.substats,n=e.setSubstats,a=e.substatsType,s=e.setSubstatsType,l=e.mainStatKeys,o=(0,Z.useCallback)((function(e){return function(r){return n((0,xe.Z)((0,xe.Z)({},t),{},(0,ir.Z)({},e,r)))}}),[t,n]),c=(0,v.$)("page_character").t,u=100*Object.entries(t).reduce((function(e,t){var n=(0,i.Z)(t,2),r=n[0];return e+n[1]/Xt.ZP.substatValue(r)}),0),d=Object.entries(t).reduce((function(e,t){var n=(0,i.Z)(t,2),r=n[0];return e+n[1]/Xt.ZP.substatValue(r,void 0,a)}),0);return(0,z.jsxs)(C.Z,{sx:{p:1,height:"100%"},children:[(0,z.jsxs)(x.Z,{sx:{mb:1,display:"flex",gap:1},children:[(0,z.jsx)(et.Z,{fullWidth:!0,title:c("tabTheorycraft.substatType.".concat(a)),children:W.Q7.map((function(e){return(0,z.jsx)(Ve.Z,{disabled:a===e,onClick:function onClick(){return s(e)},children:c("tabTheorycraft.substatType.".concat(e))},e)}))}),(0,z.jsx)(Xe.Z,{title:(0,z.jsx)(X.Z,{children:c(Vr||(Vr=(0,r.Z)(["tabTheorycraft.maxTotalRolls"])))}),placement:"top",children:(0,z.jsxs)(b.Z,{sx:{textAlign:"center",py:.5,px:1,minWidth:"15em",whiteSpace:"nowrap",display:"flex",gap:2,justifyContent:"flex-end",alignItems:"center"},children:[(0,z.jsxs)(ne.Z,{color:d>45?"warning":void 0,children:["Rolls: ",(0,z.jsx)("strong",{children:d.toFixed(0)})]}),(0,z.jsxs)(ne.Z,{color:d>45?"warning":void 0,children:["RV: ",(0,z.jsxs)("strong",{children:[u.toFixed(1),"%"]})]})]})})]}),(0,z.jsx)(ce.Z,{spacing:1,children:Object.entries(t).map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return(0,z.jsx)(ArtifactSubstatEditor,{statKey:n,value:r,setValue:o(n),substatsType:a,mainStatKeys:l},n)}))})]})}function ArtifactSubstatEditor(e){var t=e.statKey,n=e.value,r=e.setValue,a=e.substatsType,s=e.mainStatKeys,l=(0,v.$)("page_character").t,o=Xt.ZP.substatValue(t,5,a),c=(0,Z.useState)((function(){return n/o})),u=(0,i.Z)(c,2),d=u[0],f=u[1];(0,Z.useEffect)((function(){return f(n/o)}),[n,o]);var h=ve.ZP.unit(t),p=d*o,m=d*o/Xt.ZP.substatValue(t)*100,j=s.reduce((function(e,n){return e+(n===t?1:0)}),0),g=6*(5-j),y=d-1e-4>g,C=(0,Z.useCallback)((function(e){return r(e*o)}),[r,o]);return(0,z.jsxs)(ce.Z,{spacing:.5,children:[(0,z.jsxs)(x.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.jsxs)(b.Z,{sx:{p:.5,minWidth:"11em",flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center"},children:[ke.Z[t],ve.ZP.getStr(t),ve.ZP.unit(t)]}),(0,z.jsx)(Xe.Z,{title:(0,z.jsx)(X.Z,{children:l(j?"tabTheorycraft.maxRollsMain":"tabTheorycraft.maxRolls",{value:g})}),placement:"top",children:(0,z.jsx)(b.Z,{sx:{textAlign:"center",p:.5,minWidth:"8em"},children:(0,z.jsxs)(ne.Z,{color:y?"warning":void 0,children:["RV: ",(0,z.jsxs)("strong",{children:[m.toFixed(1),"%"]})]})})})]}),(0,z.jsxs)(x.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.jsx)(Ae.ZP,{color:p?"success":"primary",float:"%"===ve.ZP.unit(t),endAdornment:ve.ZP.unit(t)||(0,z.jsx)(x.Z,{width:"1em",component:"span"}),value:parseFloat(p.toFixed(2)),onChange:function onChange(e){return void 0!==e&&r(e)},sx:{borderRadius:1,px:1,height:"100%",width:"6em"},inputProps:{sx:{textAlign:"right"},min:0}}),(0,z.jsx)(b.Z,{sx:{px:2,flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center"},children:(0,z.jsx)(dn.ZP,{size:"small",value:d,max:g,min:0,step:1,marks:!0,onChange:function onChange(e,t){return f(t)},onChangeCommitted:function onChangeCommitted(e,t){return C(t)}})}),(0,z.jsx)(Ae.ZP,{color:n?y?"warning":"success":"primary",float:!0,startAdornment:(0,z.jsxs)(x.Z,{sx:{whiteSpace:"nowrap",width:"7em",display:"flex",justifyContent:"space-between"},children:[(0,z.jsxs)("span",{children:[(0,ve.qs)(o,h),h]}),(0,z.jsx)("span",{children:"x"})]}),value:parseFloat(d.toFixed(2)),onChange:function onChange(e){return void 0!==e&&r(e*o)},sx:{borderRadius:1,px:1,my:0,height:"100%",width:"7em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1}})]})]})}var ri=n(53343);function TravelerElementSelect(){var e=(0,Z.useContext)(D.K).character.key,t=(0,q.Z)();if(!e.startsWith("Traveler"))return null;var n=W.N.find((function(t){return e.toLowerCase().includes(t)}));return(0,z.jsx)(et.Z,{color:n,title:(0,z.jsx)("strong",{children:(0,ri.el)("element.".concat(n))}),children:W.DZ.map((function(r){return(0,z.jsx)(Ve.Z,{selected:n===r,disabled:n===r,onClick:function onClick(){return t((0,W.rq)(e,r))},children:(0,z.jsx)("strong",{children:(0,z.jsx)(ne.Z,{color:r,children:(0,ri.el)("element.".concat(r))})})},r)}))})}var ii,ai=n(24796),si=n(49547);function TravelerGenderSelect(){var e=(0,v.$)("ui").t,t=(0,Z.useContext)(M.t).database,n=(0,Z.useContext)(D.K).character.key,r=(0,O.Z)().gender,i=(0,Z.useCallback)((function(){return t.dbMeta.set({gender:"F"===r?"M":"F"})}),[r,t]);return n.startsWith("Traveler")?(0,z.jsxs)(j.Z,{onClick:i,startIcon:"F"===r?(0,z.jsx)(ai.Z,{}):(0,z.jsx)(si.Z,{}),children:[(0,z.jsx)("strong",{children:e("gender.".concat(r))}),"  "]}):null}function CharacterDisplay(){var e=(0,y.s0)(),t=(0,Z.useContext)(M.t).database,n=(0,Z.useCallback)((function(){return e("/characters")}),[e]),r=(0,y.UO)().characterKey;return!t.chars.keys.includes(r)?(0,z.jsx)(y.Fg,{to:"/characters"}):(0,z.jsx)(x.Z,{my:1,display:"flex",flexDirection:"column",gap:1,children:(0,z.jsx)(Z.Suspense,{fallback:(0,z.jsx)(f.Z,{variant:"rectangular",width:"100%",height:1e3}),children:r&&(0,z.jsx)(CharacterDisplayCard,{characterKey:r,onClose:n})})})}function CharacterDisplayCard(e){var t,n,r,a=e.characterKey,s=e.onClose,l=(0,B.Z)(a),o=(0,O.Z)().gender,c=(0,_.Z)((function(){return I.Z.get(a,o)}),[a,o]),u=(0,N.Z)(a),d=(null!==(t=null===u||void 0===u?void 0:u[a])&&void 0!==t?t:{}).target,p=(null!==(n=(0,y.bS)({path:"/characters/:charKey/:tab",end:!1}))&&void 0!==n?n:{params:{tab:"overview"}}).params.tab,m=void 0===p?"overview":p,j=(0,v.$)(["charNames_gen","page_character"]).t;(0,L.Z)((0,Z.useMemo)((function(){return"".concat(j("charNames_gen:".concat((0,W.LP)(a,o)))," - ").concat(j("page_character:tabs.".concat(m)))}),[j,a,o,m]));var g=(0,T.Z)(null!==(r=null===l||void 0===l?void 0:l.key)&&void 0!==r?r:""),A=(0,Z.useMemo)((function(){if(u&&d)return{data:d,teamData:u,oldData:void 0}}),[d,u]),M=(0,Z.useMemo)((function(){if(l&&c)return{character:l,characterSheet:c,characterDispatch:g}}),[l,c,g]),R=(0,Z.useState)(void 0),G=(0,i.Z)(R,2),q=G[0],V=G[1],H=(0,Z.useState)(),$=(0,i.Z)(H,2),U=$[0],Y=$[1],J=(0,Z.useMemo)((function(){return{chartData:q,setChartData:V,graphBuilds:U,setGraphBuilds:Y}}),[q,U]);return(0,Z.useEffect)((function(){V(void 0),Y(void 0)}),[a]),(0,z.jsx)(b.Z,{children:A&&M&&J?(0,z.jsx)(D.K.Provider,{value:M,children:(0,z.jsx)(K.R.Provider,{value:A,children:(0,z.jsx)(E.Provider,{value:J,children:(0,z.jsx)(P.B,{children:(0,z.jsxs)(h.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.jsxs)(x.Z,{display:"flex",children:[(0,z.jsxs)(x.Z,{display:"flex",gap:1,flexWrap:"wrap",flexGrow:1,children:[(0,z.jsx)(CharSelectDropdown,{}),(0,z.jsx)(TravelerElementSelect,{}),(0,z.jsx)(TravelerGenderSelect,{}),(0,z.jsx)(DetailStatButton,{}),(0,z.jsx)(F.J,{}),(0,z.jsx)(FormulasButton,{})]}),!!s&&(0,z.jsx)(S.Z,{onClick:s})]}),(0,z.jsxs)(x.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[l&&(0,z.jsx)(w.Z,{level:l.level,ascension:l.ascension,setBoth:g}),(0,z.jsx)(k.Hn,{size:"small"}),(0,z.jsx)(k.pg,{}),(0,z.jsx)(k.oX,{size:"small"})]}),(0,z.jsx)(C.Z,{children:(0,z.jsx)(TabNav,{tab:m})}),(0,z.jsx)(CharacterPanel,{}),(0,z.jsx)(C.Z,{children:(0,z.jsx)(TabNav,{tab:m})})]})})})})}):(0,z.jsx)(f.Z,{variant:"rectangular",width:"100%",height:1e3})})}function CharacterPanel(){return(0,z.jsx)(Z.Suspense,{fallback:(0,z.jsx)(f.Z,{variant:"rectangular",width:"100%",height:500}),children:(0,z.jsxs)(y.Z5,{children:[(0,z.jsx)(y.AW,{index:!0,element:(0,z.jsx)(TabOverview,{})}),(0,z.jsx)(y.AW,{path:"/talent",element:(0,z.jsx)(CharacterTalentPane,{})}),(0,z.jsx)(y.AW,{path:"/teambuffs",element:(0,z.jsx)(TabTeambuffs,{})}),(0,z.jsx)(y.AW,{path:"/optimize",element:(0,z.jsx)(TabBuild,{})}),(0,z.jsx)(y.AW,{path:"/theorycraft",element:(0,z.jsx)(TabTheorycraft,{})})]})})}function TabNav(e){var t=e.tab,n=(0,v.$)("page_character").t;return(0,z.jsxs)(p.Z,{value:t,variant:"scrollable",allowScrollButtonsMobile:!0,sx:{"& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"}},children:[(0,z.jsx)(m.Z,{sx:{minWidth:"20%"},value:"overview",label:n("tabs.overview"),icon:(0,z.jsx)(a.Z,{}),component:g.rU,to:""}),(0,z.jsx)(m.Z,{sx:{minWidth:"20%"},value:"talent",label:n("tabs.talent"),icon:(0,z.jsx)(s.Z,{}),component:g.rU,to:"talent"}),(0,z.jsx)(m.Z,{sx:{minWidth:"20%"},value:"teambuffs",label:n("tabs.teambuffs"),icon:(0,z.jsx)(l.Z,{}),component:g.rU,to:"teambuffs"}),(0,z.jsx)(m.Z,{sx:{minWidth:"20%"},value:"optimize",label:n("tabs.optimize"),icon:(0,z.jsx)(o.Z,{}),component:g.rU,to:"optimize"}),(0,z.jsx)(m.Z,{sx:{minWidth:"20%"},value:"theorycraft",label:n("tabs.theorycraft"),icon:(0,z.jsx)(c.Z,{}),component:g.rU,to:"theorycraft"})]})}function DetailStatButton(){var e=(0,v.$)("page_character").t,t=(0,R.Z)(),n=(0,i.Z)(t,3),a=n[0],s=n[1],l=n[2],o=(0,Z.useContext)(D.K).character.bonusStats,c=Object.keys(o).length;return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(j.Z,{color:"info",startIcon:(0,z.jsx)(u.Z,{}),onClick:s,children:[e(ii||(ii=(0,r.Z)(["addStats.title"]))),!!c&&(0,z.jsx)(A.Z,{sx:{ml:1},color:"success",children:c})]}),(0,z.jsx)(StatModal,{open:a,onClose:l})]})}function FormulasButton(){var e=(0,Z.useContext)(P.M).onModalOpen;return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(j.Z,{color:"info",startIcon:(0,z.jsx)(d.Z,{}),onClick:e,children:["Formulas ","&"," Calcs"]}),(0,z.jsx)(FormulaModal,{})]})}},90543:function(e,t,n){n.d(t,{Z:function(){return WeaponCard}});var r,i=n(30168),a=n(53174),s=n(54483),l=n(40117),o=n(62002),c=n(66647),u=n(64554),d=n(47047),x=n(13400),f=n(20890),h=n(39504),p=n(2199),m=n(40165),j=n(24518),Z=n(72791),v=n(22020),g=n(10658),y=n(71310),b=n(30066),C=n(40020),S=n(20005),k=n(55942),w=n(10157),A=n(2139),D=n(66218),K=n(66101),P=n(27235),E=n(73036),I=n(18327),M=n(42320),R=n(74480),B=n(80184);function WeaponCard(e){var t,n=e.weaponId,T=e.onClick,O=e.onEdit,_=e.onDelete,N=e.canEquip,L=void 0!==N&&N,W=e.extraButtons,F=(0,v.$)(["page_weapon","ui"]).t,G=(0,Z.useContext)(K.t).database,q=(0,R.Z)(n),z=(0,M.Z)((function(){return null!==q&&void 0!==q&&q.key?D.Z.get(q.key):void 0}),[null===q||void 0===q?void 0:q.key]),V=(0,Z.useCallback)((function(e){return e.weaponTypeKey===(null===z||void 0===z?void 0:z.weaponType)}),[z]),H=(0,Z.useCallback)((function(e){return(0,B.jsx)(c.Z,{onClick:function onClick(){return null===T||void 0===T?void 0:T(n)},children:e})}),[T,n]),$=(0,Z.useCallback)((function(e){return(0,B.jsx)(u.Z,{children:e})}),[]),U=(0,Z.useCallback)((function(e){return n&&G.weapons.set(n,{location:e})}),[G,n]),Y=(0,Z.useMemo)((function(){return z&&q&&(0,E.mP)([z.data,(0,E.v0)(q)])}),[z,q]);if(!q||!z||!Y)return null;var J=q.level,X=q.ascension,Q=q.refinement,ee=q.id,te=q.location,ne=void 0===te?"":te,re=q.lock,ie=Y.get(P.ri.weapon.type).value,ae=[P.ri.weapon.main,P.ri.weapon.sub,P.ri.weapon.sub2].map((function(e){return Y.get(e)})),se=z.getImg(X);return(0,B.jsx)(Z.Suspense,{fallback:(0,B.jsx)(d.Z,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:300}}),children:(0,B.jsxs)(y.Z,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,B.jsxs)(S.Z,{condition:!!T,wrapper:H,falseWrapper:$,children:[(0,B.jsxs)(u.Z,{className:"grad-".concat(z.rarity,"star"),sx:{position:"relative",pt:2,px:2},children:[!T&&(0,B.jsx)(x.Z,{color:"primary",onClick:function onClick(){return G.weapons.set(ee,{lock:!re})},sx:{position:"absolute",right:0,bottom:0,zIndex:2},children:re?(0,B.jsx)(l.Z,{}):(0,B.jsx)(o.Z,{})}),(0,B.jsxs)(u.Z,{sx:{position:"relative",zIndex:1},children:[(0,B.jsxs)(u.Z,{component:"div",sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,B.jsx)(k.Z,{sx:{fontSize:"1.5em"},src:null===(t=g.Z.weaponTypes)||void 0===t?void 0:t[ie]}),(0,B.jsx)(f.Z,{noWrap:!0,sx:{textAlign:"center",backgroundColor:"rgba(100,100,100,0.35)",borderRadius:"1em",px:1},children:(0,B.jsx)("strong",{children:z.name})})]}),(0,B.jsxs)(f.Z,{component:"span",variant:"h5",children:["Lv. ",J]}),(0,B.jsxs)(f.Z,{component:"span",variant:"h5",color:"text.secondary",children:["/",A.SJ[X]]}),(0,B.jsxs)(f.Z,{variant:"h6",children:["Refinement ",(0,B.jsx)("strong",{children:Q})]}),(0,B.jsx)(f.Z,{children:(0,B.jsx)(w.q,{stars:z.rarity,colored:!0})})]}),(0,B.jsx)(u.Z,{sx:{height:"100%",position:"absolute",right:0,top:0},children:(0,B.jsx)(u.Z,{component:"img",src:null!==se&&void 0!==se?se:"",width:"auto",height:"100%",sx:{float:"right"}})})]}),(0,B.jsx)(h.Z,{children:ae.map((function(e){return e.info.name?(0,B.jsxs)(u.Z,{sx:{display:"flex"},children:[(0,B.jsxs)(f.Z,{flexGrow:1,children:[e.info.icon," ",e.info.name]}),(0,B.jsx)(f.Z,{children:(0,I.p)(e)})]},JSON.stringify(e.info)):null}))})]}),(0,B.jsxs)(u.Z,{sx:{p:1,display:"flex",gap:1,justifyContent:"space-between",alignItems:"center"},children:[(0,B.jsx)(u.Z,{sx:{flexGrow:1},children:L?(0,B.jsx)(b.W,{location:ne,setLocation:U,filter:V,autoCompleteProps:{getOptionDisabled:function getOptionDisabled(e){return!e.key},disableClearable:!0}}):(0,B.jsx)(C.Z,{location:ne})}),(0,B.jsxs)(p.Z,{sx:{height:"100%"},children:[!!O&&(0,B.jsx)(m.Z,{title:(0,B.jsx)(f.Z,{children:F(r||(r=(0,i.Z)(["page_weapon:edit"])))}),placement:"top",arrow:!0,children:(0,B.jsx)(j.Z,{color:"info",onClick:function onClick(){return O(ee)},children:(0,B.jsx)(s.G,{icon:a.Xcf,className:"fa-fw"})})}),!!_&&(0,B.jsx)(j.Z,{color:"error",onClick:function onClick(){return _(ee)},disabled:!!ne||re,children:(0,B.jsx)(s.G,{icon:a.I7k,className:"fa-fw"})}),W]})]})]})})}}}]);
//# sourceMappingURL=325.1189f281.chunk.js.map