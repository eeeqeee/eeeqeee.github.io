!function(){"use strict";var e={18349:function(e,n,t){var r=t(37762),a=t(93433),i=t(1413),o=t(74165),u=t(29439);function objPathValue(e,n){if(e&&n)return!Array.isArray(n)&&console.error(n),n.reduce((function(e,n){return null===e||void 0===e?void 0:e[n]}),e)}function Util_objectKeyMap(e,n){return Object.fromEntries(e.map((function(e,t){return[e,n(e,t)]})))}function objectKeyValueMap(e,n){return Object.fromEntries(e.map((function(e,t){return n(e,t)})))}function objectMap(e,n){return Object.fromEntries(Object.entries(e).map((function(e,t){var r=(0,u.Z)(e,2),a=r[0],i=r[1];return[a,n(i,a,t)]})))}var s=(0,o.Z)().mark((function rangeGen(e,n){var t;return(0,o.Z)().wrap((function rangeGen$(r){for(;;)switch(r.prev=r.next){case 0:t=e;case 1:if(!(t<=n)){r.next=7;break}return r.next=4,t;case 4:t++,r.next=1;break;case 7:case"end":return r.stop()}}),rangeGen)}));function range(e,n){return(0,a.Z)(s(e,n))}function assertUnreachable(e){throw new Error("Should not reach this with value ".concat(e))}var c=t(60136),l=t(29388),f=t(7112),p=t(4942),d=t(15671),h=t(43144);constant(NaN,{name:"TODO"}),percent(1),percent(0),constant("none");function constant(e,n){return"number"===typeof e?{operation:"const",operands:[],type:"number",value:e,info:n}:{operation:"const",operands:[],type:"string",value:e,info:n}}function percent(e,n){return e>=Number.MAX_VALUE/100&&(e=1/0),e<=-Number.MAX_VALUE/100&&(e=-1/0),constant(e,(0,i.Z)({unit:"%"},n))}function min(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return{operation:"min",operands:intoOps(n)}}function max(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return{operation:"max",operands:intoOps(n)}}function customRead(e,n){return{operation:"read",operands:[],path:e,info:n,type:"number"}}function intoOps(e){return e.map((function(e){return"object"===typeof e?e:constant(e)}))}function intoV(e){return"object"!==typeof e?constant(e):e}function forEachNodes(e,n,t){var r=new Set,a=new Set;e.forEach((function traverse(e){a.has(e)||(r.has(e)?console.error("Found cyclical dependency during formula traversal"):(r.add(e),n(e),e.operands.forEach(traverse),t(e),r.delete(e),a.add(e)))}))}function internal_mapFormulas(e,n,t){var r=new Set,a=new Map,o=new Map;function check(e){var u=a.get(e);if(u)return u;u=n(e);var s=o.get(u);return s||(r.has(u)?(console.error("Found cyclical dependency during formula mapping"),constant(NaN)):(r.add(u),s=t(function traverse(e){var n=e.operands.map(check);return arrayEqual(n,e.operands)?e:(0,i.Z)((0,i.Z)({},e),{},{operands:n})}(u),e),r.delete(u),a.set(e,s),o.set(u,s),s))}var u=e.map(check);return arrayEqual(u,e)?e:u}function customMapFormula(e,n,t){var r=new Map;function internalMap(e,n){var a=r.get(n);a||r.set(n,a=[new Set,new Map]);var i=a,o=(0,u.Z)(i,2),s=o[0],c=o[1],l=c.get(e);if(l)return l;if(s.has(e))throw new Error("Found cyclical dependency during formula mapping");s.add(e);var f=t(e,n,internalMap);return c.set(e,f),s.delete(e),f}return e.map((function(e){return internalMap(e,n)}))}function arrayEqual(e,n){return void 0===e?void 0===n:void 0!==n&&(e.length===n.length&&e.every((function(e,t){return e===n[t]})))}var v={min:function min(e){return Math.min.apply(Math,(0,a.Z)(e))},max:function max(e){return Math.max.apply(Math,(0,a.Z)(e))},add:function add(e){return e.reduce((function(e,n){return e+n}),0)},mul:function mul(e){return e.reduce((function(e,n){return e*n}),1)}},m=(0,i.Z)((0,i.Z)({},v),{},{res:function res(e){var n=(0,u.Z)(e,1)[0];return n<0?1-n/2:n>=.75?1/(4*n+1):1-n},sum_frac:function sum_frac(e){return e[0]/e.reduce((function(e,n){return e+n}))},threshold:function threshold(e){var n=(0,u.Z)(e,4),t=n[0],r=n[1],a=n[2],i=n[3];return t>=r?a:i}}),b=new Set(Object.keys(v));function flatten(e){return internal_mapFormulas(e,(function(e){return e}),(function(e){var n=e;if(b.has(e.operation)){var t=e,r=t.operation,a=!1,o=t.operands.flatMap((function(e){return e.operation===r?(a=!0,e.operands):[e]}));n=a?(0,i.Z)((0,i.Z)({},t),{},{operands:o}):t}return n}))}function deduplicate(e){function elementCounts(e){var n,t=new Map,a=(0,r.Z)(e);try{for(a.s();!(n=a.n()).done;){var i,o=n.value;t.set(o,(null!==(i=t.get(o))&&void 0!==i?i:0)+1)}}catch(u){a.e(u)}finally{a.f()}return t}for(var n={common:{counts:new Map,formulas:new Set,operation:"add"}},t=function _loop(){for(var t,o=void 0,s={operation:n.common.operation,operands:(t=n.common.counts,(0,a.Z)(t).flatMap((function(e){var n=(0,u.Z)(e,2),t=n[0],r=n[1];return Array(r).fill(t)})))},c=new Map,l=0,f=Object.keys(v);l<f.length;l++){var p=f[l];c.set(p,[])}if(e=internal_mapFormulas(e,(function(e){if(n.common.formulas.has(e)){var t=e,r=new Map(n.common.counts),a=t.operands.filter((function(e){var n=r.get(e);return!n||(r.set(e,n-1),!1)}));return a.length?(a.push(s),(0,i.Z)((0,i.Z)({},t),{},{operands:a})):s}return e}),(function(e){if(!b.has(e.operation))return e;var n=e;if(o){if(o.operation===n.operation){var t,a=elementCounts(n.operands),i=new Map,s=o.counts,l=0,f=(0,r.Z)(a.entries());try{for(f.s();!(t=f.n()).done;){var p,d=(0,u.Z)(t.value,2),h=d[0],v=d[1],m=Math.min(v,null!==(p=s.get(h))&&void 0!==p?p:0);m?(i.set(h,m),l+=m):i.delete(h)}}catch(R){f.e(R)}finally{f.f()}l>1&&(o.counts=i,o.formulas.add(n))}}else{var g,w=c.get(n.operation),k=elementCounts(n.operands),_=(0,r.Z)(w);try{for(_.s();!(g=_.n()).done;){var y,x=(0,u.Z)(g.value,2),Z=x[0],S=x[1],M=0,O=new Map,A=(0,r.Z)(S.entries());try{for(A.s();!(y=A.n()).done;){var j,F=(0,u.Z)(y.value,2),B=F[0],E=F[1],N=Math.min(E,null!==(j=k.get(B))&&void 0!==j?j:0);N&&(O.set(B,N),M+=N)}}catch(R){A.e(R)}finally{A.f()}if(M>1){o={counts:O,formulas:new Set([n,Z]),operation:n.operation},c.clear();break}}}catch(R){_.e(R)}finally{_.f()}o||w.push([n,k])}return n})),!o)return"break";n.common=o};;){if("break"===t())break}return e}function constantFold(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!1},o={data:[],processed:new Map},s=new Map([[o,new Map]]),c={data:[n],processed:new Map};return s.set(c,new Map),s.get(o).set(n,c),customMapFormula(e,c,(function(e,n,c){var l,f,p=e.operation,d=function fold(e,n){return c(e,n)},h=function foldStr(e,n){return c(e,n)};switch(p){case"const":f=e;break;case"add":case"mul":case"max":case"min":var v=m[p],b=[],g=e.operands.filter((function(e){var t=d(e,n);return"const"!==t.operation||(b.push(t.value),!1)})).map((function(e){return d(e,n)})),w=v(b);if(isFinite(w)){if("mul"===p&&0===w){f=constant(w);break}}else if("mul"!==p&&("max"!==p||w>0)&&("min"!==p||w<0)){f=constant(w);break}w!==v([])&&g.push(constant(w)),f=g.length<=1?null!==(l=g[0])&&void 0!==l?l:constant(v([])):{operation:p,operands:g};break;case"res":case"sum_frac":var k=e.operands.map((function(e){return d(e,n)})),_=m[p];f=k.every((function(e){return"const"===e.operation}))?constant(_(k.map((function(e){return e.value})))):(0,i.Z)((0,i.Z)({},e),{},{operands:k});break;case"lookup":var y=h(e.operands[0],n);if("const"===y.operation){var x,Z=null!==(x=e.table[y.value])&&void 0!==x?x:e.operands[1];if(Z){f=c(Z,n);break}}throw new Error("Unsupported ".concat(p," node while folding"));case"prio":var S=e.operands.find((function(e){var t=h(e,n);if("const"!==t.operation)throw new Error("Unsupported ".concat(p," node while folding"));return void 0!==t.value}));f=S?h(S,n):constant(void 0);break;case"small":var M,O,A=void 0,j=(0,r.Z)(e.operands);try{for(j.s();!(O=j.n()).done;){var F,B=O.value,E=h(B,n);if("const"!==E.operation)throw new Error("Unsupported ".concat(p," node while folding"));(void 0===(null===(F=A)||void 0===F?void 0:F.value)||void 0!==E.value&&E.value<A.value)&&(A=E)}}catch(Y){j.e(Y)}finally{j.f()}f=null!==(M=A)&&void 0!==M?M:constant(void 0);break;case"match":var N=e.operands.map((function(e){return c(e,n)})),R=(0,u.Z)(N,4),q=R[0],T=R[1],P=R[2],C=R[3];if("const"!==q.operation||"const"!==T.operation)throw new Error("Unsupported ".concat(p," node while folding"));f=q.value===T.value?P:C;break;case"threshold":var D=e.operands.map((function(e){return c(e,n)})),U=(0,u.Z)(D,4),K=U[0],W=U[1],V=U[2],G=U[3];f="const"===V.operation&&"const"===G.operation&&V.value===G.value?V:"const"===K.operation&&"const"===W.operation?K.value>=W.value?V:G:(0,i.Z)((0,i.Z)({},e),{},{operands:[K,W,V,G]});break;case"subscript":var z=d(e.operands[0],n);if("const"!==z.operation)throw new Error("Found non-constant subscript node while folding");f=constant(e.list[z.value]);break;case"read":var I=n.data.map((function(n){return objPathValue(n,e.path)})).filter((function(e){return e}));if(0===I.length)if(t(e)){var H=e.accu;f=void 0===H||"small"===H?"string"===e.type?constant(void 0):constant(NaN):constant(m[H]([]))}else f=e;else f=void 0===e.accu||1===I.length?c(I[I.length-1],n):c({operation:e.accu,operands:I},n);break;case"data":e.reset&&(n=o);var L=s.get(n),$=L.get(e.data);$||($={data:[].concat((0,a.Z)(n.data),[e.data]),processed:new Map},s.set($,new Map),L.set(e.data,$)),f=c(e.operands[0],$);break;default:assertUnreachable(p)}return f.info&&delete(f=(0,i.Z)({},f)).info,f}))}var g=["flower","plume","sands","goblet","circlet"],w=(["physical"].concat(["anemo","geo","electro","hydro","pyro","cryo","dendro"]),["Albedo","Aloy","Amber","AratakiItto","Barbara","Beidou","Bennett","Candace","Chongyun","Collei","Cyno","Diluc","Diona","Dori","Eula","Fischl","Ganyu","Gorou","HuTao","Jean","KaedeharaKazuha","Kaeya","KamisatoAyaka","KamisatoAyato","Keqing","Klee","KujouSara","KukiShinobu","Layla","Lisa","Mona","Nahida","Nilou","Ningguang","Noelle","Qiqi","RaidenShogun","Razor","Rosaria","SangonomiyaKokomi","Sayu","Shenhe","ShikanoinHeizou","Sucrose","Tartaglia","Thoma","Tighnari","Venti","Xiangling","Xiao","Xingqiu","Xinyan","YaeMiko","Yanfei","Yelan","Yoimiya","YunJin","Zhongli"]),k=([].concat(w,["Traveler"]),["TravelerAnemo","TravelerGeo","TravelerElectro","TravelerDendro"]);[].concat(w,k),[].concat(w,["TravelerAnemoF","TravelerGeoF","TravelerElectroF","TravelerDendroF"],["TravelerAnemoM","TravelerGeoM","TravelerElectroM","TravelerDendroM"]),[].concat(["AmenomaKageuchi","AquilaFavonia","BlackcliffLongsword","CinnabarSpindle","CoolSteel","KagotsurubeIsshin","DarkIronSword","DullBlade","FavoniusSword","FesteringDesire","FilletBlade","FreedomSworn","HaranGeppakuFutsu","HarbingerOfDawn","IronSting","KeyOfKhajNisut","LionsRoar","MistsplitterReforged","PrimordialJadeCutter","PrototypeRancour","RoyalLongsword","SacrificialSword","SapwoodBlade","SilverSword","SkyriderSword","SkywardBlade","SummitShaper","SwordOfDescension","TheAlleyFlash","TheBlackSword","TheFlute","TravelersHandySword","XiphosMoonlight"],["Akuoumaru","BlackcliffSlasher","BloodtaintedGreatsword","DebateClub","FavoniusGreatsword","FerrousShadow","ForestRegalia","KatsuragikiriNagamasa","LithicBlade","LuxuriousSeaLord","MakhairaAquamarine","OldMercsPal","PrototypeArchaic","Rainslasher","RedhornStonethresher","RoyalGreatsword","SacrificialGreatsword","SerpentSpine","SkyriderGreatsword","SkywardPride","SnowTombedStarsilver","SongOfBrokenPines","TheBell","TheUnforged","WasterGreatsword","Whiteblind","WhiteIronGreatsword","WolfsGravestone"],["BeginnersProtector","BlackcliffPole","BlackTassel","CalamityQueller","CrescentPike","Deathmatch","DragonsBane","DragonspineSpear","EngulfingLightning","FavoniusLance","Halberd","IronPoint","KitainCrossSpear","LithicSpear","MissiveWindspear","Moonpiercer","PrimordialJadeWingedSpear","PrototypeStarglitter","RoyalSpear","SkywardSpine","StaffOfHoma","StaffOfTheScarletSands","TheCatch","VortexVanquisher","WavebreakersFin","WhiteTassel"],["AlleyHunter","AmosBow","AquaSimulacra","BlackcliffWarbow","CompoundBow","ElegyForTheEnd","EndOfTheLine","FadingTwilight","FavoniusWarbow","Hamayumi","HuntersBow","HuntersPath","KingsSquire","Messenger","MitternachtsWaltz","MouunsMoon","PolarStar","Predator","PrototypeCrescent","RavenBow","RecurveBow","RoyalBow","Rust","SacrificialBow","SeasonedHuntersBow","SharpshootersOath","SkywardHarp","Slingshot","TheStringless","TheViridescentHunt","ThunderingPulse","WindblumeOde"],["ApprenticesNotes","AThousandFloatingDreams","BlackcliffAgate","DodocoTales","EmeraldOrb","EverlastingMoonglow","EyeOfPerception","FavoniusCodex","Frostbearer","FruitOfFulfillment","HakushinRing","KagurasVerity","LostPrayerToTheSacredWinds","MagicGuide","MappaMare","MemoryOfDust","OathswornEye","OtherworldlyStory","PocketGrimoire","PrototypeAmber","RoyalGrimoire","SacrificialFragments","SkywardAtlas","SolarPearl","TheWidsith","ThrillingTalesOfDragonSlayers","TwinNephrite","WanderingEvenstar","WineAndSong"]);var _=(0,o.Z)().mark(filterFeasiblePerm),y=(0,o.Z)().mark(artSetPerm);function pruneAll(e,n,t,r,a,o){for(var u=o,s={pruneNodeRange:!0},c={pruneNodeRange:!0},l={reaffine:!0},f={pruneOrder:!0,pruneArtRange:!0,pruneNodeRange:!0},p=0;Object.values(u).some((function(e){return e}))&&p++<20;){if(u.pruneOrder){delete u.pruneOrder;var d=pruneOrder(t,r,a);t!==d&&(t=d,u=(0,i.Z)((0,i.Z)({},u),s))}if(u.pruneArtRange){delete u.pruneArtRange;var h=pruneArtRange(e,t,n);t!==h&&(t=h,u=(0,i.Z)((0,i.Z)({},u),c))}if(u.pruneNodeRange){delete u.pruneNodeRange;var v=pruneNodeRange(e,t);e!==v&&(e=v,u=(0,i.Z)((0,i.Z)({},u),l))}if(u.reaffine){delete u.reaffine;var m=reaffine(e,t),b=m.nodes,g=m.arts;e===b&&t===g||(e=b,t=g,u=(0,i.Z)((0,i.Z)({},u),f))}}return{nodes:e,arts:t}}function reaffine(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=new Set,s=new Set;function visit(e,n){n?o.add(e):e.operands.forEach((function(e){return o.has(e)&&s.add(e)}))}var c=new Set;if(forEachNodes(e,(function(e){}),(function(e){var n=e.operation;switch(n){case"read":c.add(e.path[1]),visit(e,!0);break;case"add":visit(e,e.operands.every((function(e){return o.has(e)})));break;case"mul":var t=e.operands.filter((function(e){return"const"!==e.operation}));visit(e,0===t.length||1===t.length&&o.has(t[0]));break;case"const":visit(e,!0);break;case"res":case"threshold":case"sum_frac":case"max":case"min":visit(e,!1);break;default:assertUnreachable(n)}})),(0,a.Z)(s).every((function(e){var n=e.operation;return"read"===n||"const"===n}))&&Object.keys(n.base).length===c.size)return{nodes:e,arts:n};var l=-1;function nextDynKey(){for(;c.has("".concat(++l)););return"".concat(l)}e.forEach((function(e){return o.has(e)&&s.add(e)}));var f=(0,a.Z)(s).filter((function(e){return"const"!==e.operation})),p=new Map(f.map((function(e){return[e,t||"read"!==e.operation||"dyn"!==e.path[0]?(0,i.Z)((0,i.Z)({},customRead(["dyn","".concat(nextDynKey())])),{},{accu:"add"}):e]})));function reaffineArt(e){var n=constantFold((0,a.Z)(p.keys()),{dyn:objectMap(e,(function(e){return constant(e)}))},(function(e){return!0}));return Object.fromEntries((0,a.Z)(p.values()).map((function(e,t){return[e.path[1],n[t].value]})))}for(var d={nodes:e=internal_mapFormulas(e,(function(e){var n;return null!==(n=p.get(e))&&void 0!==n?n:e}),(function(e){return e})),arts:{base:reaffineArt(n.base),values:Util_objectKeyMap(g,(function(e){return n.values[e].map((function(e){return{id:e.id,set:e.set,values:reaffineArt(e.values)}}))}))}},h=Object.entries(reaffineArt({})),v=0,m=Object.values(d.arts.values);v<m.length;v++){var b,w=m[v],k=(0,r.Z)(w);try{for(k.s();!(b=k.n()).done;){var _,y=b.value.values,x=(0,r.Z)(h);try{for(x.s();!(_=x.n()).done;){var Z=(0,u.Z)(_.value,2),S=Z[0],M=Z[1];y[S]-=M}}catch(O){x.e(O)}finally{x.f()}}}catch(O){k.e(O)}finally{k.f()}}return d}function pruneOrder(e,n,t){var r,a=!1,i=!(null!==(r=t.rainbow)&&void 0!==r&&r.length),o=Object.keys(e.base),s=new Set(Object.entries(t).filter((function(e){var n=(0,u.Z)(e,2);n[0];return n[1].length})).map((function(e){return(0,u.Z)(e,1)[0]}))),c=new Set(Object.entries(t).filter((function(e){var n=(0,u.Z)(e,2),t=(n[0],n[1]);return t.includes(2)&&!t.includes(4)})).map((function(e){return(0,u.Z)(e,1)[0]}))),l=Util_objectKeyMap(g,(function(t){var r=e.values[t],u=r.filter((function(e){var t=0;return r.every((function(r){var a=o.every((function(n){var t,a;return(null!==(t=r.values[n])&&void 0!==t?t:0)>=(null!==(a=e.values[n])&&void 0!==a?a:0)})),u=o.some((function(n){var t,a;return(null!==(t=r.values[n])&&void 0!==t?t:0)>(null!==(a=e.values[n])&&void 0!==a?a:0)})),l=a&&(u||r.id>e.id),f=i&&!s.has(r.set)&&!c.has(e.set)||e.set===r.set;return l&&f&&t++,t<n}))}));return u.length!==r.length&&(a=!0),u}));return a?{base:e.base,values:l}:e}function pruneArtRange(e,n,t){for(var r=Object.fromEntries(Object.entries(n.base).map((function(e){var n=(0,u.Z)(e,2),t=n[0],r=n[1];return[t,{min:r,max:r}]}))),a={arts:n},i=function _loop(){var n=Util_objectKeyMap(g,(function(e){return computeArtRange(a.arts.values[e])})),i=Util_objectKeyMap(g,(function(e){return addArtRange(Object.entries(n).map((function(n){return n[0]===e?r:n[1]})).filter((function(e){return e})))})),o=!1,u=Util_objectKeyMap(g,(function(n){var r=a.arts.values[n].filter((function(r){var a=addArtRange([computeArtRange([r]),i[n]]),o=computeNodeRange(e,a);return e.every((function(e,n){var r;return o.get(e).max>=(null!==(r=t[n])&&void 0!==r?r:-1/0)}))}));return r.length!==a.arts.values[n].length&&(o=!0),r}));if(!o)return"break";a.arts={base:a.arts.base,values:u}};;){if("break"===i())break}return a.arts}function pruneNodeRange(e,n){var t=computeNodeRange(e,addArtRange([Object.fromEntries(Object.entries(n.base).map((function(e){var n=(0,u.Z)(e,2),t=n[0],r=n[1];return[t,{min:r,max:r}]})))].concat((0,a.Z)(Object.values(n.values).map((function(e){return computeArtRange(e)}))))));return internal_mapFormulas(e,(function(e){var n=t.get(e),r=n.min;if(r===n.max)return constant(r);var i=e.operation,o=e.operands.map((function(e){return t.get(e)}));switch(i){case"threshold":var s=(0,u.Z)(o,4),c=s[0],l=s[1],f=s[2],p=s[3];if(c.min>=l.max)return e.operands[2];if(c.max<l.min)return e.operands[3];if(f.max===f.min&&p.max===p.min&&f.min===p.min&&isFinite(f.min))return constant(f.max);break;case"min":var d=e.operands.filter((function(e,n){var t=o[n];return o.every((function(e,n){return t.min<=e.max}))}));if(d.length<o.length)return min.apply(void 0,(0,a.Z)(d));break;case"max":var h=e.operands.filter((function(e,n){var t=o[n];return o.every((function(e){return t.max>=e.min}))}));if(h.length<o.length)return max.apply(void 0,(0,a.Z)(h))}return e}),(function(e){return e}))}function addArtRange(e){var n={};return e.forEach((function(e){Object.entries(e).forEach((function(e){var t=(0,u.Z)(e,2),r=t[0],a=t[1];n[r]?(n[r].min+=a.min,n[r].max+=a.max):n[r]=(0,i.Z)({},a)}))})),n}function computeArtRange(e){var n={};return e.length&&(Object.keys(e[0].values).filter((function(n){return e.every((function(e){return e.values[n]}))})).forEach((function(t){return n[t]={min:e[0].values[t],max:e[0].values[t]}})),e.forEach((function(e){for(var t=e.values,r=0,a=Object.entries(t);r<a.length;r++){var i=(0,u.Z)(a[r],2),o=i[0],s=i[1];n[o]?(n[o].max<s&&(n[o].max=s),n[o].min>s&&(n[o].min=s)):n[o]={min:0,max:s}}}))),n}function computeNodeRange(e,n){var t=new Map;return forEachNodes(e,(function(e){}),(function(e){var r,a,i=e.operation,o=e.operands.map((function(e){return t.get(e)}));switch(i){case"read":if("dyn"!==e.path[0])throw new Error("Found non-dyn path ".concat(e.path," while computing range"));a=null!==(r=n[e.path[1]])&&void 0!==r?r:{min:0,max:0};break;case"const":a=computeMinMax([e.value]);break;case"add":case"min":case"max":a={min:m[i](o.map((function(e){return e.min}))),max:m[i](o.map((function(e){return e.max})))};break;case"res":a={min:m[i]([o[0].max]),max:m[i]([o[0].min])};break;case"mul":a=o.reduce((function(e,n){return computeMinMax([e.min*n.min,e.min*n.max,e.max*n.min,e.max*n.max])}));break;case"threshold":a=o[0].min>=o[1].max?o[2]:o[0].max<o[1].min?o[3]:computeMinMax([],[o[2],o[3]]);break;case"sum_frac":var s=(0,u.Z)(o,2),c=s[0],l=s[1],f={min:c.min+l.min,max:c.max+l.max};a=f.min<=0&&f.max>=0?c.min<=0&&c.max>=0?{min:NaN,max:NaN}:{min:-1/0,max:1/0}:computeMinMax([c.min/f.min,c.min/f.max,c.max/f.min,c.max/f.max]);break;default:assertUnreachable(i)}t.set(e,a)})),t}function computeMinMax(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=Math.max.apply(Math,(0,a.Z)(e).concat((0,a.Z)(n.map((function(e){return e.max}))))),r=Math.min.apply(Math,(0,a.Z)(e).concat((0,a.Z)(n.map((function(e){return e.min})))));return{min:r,max:t}}function filterArts(e,n){return{base:e.base,values:Util_objectKeyMap(g,(function(t){var r=n[t];switch(r.kind){case"id":return e.values[t].filter((function(e){return r.ids.has(e.id)}));case"exclude":return e.values[t].filter((function(e){return!r.sets.has(e.set)}));case"required":return e.values[t].filter((function(e){return r.sets.has(e.set)}))}}))}}function countBuilds(e){return g.reduce((function(n,t){return n*e.values[t].length}),1)}function filterFeasiblePerm(e,n){var t,i,s,c,l,f,p;return(0,o.Z)().wrap((function filterFeasiblePerm$(o){for(;;)switch(o.prev=o.next){case 0:t=objectMap(n.values,(function(e){return new Set(e.map((function(e){return e.set})))})),i=(0,r.Z)(e),o.prev=2,i.s();case 4:if((s=i.n()).done){o.next=19;break}c=s.value,l=function _loop2(){var e=(0,u.Z)(p[f],2),n=e[0],r=e[1],i=t[n];switch(r.kind){case"required":if((0,a.Z)(r.sets).every((function(e){return!i.has(e)})))return"continue|filter_loop";break;case"exclude":if((0,a.Z)(i).every((function(e){return r.sets.has(e)})))return"continue|filter_loop"}},f=0,p=Object.entries(c);case 8:if(!(f<p.length)){o.next=15;break}if("continue|filter_loop"!==l()){o.next=12;break}return o.abrupt("continue",17);case 12:f++,o.next=8;break;case 15:return o.next=17,c;case 17:o.next=4;break;case 19:o.next=24;break;case 21:o.prev=21,o.t0=o.catch(2),i.e(o.t0);case 24:return o.prev=24,i.f(),o.finish(24);case 27:case"end":return o.stop()}}),_,null,[[2,21,24,27]])}function exclusionToAllowed(e){return new Set(null!==e&&void 0!==e&&e.includes(2)?e.includes(4)?[0,1]:[0,1,4,5]:null!==e&&void 0!==e&&e.includes(4)?[0,1,2,3]:[0,1,2,3,4,5])}function artSetPerm(e,n){var t,s,c,l,f,p,d,h,v,m,b,w,k,_,x,Z;return(0,o.Z)().wrap((function artSetPerm$(y){for(;;)switch(y.prev=y.next){case 0:for(k=function _check2(e){var n,u,c,l,f,p,d,h,v,k,_;return(0,o.Z)().wrap((function check$(t){for(;;)switch(t.prev=t.next){case 0:_=function _check_free(e){var n,t,c,l,p,d,h,v,k,y,x,Z,S,M;return(0,o.Z)().wrap((function check_free$(o){for(;;)switch(o.prev=o.next){case 0:n=f.length-e,t=[],c=[],l=[],p=0,d=(0,r.Z)(s),o.prev=3,v=function _loop6(){var e=h.value,r=w[e],i=b[e];if(!r)return"continue";range(1,n).every((function(e){return!r.has(i+e)}))?l.push(e):r.has(i)?range(0,n).some((function(e){return!r.has(i+e)}))&&t.push(e):(p+=(0,a.Z)(r).find((function(e){return e>i}))-i,c.push(e))},d.s();case 6:if((h=d.n()).done){o.next=12;break}if("continue"!==v()){o.next=10;break}return o.abrupt("continue",10);case 10:o.next=6;break;case 12:o.next=17;break;case 14:o.prev=14,o.t0=o.catch(3),d.e(o.t0);case 17:return o.prev=17,d.f(),o.finish(17);case 20:if(!(p>n)){o.next=22;break}return o.abrupt("return");case 22:if(e!==f.length){o.next=26;break}return o.next=25,(0,i.Z)({},m);case 25:return o.abrupt("return");case 26:if(p!==n){o.next=47;break}k=(0,r.Z)(c),o.prev=28,k.s();case 30:if((y=k.n()).done){o.next=38;break}return x=y.value,b[x]++,m[g[f[e]]]={kind:"required",sets:new Set([x])},o.delegateYield(_(e+1),"t1",35);case 35:b[x]--;case 36:o.next=30;break;case 38:o.next=43;break;case 40:o.prev=40,o.t2=o.catch(28),k.e(o.t2);case 43:return o.prev=43,k.f(),o.finish(43);case 46:return o.abrupt("return");case 47:Z=0,S=[].concat(t,c);case 48:if(!(Z<S.length)){o.next=57;break}return M=S[Z],b[M]++,m[g[f[e]]]={kind:"required",sets:new Set([M])},o.delegateYield(_(e+1),"t3",53);case 53:b[M]--;case 54:Z++,o.next=48;break;case 57:return m[g[f[e]]]={kind:"exclude",sets:new Set([].concat(c,l,t))},o.delegateYield(_(e+1),"t4",59);case 59:case"end":return o.stop()}}),u,null,[[3,14,17,20],[28,40,43,46]])},k=function _check(e){var t,a,i;return(0,o.Z)().wrap((function check$(n){for(;;)switch(n.prev=n.next){case 0:if(e!==l.length){n.next=3;break}return n.delegateYield(_(0),"t0",2);case 2:return n.abrupt("return",n.t0);case 3:t=(0,r.Z)(s),n.prev=4,i=(0,o.Z)().mark((function _loop5(){var n,t,r,i,u;return(0,o.Z)().wrap((function _loop5$(o){for(;;)switch(o.prev=o.next){case 0:if(n=a.value,!c.has(n)){o.next=3;break}return o.abrupt("return","continue");case 3:if(t=l[e].length,r=w[n],i=0,!r||r.has(t)){o.next=9;break}if(!((i=(null!==(u=range(t+1,5).find((function(e){return r.has(e)})))&&void 0!==u?u:6)-t)>v)){o.next=9;break}return o.abrupt("return","continue");case 9:return c.add(n),b[n]=l[e].length,l[e].forEach((function(e){return m[g[e]]={kind:"required",sets:new Set([n])}})),v-=i,o.delegateYield(k(e+1),"t0",14);case 14:v+=i,b[n]=0,c.delete(n);case 17:case"end":return o.stop()}}),_loop5)})),t.s();case 7:if((a=t.n()).done){n.next=14;break}return n.delegateYield(i(),"t1",9);case 9:if("continue"!==n.t1){n.next=12;break}return n.abrupt("continue",12);case 12:n.next=7;break;case 14:n.next=19;break;case 16:n.prev=16,n.t2=n.catch(4),t.e(n.t2);case 19:return n.prev=19,t.f(),n.finish(19);case 22:case"end":return n.stop()}}),n,null,[[4,16,19,22]])},n=(0,o.Z)().mark(k),u=(0,o.Z)().mark(_),c=new Set,l=[],f=[],p=(0,r.Z)(e);try{for(p.s();!(d=p.n()).done;)h=d.value,l.push([]),5===h?f.push(l.length-1):l[h].push(l.length-1)}catch(y){p.e(y)}finally{p.f()}return l=l.filter((function(e){return e.length})).sort((function(e,n){return n.length-e.length})),v=f.length,t.delegateYield(k(0),"t0",10);case 10:case"end":return t.stop()}}),t)},p=function _indexOfShape(e,n){if(!range(n+1,4).some((function(n){return 5!==e[n]})))return(e=(0,a.Z)(e))[n]=5,e.reduce((function(e,n){return 6*e+n}),0)},f=function _populateShapes(e,n,t){if(5!==e.length){var i,o=(0,r.Z)(n);try{var u=function _loop3(){var r=i.value;f([].concat((0,a.Z)(e),[r]),n,t.filter((function(e){return e!==r})))};for(o.s();!(i=o.n()).done;)u()}catch(s){o.e(s)}finally{o.f()}f([].concat((0,a.Z)(e),[e.length]),new Set([].concat((0,a.Z)(n),[e.length])),[].concat((0,a.Z)(t),[e.length]))}else c.has(t.length)&&l.push(e)},t=(0,o.Z)().mark(k),s=(0,a.Z)(new Set(n)),c=exclusionToAllowed(e.rainbow),l=[],f([0],new Set([0]),[0]),d=function _loop4(e){var n,t=new Map,i=(0,r.Z)(l);try{for(i.s();!(n=i.n()).done;){var o,s=n.value,c=p(s,e);void 0!==c&&t.set(c,(null!==(o=t.get(c))&&void 0!==o?o:new Set(s.slice(0,e)).size+1)-1)}}catch(v){i.e(v)}finally{i.f()}var f,d=(0,r.Z)(t.entries());try{var h=function _loop7(){var n=(0,u.Z)(f.value,2),t=n[0];if(0===n[1]){var r=(0,a.Z)(l.find((function(n){return p(n,e)===t})));r[e]=5,l=l.filter((function(n){return p(n,e)!==t})),l.push(r)}};for(d.s();!(f=d.n()).done;)h()}catch(v){d.e(v)}finally{d.f()}},h=4;h>=0;h--)d(h);v={kind:"exclude",sets:new Set},m=Util_objectKeyMap(g,(function(e){return v})),b=(0,i.Z)((0,i.Z)({},objectMap(e,(function(e){return 0}))),Util_objectKeyMap(s,(function(e){return 0}))),w=objectMap(e,exclusionToAllowed),_=(0,r.Z)(l),y.prev=14,_.s();case 16:if((x=_.n()).done){y.next=21;break}return Z=x.value,y.delegateYield(k(Z),"t0",19);case 19:y.next=16;break;case 21:y.next=26;break;case 23:y.prev=23,y.t1=y.catch(14),_.e(y.t1);case 26:return y.prev=26,_.f(),y.finish(26);case 29:case"end":return y.stop()}}),y,null,[[14,23,26,29]])}var x=function(){function BNBSplitWorker(e,n){var t=e.arts,r=e.optimizationTarget,i=e.filters,o=e.maxBuilds;(0,d.Z)(this,BNBSplitWorker),this.min=void 0,this.nodes=void 0,this.arts=void 0,this.maxBuilds=void 0,this.filters=[],this.interim=void 0,this.firstUncalculated=0,this.callback=void 0,this.arts=t,this.min=[-1/0].concat((0,a.Z)(i.map((function(e){return e.min})))),this.nodes=[r].concat((0,a.Z)(i.map((function(e){return e.value})))),this.callback=n,this.maxBuilds=o,linearUpperBound(this.nodes,t)}return(0,h.Z)(BNBSplitWorker,[{key:"addFilter",value:function addFilter(e){var n=filterArts(this.arts,e),t=countBuilds(n);t&&this.filters.push({nodes:this.nodes,arts:n,maxConts:[],approxs:[],age:0,count:t})}},{key:"split",value:function split(e,n){for(e>this.min[0]&&(this.min[0]=e,this.firstUncalculated=0,this.filters.forEach((function(e){return delete e.calculated}))),this.firstUncalculated<this.filters.length&&this.calculateFilter(this.firstUncalculated++);this.filters.length;){var t=this.getApproxFilter(),r=t.arts,a=t.count;if(this.reportInterim(!1),a){if(a<=n)return this.reportInterim(!0),objectMap(r.values,(function(e){return{kind:"id",ids:new Set(e.map((function(e){return e.id})))}}));this.splitOldFilter(t)}}this.reportInterim(!0)}},{key:"reportInterim",value:function reportInterim(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.interim&&(this.interim.skipped>1e6||!0===e)&&(this.callback(this.interim),this.interim=void 0)}},{key:"splitOldFilter",value:function splitOldFilter(e){var n=e.nodes,t=e.arts,r=e.approxs,a=e.age,o=objectMap(t.values,(function(e){var n,t,a=e.map((function(e){return{art:e,cont:r[0].conts[e.id]}})).sort((function(e,n){var t=e.cont;return n.cont-t})),i=null!==(n=null===(t=a[a.length-1])||void 0===t?void 0:t.cont)&&void 0!==n?n:0,o=a.reduce((function(e,n){return e+n.cont}),-i*a.length)/3,u=Math.max(1,a.findIndex((function(e){var n=e.cont;return(o-=n-i)<=0}))),s=a.splice(u).map((function(e){return e.art})),c=a.map((function(e){return e.art}));return{high:{arts:c,maxConts:r.map((function(e){return maxContribution(c,e)}))},low:{arts:s,maxConts:r.map((function(e){return maxContribution(s,e)}))}}})),u=Object.keys(o),s=this.filters,c={},l={};!function partialSplit(e){if(u.length){var f=u.pop(),p=o[f],d=p.high,h=p.low;h.arts.length&&(c[f]=h.arts,l[f]=h.maxConts,partialSplit(e*h.arts.length)),d.arts.length&&(c[f]=d.arts,l[f]=d.maxConts,partialSplit(e*d.arts.length)),u.push(f)}else{var v=r.map((function(e,n){return objectMap(l,(function(e){return e[n]}))})),m={base:t.base,values:(0,i.Z)({},c)};s.push({nodes:n,arts:m,maxConts:v,approxs:r,age:a+1,count:e})}}(1)}},{key:"getApproxFilter",value:function getApproxFilter(){return this.calculateFilter(this.filters.length-1),this.firstUncalculated>this.filters.length&&(this.firstUncalculated=this.filters.length),this.filters.pop()}},{key:"calculateFilter",value:function calculateFilter(e){var n=this,t=this.filters[e],r=t.nodes,a=t.arts,i=t.maxConts,o=t.approxs,u=t.age,s=t.count;if(!t.calculated){if(u<3||u%5===2){var c=pruneAll(r,this.min,a,this.maxBuilds,{},{pruneNodeRange:!0});r=c.nodes,a=c.arts,Object.values(a.values).every((function(e){return e.length}))&&(o=function approximation(e,n){return linearUpperBound(e,n).map((function(e){return{base:dot(n.base,e,e.$c),conts:objectKeyValueMap(Object.values(n.values).flat(),(function(n){return[n.id,dot(n.values,e,0)]}))}}))}(r,a),i=o.map((function(e){return objectMap(a.values,(function(n){return maxContribution(n,e)}))})))}var l=i.map((function(e,t){return Object.values(e).reduce((function(e,n){return e+n}),o[t].base-n.min[t])})),f=objectMap(a.values,(function(e,n){var t=l.map((function(e,t){return i[t][n]-e}));return e.filter((function(e){var n=e.id;return o.every((function(e,r){return e.conts[n]>t[r]}))}))})),p=countBuilds(a={base:a.base,values:f});p!==s&&(this.interim?this.interim.skipped+=s-p:this.interim={command:"interim",buildValues:void 0,tested:0,failed:0,skipped:s-p}),this.filters[e]={nodes:r,arts:a,maxConts:i,approxs:o,age:u,count:p,calculated:!0}}}}]),BNBSplitWorker}();function maxContribution(e,n){return Math.max.apply(Math,(0,a.Z)(e.map((function(e){var t=e.id;return n.conts[t]}))))}function dot(e,n,t){return Object.entries(e).reduce((function(e,t){var r,a=(0,u.Z)(t,2),i=a[0],o=a[1];return e+(null!==(r=n[i])&&void 0!==r?r:0)*o}),t)}function weightedSum(){for(var e={},n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];for(var a=0,i=t;a<i.length;a++)for(var o=(0,u.Z)(i[a],2),s=o[0],c=o[1],l=0,f=Object.entries(c);l<f.length;l++){var p,d=(0,u.Z)(f[l],2),h=d[0],v=d[1];e[h]=(null!==(p=e[h])&&void 0!==p?p:0)+s*v}return e}function linearUpperBound(e,n){var t=weightedSum.apply(void 0,[[1,n.base]].concat((0,a.Z)(Object.values(n.values).map((function(e){return[1/e.length,weightedSum.apply(void 0,(0,a.Z)(e.map((function(e){return[1,e.values]}))))]}))))),i=function getCent(e){return dot(t,e,e.$c)},o=new Map;forEachNodes(e,(function(e){var n=e.operation;switch("mul"===n&&o.set(e,{min:NaN,max:NaN}),n){case"mul":case"min":case"max":case"threshold":case"res":case"sum_frac":e.operands.forEach((function(e){return o.set(e,{min:NaN,max:NaN})}))}}),(function(e){return e}));var s,c=computeNodeRange((0,a.Z)(o.keys()),function computeFullArtRange(e){return addArtRange([Object.fromEntries(Object.entries(e.base).map((function(e){var n=(0,u.Z)(e,2),t=n[0],r=n[1];return[t,{min:r,max:r}]})))].concat((0,a.Z)(Object.values(e.values).map((function(e){return computeArtRange(e)})))))}(n)),l=(0,r.Z)(c.entries());try{for(l.s();!(s=l.n()).done;){var f=(0,u.Z)(s.value,2),d=f[0],h=f[1];o.set(d,h)}}catch(g){l.e(g)}finally{l.f()}function slopePoint(e,n,t,r){return weightedSum([1,{$c:t-e*n}],[e,r])}function interpolate(e,n,t,r,a,i){return Math.abs(e-t)<1e-10?{$c:i?Math.max(n,r):Math.min(n,r)}:slopePoint((r-n)/(t-e),e,n,a)}var v="u",b="l";return customMapFormula(e,v,(function(e,n,t){var r=e.operation,s=function map(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;return t(e,r)},c=n===v?b:v;if("o"===n){var l=o.get(e),f=l.min,d=l.max;if(f<0&&d>0)throw new O("Zero-crossing",r);return s(e,d<=0?b:v)}switch(r){case"const":return{$c:e.value};case"read":return(0,p.Z)({$c:0},e.path[1],1);case"add":return weightedSum.apply(void 0,(0,a.Z)(e.operands.map((function(e){return[1,s(e)]}))));case"min":case"max":var h=m[r],g=e.operands.filter((function(e){return"const"!==e.operation})),w=(0,u.Z)(g,1)[0];if(1!==g.length)throw new O("Multivariate",r);var k=s(w),_=h(e.operands.filter((function(e){return"const"===e.operation})).map((function(e){return e.value})));if("max"===r&&n===b||"min"===r&&n===v)return k;var y=o.get(w),x=y.min,Z=y.max;return interpolate(x,h([x,_]),Z,h([Z,_]),k,n===v);case"res":if(n!==v)throw new O("Unsupported direction",r);var S=m[r],M=(0,u.Z)(e.operands,1)[0],A=o.get(M),j=A.min,F=A.max,B=s(M,c);return j<0&&F<1.75?weightedSum([1,{$c:1}],[-.5,B]):interpolate(j,S([j]),F,S([F]),B,n===v);case"sum_frac":if(n!==v)throw new O("Unsupported direction",r);var E=(0,u.Z)(e.operands,2),N=E[0],R=E[1];if("const"!==R.operation)throw new O("Non-constant node",r);var q=s(N),T=R.value,P=o.get(N),C=P.min,D=P.max,U=Math.sqrt((C+T)*(D+T));if(C<=-T)throw new O("Unsupported pattern",r);return slopePoint(T/(T+U)/(T+U),U,U/(U+T),q);case"threshold":var K=(0,u.Z)(e.operands,4),W=K[0],V=K[1],G=K[2],z=K[3];if("const"!==z.operation||"const"!==V.operation)throw new O("Non-constant node",r);if("const"!==G.operation){if(0!==z.value)throw new O("Unsupported pattern",r);var I=function utils_threshold(e,n,t,r,a){return{operation:"threshold",operands:[intoV(e),intoV(n),intoV(t),intoV(r)],info:a}}(W,V,1,z),H=function prod(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return{operation:"mul",operands:intoOps(n)}}(I,G),L=o.get(G),$=L.min,Y=L.max;return o.set(I,{min:0,max:1}),o.set(H,{min:Math.min($,0),max:Math.max(Y,0)}),s(H)}var X=o.get(W),J=X.min,Q=X.max,ee=V.value,ne=G.value,te=z.value,re=ne>te===(n===v);return slopePoint((ne-te)/(re?ee-J:Q-ee),ee,re?ne:te,s(W,ne>te?n:c));case"mul":var ae=o.get(e),ie=ae.min,oe=ae.max;if(ie<0&&oe>0)throw new O("Zero-crossing",r);if(ie<0&&n!==b||oe>0&&n!==v)throw new O("Unsupported direction",r);for(var ue=(0,a.Z)(e.operands),se=[],ce=1;ue.length;){var le=ue.pop();"mul"===le.operation?ue.push.apply(ue,(0,a.Z)(le.operands)):"const"===le.operation?ce*=le.value:se.push(le)}var fe=se.map((function(e){return s(e,"o")})),pe=se.map((function(e){return o.get(e)})),de=fe.map(i),he=de.reduce((function(e,n,t){return e+(n>=0?pe[t].max:pe[t].min)/n}),0),ve=de.reduce((function(e,n){return e*he*n/fe.length}),ce/he);return weightedSum.apply(void 0,(0,a.Z)(fe.map((function(e,n){return[ve/de[n],e]}))));default:assertUnreachable(r)}}))}var Z,S,M,O=function(e){(0,c.Z)(PolyError,e);var n=(0,l.Z)(PolyError);function PolyError(e,t){return(0,d.Z)(this,PolyError),n.call(this,"Found ".concat(e," in ").concat(t," node when generating polynomial upper bound"))}return(0,h.Z)(PolyError)}((0,f.Z)(Error)),A=function(){function ComputeWorker(e,n){var t=this,r=e.arts,a=e.optimizationTarget,o=e.filters,u=e.plotBase,s=e.maxBuilds;(0,d.Z)(this,ComputeWorker),this.builds=[],this.buildValues=void 0,this.plotData=void 0,this.threshold=-1/0,this.maxBuilds=void 0,this.min=void 0,this.arts=void 0,this.nodes=void 0,this.callback=void 0,this.interimReport=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.refresh(n),t.callback((0,i.Z)({command:"interim",buildValues:t.buildValues},e)),t.buildValues=void 0,e.tested=0,e.failed=0,e.skipped=0},this.arts=r,this.min=o.map((function(e){return e.min})),this.maxBuilds=s,this.callback=n,this.nodes=o.map((function(e){return e.value})),this.nodes.push(a),u&&(this.plotData={},this.nodes.push(u)),this.nodes=function optimize(e,n){var t=constantFold(e,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!1});return deduplicate(t=flatten(t))}(this.nodes,{},(function(e){return!1}))}return(0,h.Z)(ComputeWorker,[{key:"compute",value:function compute(e,n){this.threshold>e&&(this.threshold=e);var t=this.min,r=this.interimReport,i=this,o=filterArts(this.arts,n),s=countBuilds(o),c=this.builds.length,l=this.nodes,f=pruneAll(l,t,o,this.maxBuilds,{},{pruneArtRange:!0,pruneNodeRange:!0});l=f.nodes,o=f.arts;var p=Object.values(o.values).sort((function(e,n){return e.length-n.length})),compute=function precompute(e,n,t,r){var i='\n"use strict";\n// copied from the code above\nfunction res(res) {\n  if (res < 0) return 1 - res / 2\n  else if (res >= 0.75) return 1 / (res * 4 + 1)\n  return 1 - res\n}\nconst x0=0',o=1,s=new Map;return forEachNodes(e,(function(e){}),(function(e){var c=e.operation,l=e.operands,f="x".concat(o++),p=l.map((function(e){return s.get(e)}));switch(s.set(e,f),c){case"read":var d=t(e),h=new Array(r).fill(null).map((function(e,n){return"(b[".concat(n,'].values["').concat(d,'"] ?? 0)')}));n[d]&&0!==n[d]&&(h=[n[d].toString()].concat((0,a.Z)(h))),i+=",".concat(f,"=").concat(h.join("+"));break;case"const":s.set(e,"(".concat(e.value,")"));break;case"add":case"mul":i+=",".concat(f,"=").concat(p.join("add"===c?"+":"*"));break;case"min":case"max":i+=",".concat(f,"=Math.").concat(c,"(").concat(p,")");break;case"threshold":var v=(0,u.Z)(p,4),m=v[0],b=v[1],g=v[2],w=v[3];i+=",".concat(f,"=(").concat(m,">=").concat(b,")?").concat(g,":").concat(w);break;case"res":i+=",".concat(f,"=res(").concat(p[0],")");break;case"sum_frac":i+=",".concat(f,"=").concat(p[0],"/(").concat(p[0],"+").concat(p[1],")");break;default:assertUnreachable(c)}})),i+=";\nreturn [".concat(e.map((function(e){return s.get(e)})),"]"),new Function("b",i)}(l,o.base,(function(e){return e.path[1]}),p.length),d=Array(p.length),h={tested:0,failed:0,skipped:s-countBuilds(o)};!function permute(e){if(e<0){var n=compute(d);if(t.every((function(e,t){return e<=n[t]}))){var a,o=n[t.length],u=i.builds,s=i.plotData;if(o>=i.threshold&&(a={value:o,artifactIds:d.map((function(e){return e.id})).filter((function(e){return e}))},u.push(a)),s){var c=n[t.length+1];(!s[c]||s[c].value<o)&&(a||(a={value:o,artifactIds:d.map((function(e){return e.id})).filter((function(e){return e}))}),a.plot=c,s[c]=a)}}else h.failed+=1}else p[e].forEach((function(n){d[e]=n,permute(e-1)})),0===e&&(h.tested+=p[0].length,h.tested>65536&&r(h))}(p.length-1),r(h,this.builds.length>c)}},{key:"refresh",value:function refresh(e){var n,t,i=this.maxBuilds;(Object.keys(null!==(n=this.plotData)&&void 0!==n?n:{}).length>=1e5&&(this.plotData=function mergePlot(e){for(var n=.01,t=new Set(e.flatMap((function(e){return Object.values(e).map((function(e){return Math.round(e.plot/n)}))})));t.size>1500;)n*=2,t=new Set((0,a.Z)(t).map((function(e){return Math.round(e/2)})));var i,o={},u=(0,r.Z)(e);try{for(u.s();!(i=u.n()).done;)for(var s=i.value,c=0,l=Object.values(s);c<l.length;c++){var f=l[c],p=Math.round(f.plot/n)*n;(!o[p]||o[p].value<f.value)&&(o[p]=f)}}catch(d){u.e(d)}finally{u.f()}return o}([this.plotData])),this.builds.length>=1e3||e)&&(this.builds=this.builds.sort((function(e,n){return n.value-e.value})).slice(0,i),this.buildValues=this.builds.map((function(e){return e.value})),this.threshold=Math.max(this.threshold,null!==(t=this.buildValues[i-1])&&void 0!==t?t:-1/0))}}]),ComputeWorker}(),j=function(){function DefaultSplitWorker(e,n){var t=e.arts;(0,d.Z)(this,DefaultSplitWorker),this.arts=void 0,this.filters=[],this.arts=t}return(0,h.Z)(DefaultSplitWorker,[{key:"addFilter",value:function addFilter(e){this.filters.push(e)}},{key:"split",value:function split(e,n){for(var t=this;this.filters.length;){var r=this.filters.pop();if(countBuilds(filterArts(this.arts,r))<=n)return r;splitBySetOrID(this.arts,r,n).forEach((function(e){return t.addFilter(e)}))}}}]),DefaultSplitWorker}();function splitBySetOrID(e,n,t){var r=filterArts(e,n),o=g.map((function(e){return{slot:e,sets:new Set(r.values[e].map((function(e){return e.set})))}})).filter((function(e){return e.sets.size>1}));if(!o.length)return function splitByID(e,n,t){var r=filterArts(e,n),a=countBuilds(r),o=g.map((function(e){return{slot:e,length:r.values[e].length}})).filter((function(e){return e.length>1})),u=o.reduce((function(e,n){return e.length<n.length?e:n})),s=u.slot,c=u.length,l=Math.ceil(a/t),f=Math.min(l,c),d=Array(f).fill(0).map((function(e){return new Set}));return r.values[s].forEach((function(e,n){var t=e.id;return d[n%f].add(t)})),d.map((function(e){return(0,i.Z)((0,i.Z)({},n),{},(0,p.Z)({},s,{kind:"id",ids:e}))}))}(r,n,t);var u=o.reduce((function(e,n){return e.sets.size<n.sets.size?e:n})),s=u.sets,c=u.slot;return(0,a.Z)(s).map((function(e){return(0,i.Z)((0,i.Z)({},n),{},(0,p.Z)({},c,{kind:"required",sets:new Set([e])}))}))}onmessage=function onmessage(e){var n,t=e.data,o=t.command;switch(o){case"setup":Z=t.id;var u="split".concat(Z),s="compute".concat(Z);try{S=new x(t,(function(e){return postMessage((0,i.Z)({id:Z,source:u},e))}))}catch(v){S=new j(t,(function(e){return postMessage((0,i.Z)({id:Z,source:u},e))}))}M=new A(t,(function(e){return postMessage((0,i.Z)({id:Z,source:s},e))})),n={command:"iterate"};break;case"split":t.filter&&S.addFilter(t.filter);var c=S.split(t.threshold,t.minCount);n={command:"split",filter:c};break;case"iterate":var l=t.threshold,f=t.filter;M.compute(l,f),n={command:"iterate"};break;case"finalize":M.refresh(!0);var p=M,d=p.builds,h=p.plotData;n={command:"finalize",builds:d,plotData:h};break;case"count":if("break"===function(){var e,i=t.exclusion,o=M.arts,u=filterFeasiblePerm(artSetPerm(i,(0,a.Z)(new Set(Object.values(o.values).flatMap((function(e){return e.map((function(e){return e.set}))}))))),o),s=t.arts.map((function(e){return 0})),c=(0,r.Z)(u);try{var l=function _loop(){var n=e.value;t.arts.forEach((function(e,t){return s[t]+=countBuilds(filterArts(e,n))}))};for(c.s();!(e=c.n()).done;)l()}catch(f){c.e(f)}finally{c.f()}return n={command:"count",counts:s},"break"}())break;default:assertUnreachable(o)}postMessage((0,i.Z)({id:Z},n))}}},n={};function __webpack_require__(t){var r=n[t];if(void 0!==r)return r.exports;var a=n[t]={exports:{}};return e[t](a,a.exports,__webpack_require__),a.exports}__webpack_require__.m=e,__webpack_require__.x=function(){var e=__webpack_require__.O(void 0,[676],(function(){return __webpack_require__(18349)}));return e=__webpack_require__.O(e)},function(){var e=[];__webpack_require__.O=function(n,t,r,a){if(!t){var i=1/0;for(c=0;c<e.length;c++){t=e[c][0],r=e[c][1],a=e[c][2];for(var o=!0,u=0;u<t.length;u++)(!1&a||i>=a)&&Object.keys(__webpack_require__.O).every((function(e){return __webpack_require__.O[e](t[u])}))?t.splice(u--,1):(o=!1,a<i&&(i=a));if(o){e.splice(c--,1);var s=r();void 0!==s&&(n=s)}}return n}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[t,r,a]}}(),__webpack_require__.d=function(e,n){for(var t in n)__webpack_require__.o(n,t)&&!__webpack_require__.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},__webpack_require__.f={},__webpack_require__.e=function(e){return Promise.all(Object.keys(__webpack_require__.f).reduce((function(n,t){return __webpack_require__.f[t](e,n),n}),[]))},__webpack_require__.u=function(e){return"static/js/"+e+".e3357613.chunk.js"},__webpack_require__.miniCssF=function(e){},__webpack_require__.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},__webpack_require__.p="/genshin-optimizer/feelcrafting-com/",function(){var e={349:1};__webpack_require__.f.i=function(n,t){e[n]||importScripts(__webpack_require__.p+__webpack_require__.u(n))};var n=self.webpackChunkgenshin_optimizer=self.webpackChunkgenshin_optimizer||[],t=n.push.bind(n);n.push=function(n){var r=n[0],a=n[1],i=n[2];for(var o in a)__webpack_require__.o(a,o)&&(__webpack_require__.m[o]=a[o]);for(i&&i(__webpack_require__);r.length;)e[r.pop()]=1;t(n)}}(),function(){var e=__webpack_require__.x;__webpack_require__.x=function(){return __webpack_require__.e(676).then(e)}}();__webpack_require__.x()}();
//# sourceMappingURL=349.11fa4b3d.chunk.js.map